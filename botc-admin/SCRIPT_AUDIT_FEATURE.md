# 📋 剧本审核功能说明

## ✅ 功能概述

在管理端的「剧本管理」页面增加了完整的审核功能，管理员可以预览剧本内容（包括JSON数据）并进行审核操作。

---

## 🎯 新增功能

### 1. 预览按钮
- 所有剧本都有「预览」按钮
- 点击后弹出预览弹窗
- 显示完整的剧本信息

### 2. 审核按钮
- 仅「待审核」状态的剧本显示
- 点击后打开预览窗口进行审核
- 可以直接通过或拒绝

### 3. 拒绝按钮
- 仅「待审核」状态的剧本显示
- 点击后拒绝剧本（状态改为「已下架」）

---

## 📱 使用流程

### 审核流程

```
管理员登录后台
    ↓
进入「剧本管理」
    ↓
找到「待审核」的剧本
    ↓
点击「预览」或「审核」按钮
    ↓
查看剧本详细信息
    ↓
预览JSON数据和角色列表
    ↓
点击「✓ 通过审核」或「关闭」后点「拒绝」
```

---

## 🖼️ 预览窗口内容

### 1. 基本信息
- 标题
- 副标题
- 作者
- 类型（推理/娱乐）
- 难度（简单/中等/困难/专家）
- 玩家人数
- 预计时长
- 当前状态

### 2. 剧本描述
- 显示完整的描述文本
- 自动换行显示

### 3. 标签
- 以标签形式显示所有标签

### 4. JSON数据预览
- **角色数量**：显示总共有多少个角色
- **数据大小**：显示JSON文件大小
- **角色预览**：显示前5个角色的名称和队伍
- **查看完整JSON**：点击按钮查看完整JSON内容

---

## 🔍 预览功能详细说明

### JSON数据预览

显示内容：
```
📦 JSON数据                    [查看完整JSON]

角色数量：18
数据大小：125.5 KB

角色预览（前5个）：
┌─────────────────────────┐
│ 贵族          镇民        │
│ 渔夫          镇民        │
│ 村夫          镇民        │
│ 气球驾驶员    镇民        │
│ 女祭司        镇民        │
└─────────────────────────┘
```

### 查看完整JSON

点击「查看完整JSON」按钮后：
- 弹出新窗口显示完整的JSON内容
- 格式化显示（2空格缩进）
- 只读文本框
- 支持滚动查看
- 可以复制JSON内容

---

## 🎮 操作按钮

### 所有剧本都有：
- **预览**：查看剧本详细信息
- **编辑**：进入编辑页面
- **删除**：删除剧本

### 待审核剧本额外有：
- **审核**：打开预览窗口进行审核
- **拒绝**：直接拒绝剧本

### 已发布剧本额外有：
- **下架**：将剧本下架

### 已下架剧本额外有：
- **上架**：重新发布剧本

---

## 📊 审核统计

### 状态说明
- **待审核（status=0）**：新上传的剧本，等待管理员审核
- **已发布（status=1）**：审核通过，用户可见
- **已下架（status=2）**：被拒绝或主动下架

### 筛选功能
可以通过顶部筛选器快速找到待审核的剧本：
```
剧本状态：选择「待审核」
即可只显示需要审核的剧本
```

---

## 🧪 测试步骤

### 测试1：预览功能

```bash
1. 进入管理后台「剧本管理」
2. 找到任意剧本
3. 点击「预览」按钮
4. 验证：
   ✅ 弹出预览窗口
   ✅ 显示完整信息
   ✅ JSON数据正确
   ✅ 角色预览正确
```

### 测试2：查看完整JSON

```bash
1. 在预览窗口中
2. 点击「查看完整JSON」按钮
3. 验证：
   ✅ 弹出JSON查看窗口
   ✅ 显示格式化的JSON
   ✅ 可以滚动查看
   ✅ 点击「复制」可以复制内容
```

### 测试3：审核通过

```bash
1. 找到「待审核」状态的剧本
2. 点击「审核」按钮
3. 查看剧本信息
4. 点击「✓ 通过审核」
5. 验证：
   ✅ 提示「审核通过」
   ✅ 状态变为「已发布」
   ✅ 设置了发布时间
```

### 测试4：拒绝剧本

```bash
1. 找到「待审核」状态的剧本
2. 点击「拒绝」按钮
3. 确认操作
4. 验证：
   ✅ 提示「已拒绝」
   ✅ 状态变为「已下架」
```

---

## 🎨 UI设计

### 预览窗口布局

```
┌────────────────────────────────────┐
│  剧本预览                      ×    │
├────────────────────────────────────┤
│  📋 基本信息                        │
│  ┌────────┬────────┐               │
│  │标题：xxx│副标题：xxx│             │
│  │作者：xxx│类型：推理 │             │
│  └────────┴────────┘               │
│                                    │
│  📝 剧本描述                        │
│  [描述内容...]                      │
│                                    │
│  🏷️ 标签                           │
│  [标签1] [标签2] [标签3]            │
│                                    │
│  📦 JSON数据    [查看完整JSON]      │
│  角色数量：18                       │
│  数据大小：125.5 KB                │
│  角色预览（前5个）：                │
│  • 贵族 - 镇民                     │
│  • 渔夫 - 镇民                     │
│  ...                               │
├────────────────────────────────────┤
│           [关闭] [✓ 通过审核]       │
└────────────────────────────────────┘
```

---

## 💡 功能特点

### 1. 快速预览
- ✅ 无需进入编辑页面
- ✅ 一键查看所有信息
- ✅ 包含JSON数据预览

### 2. JSON数据展示
- ✅ 显示角色数量
- ✅ 显示数据大小
- ✅ 预览前5个角色
- ✅ 可查看完整JSON
- ✅ 支持复制JSON

### 3. 便捷审核
- ✅ 在预览窗口直接审核
- ✅ 一键通过/拒绝
- ✅ 自动刷新列表

### 4. 安全控制
- ✅ 只有待审核剧本显示审核按钮
- ✅ 通过后自动设置发布时间
- ✅ 拒绝后状态变为已下架

---

## 🔧 技术实现

### 数据格式处理

```javascript
// JSON数据可能是数组或字符串
getJsonRoleCount(jsonData) {
  // 自动判断类型并处理
  const data = typeof jsonData === 'string' ? JSON.parse(jsonData) : jsonData
  // 筛选角色（排除meta、fabled、jinxed等）
  return data.filter(item => {
    return item.team && !['fabled', 'a jinxed'].includes(item.team)
  }).length
}
```

### 角色预览

```javascript
getPreviewRoles(jsonData) {
  // 只显示前5个角色
  return jsonData
    .filter(item => item.team && !['fabled', 'a jinxed'].includes(item.team))
    .slice(0, 5)
}
```

---

## ✅ 完成清单

- [x] 添加预览按钮
- [x] 添加审核按钮
- [x] 添加拒绝按钮
- [x] 实现预览弹窗UI
- [x] 显示基本信息
- [x] 显示剧本描述
- [x] 显示标签
- [x] 预览JSON数据
- [x] 显示角色列表（前5个）
- [x] 查看完整JSON功能
- [x] 复制JSON功能
- [x] 通过审核功能
- [x] 拒绝审核功能
- [x] CSS样式美化

---

## 🎉 使用演示

### 管理员工作流程：

1. **查看待审核列表**
   ```
   剧本状态：选择「待审核」
   ```

2. **预览剧本**
   ```
   点击「预览」或「审核」按钮
   查看剧本详细信息
   ```

3. **审核决策**
   ```
   情况1：内容合格 → 点击「✓ 通过审核」
   情况2：内容不合格 → 关闭预览，点击「拒绝」
   ```

4. **后续操作**
   ```
   已发布：可以「下架」
   已下架：可以「上架」
   任何状态：可以「编辑」或「删除」
   ```

---

**功能版本**: v1.0.0  
**完成时间**: 2025年10月21日  
**状态**: ✅ 已完成，可以使用

