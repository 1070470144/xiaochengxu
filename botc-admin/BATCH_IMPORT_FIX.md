# 批量导入文件夹选择修复

## 🔧 问题描述

点击"选择文件夹"按钮没有反应，无法打开文件夹选择对话框。

## ✅ 修复方案

已将原来的 `<input>` + `<label>` 方式改为按钮触发动态创建 input 的方式。

---

## 🎯 修复内容

### 1. 界面改进

**修复前：**
```html
<input webkitdirectory @change="..." />
<label for="fileInput">选择文件夹</label>
```

**修复后：**
```html
<button @click="triggerFolderSelect">📂 选择文件夹</button>
<button @click="triggerFileSelect">📄 选择文件</button>
<text>（推荐选择文件夹，自动递归读取所有JSON）</text>
```

### 2. JavaScript改进

新增专门的文件夹选择方法：

```javascript
triggerFolderSelect() {
  const input = document.createElement('input')
  input.type = 'file'
  input.accept = '.json'
  input.webkitdirectory = true  // 启用文件夹选择
  input.directory = true         // 兼容性
  input.multiple = true          // 允许多选
  input.onchange = (e) => {
    this.handleFileSelect(e)
  }
  input.click()  // 触发点击
}
```

---

## 🚀 使用方法

### 方法1：选择文件夹（推荐）

```
1. 点击 "📂 选择文件夹" 按钮
2. 在弹出的对话框中选择包含JSON文件的文件夹
3. 点击"选择文件夹"或"打开"
4. 系统自动递归读取该文件夹及所有子文件夹中的JSON文件
5. 显示找到的所有JSON文件列表
```

**示例：**
```
选择文件夹：D:\xue\小程序\botc-miniprogram\static\官方已发行剧本

系统会自动找到：
- #暗流涌动.json
- #黯月初升.json
- #无上愉悦·汀.json
- #窃窃私语·汀.json

以及该文件夹下所有子文件夹中的JSON文件
```

### 方法2：选择多个文件

```
1. 点击 "📄 选择文件" 按钮
2. 在弹出的对话框中，按住 Ctrl（Windows）或 Cmd（Mac）
3. 点击选择多个JSON文件
4. 点击"打开"
5. 显示选中的文件列表
```

---

## 🔍 浏览器兼容性

### 支持的浏览器

| 浏览器 | 文件夹选择 | 文件多选 |
|--------|-----------|----------|
| Chrome | ✅ | ✅ |
| Edge | ✅ | ✅ |
| Firefox | ⚠️ 部分支持 | ✅ |
| Safari | ⚠️ 部分支持 | ✅ |

**注意：**
- Chrome 和 Edge 完全支持文件夹选择功能
- Firefox 和 Safari 对 `webkitdirectory` 的支持可能有限
- 如果文件夹选择不工作，请使用"选择文件"方式

### 推荐开发环境

```
✅ Chrome 浏览器（推荐）
✅ Edge 浏览器（推荐）
⚠️ Firefox（建议使用文件选择）
⚠️ Safari（建议使用文件选择）
```

---

## 📝 界面说明

### 新界面布局

```
┌──────────────────────────────────────┐
│  批量导入JSON剧本                      │
├──────────────────────────────────────┤
│  💡 支持选择多个JSON文件或整个文件夹   │
│  📁 支持递归读取子文件夹              │
│  📄 JSON文件格式请参考示例            │
│                                        │
│  [📂 选择文件夹] [📄 选择文件]        │
│  （推荐选择文件夹，自动递归读取所有JSON）│
│                                        │
│  已选择 4 个文件              [清空]   │
│  ┌────────────────────────────────┐   │
│  │ #暗流涌动.json       17.2 KB   │   │
│  │ #黯月初升.json       21.5 KB   │   │
│  │ #无上愉悦·汀.json    10.3 KB   │   │
│  │ #窃窃私语·汀.json    12.1 KB   │   │
│  └────────────────────────────────┘   │
│                                        │
│  [取消]  [开始导入]                   │
└──────────────────────────────────────┘
```

---

## ⚠️ 常见问题

### Q1: 点击按钮没有反应？

**可能原因：**
1. 浏览器不支持文件夹选择
2. 浏览器阻止了弹出窗口

**解决方法：**
1. 使用 Chrome 或 Edge 浏览器
2. 检查浏览器是否阻止了弹出窗口
3. 尝试使用"选择文件"方式

### Q2: 选择了文件夹但没有显示文件？

**可能原因：**
1. 文件夹中没有JSON文件
2. JSON文件扩展名不是 `.json`

**解决方法：**
1. 确认文件夹中有 `.json` 文件
2. 检查文件扩展名是否正确
3. 查看浏览器控制台是否有错误信息

### Q3: 只能选择文件，不能选择文件夹？

**可能原因：**
浏览器不支持 `webkitdirectory` 属性

**解决方法：**
使用"选择文件"方式，手动选择多个JSON文件

### Q4: 文件夹中有很多文件，选择后很慢？

**正常现象：**
- 系统需要遍历所有文件
- 会过滤出所有 `.json` 文件
- 文件越多，处理时间越长

**建议：**
- 如果文件夹中文件很多（>1000个），建议分批导入
- 或者只选择包含JSON的子文件夹

---

## 🎯 测试步骤

### 测试1：选择单个文件夹

```
1. 在 HBuilderX 中运行 botc-admin
2. 进入：血染钟楼管理 → 剧本管理
3. 点击 "📁 批量导入JSON"
4. 点击 "📂 选择文件夹"
5. 选择：D:\xue\小程序\botc-miniprogram\static\官方已发行剧本
6. 确认
7. 应该看到 4 个JSON文件
```

### 测试2：选择多个文件

```
1. 点击 "📄 选择文件"
2. 按住 Ctrl
3. 依次点击多个JSON文件
4. 点击"打开"
5. 应该看到选中的文件列表
```

### 测试3：导入流程

```
1. 选择文件后
2. 检查文件列表是否正确
3. 点击 "开始导入"
4. 观察进度条
5. 等待完成提示
6. 检查导入结果
```

---

## 🔄 如果还是不工作

### 终极方案：手动选择文件

如果文件夹选择功能在您的浏览器中不工作：

```
1. 使用文件管理器打开剧本文件夹
2. 全选所有JSON文件（Ctrl+A）
3. 在管理后台点击 "📄 选择文件"
4. 在弹出的对话框中，将选中的文件拖拽进去
5. 或者在对话框中手动全选
6. 点击"开始导入"
```

---

## ✅ 修复确认

修复后应该能：
- ✅ 点击"选择文件夹"按钮有响应
- ✅ 弹出文件夹选择对话框
- ✅ 选择后显示所有JSON文件
- ✅ 递归读取子文件夹
- ✅ 正常导入剧本

---

## 📞 技术支持

如果仍然无法使用，请提供：
1. 使用的浏览器名称和版本
2. 操作系统版本
3. 浏览器控制台的错误信息（F12 → Console）
4. 具体的操作步骤

---

**文件夹选择功能已修复，现在应该可以正常使用了！** 🎉

