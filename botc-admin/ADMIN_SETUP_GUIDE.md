# 血染钟楼管理后台使用指南

## 📋 概述

botc-admin 是基于 uni-admin 框架开发的 PC 网页端管理后台，用于管理血染钟楼小程序的业务数据。

---

## ✅ 已完成功能

### 1. 核心管理模块（3个）

#### **店铺认证审核**
- 📍 路径：`pages/botc/shop/verify-list.vue`
- 🎯 功能：
  - 查看店铺认证申请列表
  - 按审核状态筛选（待审核/已通过/已拒绝）
  - 按城市筛选
  - 查看店铺详细信息（Logo、图片、地址、联系方式、营业执照等）
  - 审核通过/拒绝
  - 填写拒绝原因

#### **拼车管理**
- 📍 路径：`pages/botc/carpool/list.vue`
- 🎯 功能：
  - 查看所有拼车房间
  - 按状态筛选（招募中/已满员/已确认/已结束等）
  - 查看拼车详情
  - 删除异常拼车

#### **帖子审核**
- 📍 路径：`pages/botc/post/audit-list.vue`
- 🎯 功能：
  - 查看所有社区帖子
  - 按状态筛选（正常/审核中/已隐藏/已删除）
  - 查看帖子详情（内容、图片、点赞数、评论数）
  - 隐藏/显示帖子
  - 删除违规帖子

### 2. 数据库表（已同步 11 个）
- ✅ botc-shops（店铺）
- ✅ botc-shop-reviews（店铺评价）
- ✅ botc-posts（帖子）
- ✅ botc-post-comments（评论）
- ✅ botc-post-likes（点赞）
- ✅ botc-carpool-rooms（拼车房间）
- ✅ botc-carpool-members（拼车成员）
- ✅ botc-scripts（剧本）
- ✅ botc-storyteller-profiles（说书人）
- ✅ botc-storyteller-reviews（说书人评价）
- ✅ botc-chat-messages（聊天消息）

### 3. 左侧菜单（已配置）
- ✅ 血染钟楼管理（父菜单）
  - 店铺认证审核
  - 拼车管理
  - 帖子审核

---

## 🚀 快速开始

### 步骤1：初始化数据库（5分钟）

1. 在 HBuilderX 中打开 `botc-admin` 项目
2. 右键 `uniCloud-aliyun/database/db_init.json` → **初始化云数据库**
3. 等待初始化完成

### 步骤2：导入业务菜单（2分钟）

1. 右键 `uniCloud-aliyun/database/botc-admin-menus.init_data.json`
2. 选择 **DB Schema - 初始化数据库数据**
3. 确认导入

### 步骤3：运行到浏览器（1分钟）

1. 点击 HBuilderX 顶部的 **运行 → 运行到浏览器 → Chrome**
2. 等待编译完成
3. 浏览器自动打开管理后台

### 步骤4：登录管理后台

#### 方式A：创建超级管理员（首次使用）
```
1. 访问注册页面（会自动跳转）
2. 填写：
   - 用户名：admin
   - 密码：admin123456（建议修改）
   - 邮箱/手机号
3. 点击"创建超级管理员"
```

#### 方式B：使用现有账号
```
1. 使用小程序端已注册的手机号登录
2. 需要在数据库中为该用户添加管理员权限：
   - 打开 uniCloud Web控制台
   - 进入 uni-id-users 表
   - 找到对应用户，修改 role 字段为 ["admin"]
```

---

## 📊 功能使用

### 1. 店铺认证审核

**操作流程：**
```
1. 左侧菜单 → 血染钟楼管理 → 店铺认证审核
2. 默认显示"待审核"的店铺
3. 点击"查看"按钮，查看店铺详细信息：
   - 店铺Logo和图片
   - 地址和联系方式
   - 营业执照照片
4. 审核操作：
   - 通过：点击"通过"按钮，店铺立即可在小程序中显示
   - 拒绝：点击"拒绝"→ 填写拒绝原因 → 确认
5. 筛选功能：
   - 切换审核状态标签查看不同状态的店铺
   - 选择城市进行地区筛选
```

### 2. 拼车管理

**操作流程：**
```
1. 左侧菜单 → 血染钟楼管理 → 拼车管理
2. 查看所有拼车房间列表
3. 点击"查看"按钮，查看详细信息：
   - 发起人、游戏时间、地点
   - 当前人数 / 需要人数
   - 联系方式
4. 管理操作：
   - 删除：删除异常或违规的拼车房间
5. 筛选功能：
   - 切换状态标签（招募中/已满员等）
```

### 3. 帖子审核

**操作流程：**
```
1. 左侧菜单 → 血染钟楼管理 → 帖子审核
2. 查看所有社区帖子
3. 点击"查看"按钮，查看详细信息：
   - 帖子内容和图片
   - 点赞数、评论数、浏览数
4. 审核操作：
   - 隐藏：隐藏违规帖子（用户不可见，但数据保留）
   - 显示：恢复已隐藏的帖子
   - 删除：软删除帖子（状态改为已删除）
5. 筛选功能：
   - 切换状态标签查看不同状态的帖子
```

---

## 🎨 界面说明

### PC 端布局

```
┌─────────────────────────────────────────┐
│  顶部导航栏（Logo、语言切换、主题、用户）  │
├────────┬────────────────────────────────┤
│        │                                │
│  左侧  │                                │
│  菜单  │         主内容区域              │
│        │    （数据表格、筛选、分页）      │
│        │                                │
└────────┴────────────────────────────────┘
```

### 核心组件

- **uni-table**：数据表格组件，支持排序、筛选、分页
- **uni-stat-tabs**：状态标签切换
- **uni-data-select**：下拉选择框
- **uni-pagination**：分页组件
- **uni-popup**：弹窗组件（查看详情）

---

## ⚙️ 配置说明

### 1. 修改 Logo
```javascript
// botc-admin/admin.config.js
navBar: {
  logo: '/static/logo.png',  // 替换为你的Logo
}
```

### 2. 添加新菜单

在 `uniCloud Web控制台` → `opendb-admin-menus` 表中添加记录：
```json
{
  "menu_id": "new-menu",
  "name": "新功能",
  "icon": "admin-icons-icon",
  "url": "/pages/botc/new/page",
  "sort": 104,
  "parent_id": "botc-manage",
  "enable": true
}
```

### 3. 数据库连接

管理后台使用的是 **uniCloud-aliyun**，与小程序端共享同一个云数据库，无需额外配置。

---

## 🔒 权限管理

### 内置角色

- **admin**：超级管理员，拥有所有权限
- 可在 uni-id-roles 表中自定义角色和权限

### 分配权限

1. 进入：系统管理 → 用户管理
2. 找到用户，点击"修改"
3. 分配角色和权限

---

## 📦 部署到服务器

### 编译为生产版本

```bash
# 在 HBuilderX 中
1. 点击 发行 → 网站-H5手机版
2. 选择目标目录（如 dist）
3. 等待编译完成
```

### 上传到服务器

```bash
# 方式1：使用FTP上传 dist 目录到服务器

# 方式2：使用Nginx部署
server {
    listen 80;
    server_name admin.yourdomain.com;
    root /var/www/botc-admin/dist;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

### 配置域名

在 `botc-admin/manifest.json` 中修改：
```json
"h5": {
  "router": {
    "mode": "hash",
    "base": "/admin/"  // 根据实际路径修改
  }
}
```

---

## 🛠️ 常见问题

### 1. 左侧菜单为空

**原因**：未初始化数据库或未导入菜单数据

**解决**：
1. 右键 `uniCloud-aliyun/database/db_init.json` → 初始化云数据库
2. 右键 `botc-admin-menus.init_data.json` → 初始化数据库数据

### 2. 无法登录

**原因**：未创建管理员账户

**解决**：
1. 访问注册页面创建超级管理员
2. 或在数据库中手动添加 role: ["admin"]

### 3. 数据表加载失败

**原因**：业务数据库表未同步

**解决**：
1. 检查 `botc-admin/uniCloud-aliyun/database/` 目录下是否有 `botc-*.schema.json` 文件
2. 如果没有，重新复制业务表文件

### 4. 编译报错

**原因**：依赖问题或HBuilderX版本过低

**解决**：
1. 更新 HBuilderX 到最新版本（≥ 3.6.0）
2. 重新编译项目

---

## 📈 后续扩展

### 可以添加的功能

1. **用户管理增强**
   - 用户等级调整
   - 用户封禁/解封
   - 用户行为日志

2. **数据统计**
   - 用户增长趋势
   - 拼车活跃度
   - 帖子发布统计

3. **说书人管理**
   - 说书人认证审核
   - 说书人评价管理
   - 剧本审核

4. **剧本管理**
   - 剧本库管理
   - 剧本分类
   - 剧本推荐

5. **系统配置**
   - 轮播图管理
   - 公告管理
   - 敏感词过滤

---

## 🎉 总结

✅ **核心功能已完成**：店铺审核、拼车管理、帖子审核

✅ **数据库已同步**：11个业务表全部可用

✅ **菜单已配置**：左侧导航清晰明了

✅ **开箱即用**：初始化数据库后直接使用

🚀 **下一步**：根据实际业务需求，扩展更多管理功能！

---

如有问题，请查阅：
- [uni-admin 官方文档](https://uniapp.dcloud.net.cn/uniCloud/admin)
- [uniCloud 开发文档](https://uniapp.dcloud.net.cn/uniCloud/)

