# 官方剧本批量导入指南

## 📋 支持的JSON格式

批量导入功能已完全适配官方血染钟楼剧本的JSON格式！

---

## 🎯 官方剧本JSON格式

### 结构说明

官方剧本JSON是一个**数组格式**，包含：

1. **元数据对象**（id为`"_meta"`）- 包含剧本基本信息
2. **角色对象列表** - 包含所有角色的详细信息

### 示例结构

```json
[
  {
    "id": "_meta",
    "name": "暗流涌动",
    "author": "The Pandemonium Institute",
    "description": "剧本描述...",
    "logo": "https://...",
    "townsfolkName": "镇民",
    "additional": [{
      "剧本介绍": "详细介绍..."
    }]
  },
  {
    "id": "1_82",
    "name": "乞丐",
    "team": "traveler",
    "ability": "你只能使用投票标记投票...",
    "image": "https://..."
  },
  {
    "id": "1_93",
    "name": "替罪羊",
    "team": "traveler",
    "ability": "如果你的阵营的一名玩家被处决...",
    "image": "https://..."
  }
  // ... 更多角色
]
```

---

## 🔄 自动字段映射

### 剧本元数据字段

| 官方字段 | 映射到 | 说明 |
|---------|--------|------|
| name | title | 剧本标题 |
| author | author | 作者 |
| description | description | 简要描述 |
| additional[0]['剧本介绍'] | description | 详细介绍（优先） |
| logo | cover_image | 封面图片URL |

### 角色信息处理

系统会自动：
- ✅ 统计角色数量
- ✅ 计算建议玩家人数
- ✅ 识别角色阵营（townsfolk/outsider/minion/demon）
- ✅ 保存完整角色列表

---

## 📊 智能数据处理

### 1. 玩家人数自动计算

根据角色列表自动计算：

```javascript
镇民数量 + 外来者数量 + 爪牙数量 + 恶魔数量 = 总角色数
建议玩家人数 = 总角色数 ± 5人
```

**示例：**
- 暗流涌动有13个基础角色
- 系统推断：5-15人

### 2. HTML标签自动清理

剧本描述中的HTML标签会自动处理：
- `<br>` → 换行符
- 其他HTML标签 → 移除
- 保留纯文本内容

### 3. 标签自动提取

从剧本介绍中自动提取标签：

**关键词映射：**
- "推理" → 推理标签
- "硬核" → 硬核标签
- "初学者" → 新手友好标签
- "复杂" → 进阶标签

### 4. 剧本类型自动判断

**官方剧本默认为推理类**
- 作者为 "The Pandemonium Institute" → 推理
- 作者为 "官方" → 推理
- 其他根据关键词判断

---

## 🚀 快速导入官方剧本

### 步骤1：准备文件

将官方剧本JSON文件放入一个文件夹，例如：

```
D:\官方剧本\
├── #暗流涌动.json
├── #黯月初升.json
├── #无上愉悦·汀.json
└── #窃窃私语·汀.json
```

### 步骤2：批量导入

```
1. 管理后台 → 血染钟楼管理 → 剧本管理

2. 点击 "📁 批量导入JSON"

3. 点击 "📂 选择文件夹"

4. 选择您的官方剧本文件夹

5. 系统自动识别所有JSON文件

6. 点击 "开始导入"

7. 等待导入完成
```

### 步骤3：查看结果

```
1. 筛选状态：待审核

2. 查看导入的剧本：
   - 暗流涌动 ✅
   - 黯月初升 ✅
   - 无上愉悦·汀 ✅
   - 窃窃私语·汀 ✅

3. 点击"编辑"查看详细信息

4. 点击"发布"让用户可见
```

---

## 📝 导入后的数据

### 基本信息

| 字段 | 示例数据 |
|------|----------|
| 标题 | 暗流涌动 |
| 作者 | The Pandemonium Institute |
| 类型 | 推理 |
| 难度 | 中等（默认） |
| 玩家人数 | 5-15人（自动计算） |
| 时长 | 180分钟（默认） |
| 状态 | 待审核 |

### 完整JSON数据

- ✅ 原始JSON数组完整保存在 `json_data` 字段
- ✅ 包含所有角色信息
- ✅ 可用于小程序端游戏功能
- ✅ 可导出查看

---

## 🎨 示例：导入"暗流涌动"

### 原始JSON（简化）

```json
[
  {
    "id": "_meta",
    "name": "暗流涌动",
    "author": "The Pandemonium Institute",
    "description": "乌云在鸦木布拉夫的天空中翻滚着...",
    "logo": "https://oss.gstonegames.com/.../暗流涌动.jpg",
    "additional": [{
      "剧本介绍": "《暗流涌动》是一场对恶魔长驱直入的狩猎..."
    }]
  },
  {
    "name": "乞丐",
    "team": "traveler",
    "ability": "..."
  }
  // ... 更多角色
]
```

### 导入后的数据

```javascript
{
  title: "暗流涌动",
  subtitle: "",
  author: "The Pandemonium Institute",
  script_type: 1,  // 推理
  difficulty: 2,   // 中等
  player_count: "5-15人",  // 自动计算
  duration: 180,
  description: "《暗流涌动》是一场对恶魔长驱直入的狩猎...",
  tags: ["推理", "新手友好"],  // 自动提取
  cover_image: "https://oss.gstonegames.com/.../暗流涌动.jpg",
  status: 0,  // 待审核
  json_data: [...],  // 完整原始数据
  // ... 其他统计字段
}
```

---

## 🔍 常见问题

### Q1: 为什么玩家人数是"5-15人"？

**A:** 系统根据角色数量自动推断：
- 统计 townsfolk + outsider + minion + demon
- 最小人数 = max(5, 角色总数)
- 最大人数 = min(15, 角色总数 + 5)

### Q2: 剧本描述太长怎么办？

**A:** 系统自动处理：
- 提取 `additional[0]['剧本介绍']` 作为完整描述
- 清理HTML标签
- 限制1000字符以内
- 完整内容保存在 `json_data` 中

### Q3: 如何查看完整的角色信息？

**A:** 两种方式：
1. 在管理后台编辑页面查看 `json_data` 字段
2. 在数据库中直接查看完整JSON

### Q4: 可以同时导入官方和自定义剧本吗？

**A:** 可以！
- 系统自动识别JSON格式
- 数组格式 → 官方剧本格式
- 对象格式 → 自定义剧本格式
- 混合导入完全支持

### Q5: 标签不准确怎么办？

**A:** 导入后可以手动编辑：
1. 找到导入的剧本
2. 点击"编辑"
3. 修改标签
4. 保存

---

## 📦 完整功能对比

### 官方剧本格式

| 功能 | 支持情况 | 说明 |
|------|----------|------|
| 数组格式解析 | ✅ | 自动识别 _meta |
| 元数据提取 | ✅ | name, author, description |
| 角色信息提取 | ✅ | 完整保存所有角色 |
| 玩家人数计算 | ✅ | 根据角色自动推断 |
| HTML清理 | ✅ | 移除所有HTML标签 |
| 标签提取 | ✅ | 从描述自动提取 |
| 封面图片 | ✅ | 从 logo 字段提取 |

### 自定义剧本格式

| 功能 | 支持情况 | 说明 |
|------|----------|------|
| 对象格式解析 | ✅ | 标准JSON对象 |
| 字段映射 | ✅ | 多种字段名识别 |
| 类型判断 | ✅ | 关键词智能判断 |
| 标签处理 | ✅ | 保留或自动提取 |

---

## 🎉 总结

批量导入功能现在**完全支持官方血染钟楼剧本格式**！

### 主要特性

1. ✅ **自动识别格式** - 数组或对象格式自动判断
2. ✅ **智能数据提取** - 元数据和角色信息完整保存
3. ✅ **玩家人数计算** - 根据角色自动推断
4. ✅ **HTML标签清理** - 自动转换为纯文本
5. ✅ **标签智能提取** - 从描述自动生成
6. ✅ **完整数据保留** - 原始JSON完整保存

### 支持的文件

- ✅ 官方发行剧本（数组格式）
- ✅ 自定义剧本（对象格式）
- ✅ 混合批量导入
- ✅ 文件夹递归读取

---

**现在可以一键导入所有官方剧本了！** 🎊

