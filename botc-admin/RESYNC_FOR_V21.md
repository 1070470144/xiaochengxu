# ğŸ”„ é‡æ–°åŒæ­¥è·å–v2.1è¯¦ç»†å†…å®¹

## ğŸ¯ é—®é¢˜

ç®¡ç†åå°è¯¦æƒ…é¡µçœ‹ä¸åˆ°10ä¸ªè¯¦ç»†å­—æ®µï¼ˆèƒŒæ™¯æ•…äº‹ã€èŒƒä¾‹ç­‰ï¼‰

## ğŸ” åŸå› 

å½“å‰æ•°æ®åº“ä¸­çš„"æ´—è¡£å¦‡"æ•°æ®æ˜¯ç”¨ **v2.0 ç‰ˆæœ¬**åŒæ­¥çš„ï¼Œåªæœ‰åŸºç¡€å†…å®¹ï¼Œæ²¡æœ‰ `role_detail` å­—æ®µã€‚

éœ€è¦ç”¨ **v2.1 ç‰ˆæœ¬**çš„äº‘å‡½æ•°é‡æ–°åŒæ­¥ï¼

---

## âœ… è§£å†³æ–¹æ¡ˆ

### Step 1: ä¸Šä¼ v2.1äº‘å‡½æ•°ï¼ˆå¿…é¡»ï¼ï¼‰

```bash
åœ¨ HBuilderX botc-admin é¡¹ç›®ï¼š

1. å³é”® wiki-admin-sync-all â†’ ä¸Šä¼ éƒ¨ç½²
   âœ… åŒ…å« parser-utils.js è§£æåº“

2. å³é”® wiki-admin-sync-single â†’ ä¸Šä¼ éƒ¨ç½²
   âœ… åŒ…å«è¯¦ç»†è§£æé€»è¾‘

3. ç­‰å¾…ä¸Šä¼ æˆåŠŸ
```

### Step 2: åˆ é™¤æ—§æ•°æ®

```bash
æ–¹æ³•Aï¼ˆæ¨èï¼‰ï¼šåœ¨ç®¡ç†åå°åˆ é™¤
1. ç™¾ç§‘ç®¡ç† â†’ æ‰¾åˆ°"æ´—è¡£å¦‡"
2. ç‚¹å‡»"åˆ é™¤"æŒ‰é’®
3. ç¡®è®¤åˆ é™¤

æ–¹æ³•Bï¼šåœ¨æ•°æ®åº“åˆ é™¤
1. uniCloudæ§åˆ¶å° â†’ wiki_entries
2. æ‰¾åˆ°"æ´—è¡£å¦‡"è®°å½•
3. åˆ é™¤
```

### Step 3: é‡æ–°åŒæ­¥

```bash
1. åˆ·æ–°ç®¡ç†åå°ï¼ˆCtrl + F5ï¼‰

2. è¿›å…¥"ç™¾ç§‘åŒæ­¥"

3. åœ¨"å•ä¸ªåŒæ­¥"è¾“å…¥ï¼š
   https://clocktower-wiki.gstonegames.com/index.php?title=æ´—è¡£å¦‡

4. ç‚¹å‡»"åŒæ­¥"

5. ç­‰å¾…10-20ç§’

6. åº”è¯¥æç¤º"åŒæ­¥æˆåŠŸï¼ˆæ–°å¢ï¼‰"
```

### Step 4: éªŒè¯æ•°æ®

```bash
1. uniCloudæ§åˆ¶å° â†’ wiki_entries

2. ç‚¹å‡»"æ´—è¡£å¦‡"è®°å½•

3. æŸ¥çœ‹JSONæ•°æ®ï¼Œåº”è¯¥åŒ…å«ï¼š
   {
     "title": "æ´—è¡£å¦‡",
     "role_detail": {           â† ğŸ†• æ–°å­—æ®µ
       "background_story": "...", âœ…
       "ability": "...",          âœ…
       "introduction": [...],     âœ…
       "examples": [...],         âœ…
       "mechanics": [...],        âœ…
       "reminder_tokens": [...],  âœ…
       "rule_details": [...],     âœ…
       "tips_and_tricks": [...],  âœ…
       "bluff_tips": [...],       âœ…
       "character_info": {...}    âœ…
     }
   }
```

### Step 5: æŸ¥çœ‹è¯¦æƒ…é¡µ

```bash
1. ç®¡ç†åå° â†’ ç™¾ç§‘ç®¡ç†

2. ç‚¹å‡»"æ´—è¡£å¦‡"çš„"æŸ¥çœ‹"æŒ‰é’®

3. åº”è¯¥çœ‹åˆ°ï¼š
   ğŸ“– èƒŒæ™¯æ•…äº‹
   ğŸ¯ è§’è‰²èƒ½åŠ›
   ğŸ“ è§’è‰²ç®€ä»‹ï¼ˆXæ®µï¼‰
   ğŸ“Œ èŒƒä¾‹ï¼ˆXæ¡ï¼‰
   âš™ï¸ è¿ä½œæ–¹å¼ï¼ˆXæ­¥ï¼‰
   ğŸ·ï¸ æç¤ºæ ‡è®°ï¼ˆXä¸ªï¼‰
   ğŸ“œ è§„åˆ™ç»†èŠ‚ï¼ˆXæ¡ï¼‰
   ğŸ’¡ æç¤ºä¸æŠ€å·§ï¼ˆXæ¡ï¼‰
   ğŸ­ ä¼ªè£…æ–¹æ³•ï¼ˆXæ¡ï¼‰
   â„¹ï¸ è§’è‰²ä¿¡æ¯
```

---

## ğŸ¯ æ£€æŸ¥äº‘å‡½æ•°æ˜¯å¦åŒ…å«è§£æé€»è¾‘

### æŸ¥çœ‹äº‘å‡½æ•°æ–‡ä»¶

```bash
botc-admin/uniCloud-aliyun/cloudfunctions/wiki-admin-sync-all/
â”œâ”€â”€ index.js âœ… ï¼ˆåº”è¯¥åŒ…å« const parserUtils = require('./parser-utils.js')ï¼‰
â”œâ”€â”€ parser-utils.js âœ… ï¼ˆè§£æå·¥å…·åº“ï¼‰
â””â”€â”€ package.json
```

### éªŒè¯ä»£ç 

åœ¨ `index.js` ä¸­åº”è¯¥æœ‰ï¼š

```javascript
// å¼•å…¥è§£æå·¥å…·
const parserUtils = require('./parser-utils.js');

// åœ¨ parseMediaWikiPage å‡½æ•°ä¸­
if (entryType === 'role') {
  role_detail = parserUtils.parseRoleDetail(html);
}

// è¿”å›æ•°æ®ä¸­åŒ…å«
return {
  // ...
  role_detail: role_detail  // ğŸ†• v2.1
};
```

---

## ğŸ› å¦‚æœé‡æ–°åŒæ­¥åè¿˜æ˜¯æ²¡æœ‰

### æ£€æŸ¥1ï¼šæŸ¥çœ‹äº‘å‡½æ•°æ—¥å¿—

```bash
HBuilderXï¼š
å³é”® wiki-admin-sync-single â†’ äº‘å‡½æ•°æ—¥å¿—

æŸ¥æ‰¾ï¼š
- [parseRoleDetail] å¼€å§‹è¯¦ç»†è§£æ
- èƒŒæ™¯æ•…äº‹: âœ“
- è§’è‰²èƒ½åŠ›: âœ“
- ...

å¦‚æœçœ‹åˆ°è¿™äº›æ—¥å¿—ï¼Œè¯´æ˜è§£æåœ¨æ‰§è¡Œ
```

### æ£€æŸ¥2ï¼šæŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°

```bash
F12 â†’ Console

æŸ¥æ‰¾ï¼š
- æ˜¯å¦æœ‰é”™è¯¯
- parser-utils æ˜¯å¦åŠ è½½æˆåŠŸ
```

### æ£€æŸ¥3ï¼šæ‰‹åŠ¨æŸ¥çœ‹æ•°æ®åº“

```bash
uniCloudæ§åˆ¶å° â†’ wiki_entries â†’ æ´—è¡£å¦‡

æŸ¥çœ‹åŸå§‹JSONï¼Œæ˜¯å¦æœ‰ role_detail å­—æ®µ
```

---

## ğŸ’¡ å¿«é€Ÿæµ‹è¯•

åœ¨ç®¡ç†åå°ï¼ŒF12æ§åˆ¶å°è¿è¡Œï¼š

```javascript
// æŸ¥çœ‹æœ€æ–°åŒæ­¥çš„æ•°æ®
const db = uniCloud.database();
db.collection('wiki_entries')
  .where({ title: 'æ´—è¡£å¦‡' })
  .get()
  .then(res => {
    const data = res.result?.data || res.data || [];
    if (data[0]) {
      console.log('=== æ´—è¡£å¦‡æ•°æ® ===');
      console.log('role_detailå­˜åœ¨:', !!data[0].role_detail);
      console.log('role_detailå†…å®¹:', data[0].role_detail);
    }
  });
```

**çœ‹çœ‹æ§åˆ¶å°è¾“å‡º role_detail æ˜¯å¦å­˜åœ¨ï¼Ÿ**

---

## ğŸ¯ ç°åœ¨è¯·æ“ä½œ

1. âœ… **ç¡®è®¤å·²ä¸Šä¼ v2.1äº‘å‡½æ•°**ï¼ˆåŒ…å«parser-utils.jsï¼‰
2. âœ… **åˆ é™¤æ—§çš„"æ´—è¡£å¦‡"æ•°æ®**
3. âœ… **é‡æ–°åŒæ­¥**
4. âœ… **æŸ¥çœ‹æ•°æ®åº“æ˜¯å¦æœ‰role_detail**
5. âœ… **å‘Šè¯‰æˆ‘ç»“æœ**

æ ¹æ®ç»“æœæˆ‘ä¼šç»§ç»­å¸®æ‚¨è°ƒè¯•ï¼ğŸ”§

---

**é‡è¦æç¤º**: å¿…é¡»é‡æ–°åŒæ­¥æ‰èƒ½è·å¾—è¯¦ç»†å†…å®¹ï¼

