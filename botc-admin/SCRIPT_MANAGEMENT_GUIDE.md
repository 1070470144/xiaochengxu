# 管理端剧本管理功能说明

## 📋 功能概述

管理端新增剧本管理功能，允许管理员对小程序端的剧本进行全面管理，包括添加、编辑、审核、发布、下架和删除操作。

---

## 🎯 功能模块

### 1. 剧本列表页面（list.vue）

**路径：** `/pages/botc/script/list`

**功能：**
- ✅ 数据表格展示所有剧本
- ✅ 多维度筛选（状态、类型、难度、关键词）
- ✅ 分页加载
- ✅ 快速操作（编辑、发布、下架、删除）
- ✅ 数据统计（浏览量、下载量、评分等）

**表格字段：**
| 字段 | 说明 |
|------|------|
| ID | 剧本唯一标识（显示后6位）|
| 剧本标题 | 主标题 + 副标题 |
| 作者 | 剧本作者 |
| 类型 | 推理/娱乐 |
| 难度 | 简单/中等/困难/专家 |
| 玩家人数 | 例如：5-7人 |
| 时长 | 预计游戏时长（分钟）|
| 状态 | 待审核/已发布/已下架 |
| 评分 | 平均评分 + 评分人数 |
| 浏览量 | 剧本被查看次数 |
| 下载量 | 剧本被下载次数 |
| 发布时间 | 剧本发布时间 |
| 操作 | 编辑、发布/下架、删除 |

**筛选功能：**
- 剧本状态：全部 / 待审核 / 已发布 / 已下架
- 剧本类型：全部 / 推理 / 娱乐
- 难度等级：全部 / 简单 / 中等 / 困难 / 专家
- 关键词搜索：剧本名称或作者

---

### 2. 剧本编辑页面（edit.vue）

**路径：** `/pages/botc/script/edit`

**功能：**
- ✅ 新增剧本
- ✅ 编辑现有剧本
- ✅ 表单验证
- ✅ 数据自动保存

**表单字段：**

#### 基本信息
- **剧本标题**（必填，最多100字符）
- **副标题**（选填，最多200字符）
- **作者**（选填，最多50字符）
- **剧本类型**（必填，推理/娱乐）
- **难度等级**（简单/中等/困难/专家）
- **玩家人数**（例如：5-7人）
- **预计时长**（分钟，数字类型）

#### 详细描述
- **剧本描述**（最多1000字符）
- **标签**（多标签输入，回车添加）

#### 封面图片
- **封面图**（单图上传）

#### 发布设置
- **状态**（待审核/已发布/已下架）
- **是否精选**（开关按钮）

#### 统计数据（仅编辑时显示）
- 浏览量
- 下载量
- 收藏量
- 评分 + 评分人数

---

## 🔧 操作流程

### 添加新剧本

```
1. 进入管理后台
2. 左侧菜单 → 血染钟楼管理 → 剧本管理
3. 点击右上角 "+ 添加剧本" 按钮
4. 填写剧本信息
5. 选择状态（待审核/已发布）
6. 点击 "保存" 按钮
7. 自动返回列表页
```

### 编辑剧本

```
1. 在剧本列表中找到目标剧本
2. 点击 "编辑" 按钮
3. 修改剧本信息
4. 点击 "保存" 按钮
5. 自动返回列表页
```

### 发布剧本

```
1. 找到状态为 "待审核" 的剧本
2. 点击 "发布" 按钮
3. 确认操作
4. 剧本状态变为 "已发布"
5. 同时记录发布时间
6. 小程序端用户可以看到该剧本
```

### 下架剧本

```
1. 找到状态为 "已发布" 的剧本
2. 点击 "下架" 按钮
3. 确认操作
4. 剧本状态变为 "已下架"
5. 小程序端用户无法看到该剧本
```

### 重新上架

```
1. 找到状态为 "已下架" 的剧本
2. 点击 "上架" 按钮
3. 确认操作
4. 剧本状态变为 "已发布"
5. 小程序端用户可以再次看到该剧本
```

### 删除剧本

```
1. 找到要删除的剧本
2. 点击 "删除" 按钮
3. 确认操作
4. 剧本永久删除（不可恢复）
```

---

## 🎨 状态说明

### 剧本状态

| 状态 | 说明 | 小程序端可见 | 标签颜色 |
|------|------|--------------|----------|
| 待审核 | 新上传的剧本，等待审核 | ❌ 否 | 🟡 黄色 |
| 已发布 | 已审核通过并发布 | ✅ 是 | 🟢 绿色 |
| 已下架 | 已下架或违规 | ❌ 否 | 🔴 红色 |

### 剧本类型

| 类型 | 说明 | 标签颜色 |
|------|------|----------|
| 推理 | 推理类剧本 | 🔵 蓝色 |
| 娱乐 | 娱乐类剧本 | 🟢 绿色 |

### 难度等级

| 难度 | 说明 | 标签颜色 |
|------|------|----------|
| 简单 | 新手友好 | 🟢 绿色 |
| 中等 | 适合有经验玩家 | 🔵 蓝色 |
| 困难 | 需要较高技巧 | 🟡 黄色 |
| 专家 | 高难度挑战 | 🔴 红色 |

---

## 📊 数据统计

管理端显示以下统计数据（仅查看，不可编辑）：

- **浏览量**：剧本详情页被访问次数
- **下载量**：剧本被下载次数
- **收藏量**：用户收藏该剧本的次数
- **评分**：用户评分的平均值（0-5分）
- **评分人数**：参与评分的用户数量

---

## 🔍 筛选和搜索

### 筛选功能

支持以下筛选条件组合：
- 剧本状态
- 剧本类型
- 难度等级
- 关键词搜索

**示例：**
```
筛选条件：
- 状态：已发布
- 类型：推理
- 难度：困难

结果：显示所有已发布的困难推理剧本
```

### 搜索功能

支持按剧本标题或作者进行模糊搜索。

---

## 📤 部署步骤

### 步骤1：上传页面文件

在 HBuilderX 中，页面文件已自动包含在项目中，无需单独上传。

### 步骤2：更新菜单配置

```
1. 打开 uniCloud Web 控制台
   https://unicloud.dcloud.net.cn/

2. 选择服务空间
   mp-1e0f6630-18c8-400c-99ff-761aea3a4e83

3. 进入 "数据库" → "opendb-admin-menus"

4. 手动添加菜单项（如果自动初始化失败）：
   {
     "menu_id": "botc-script-manage",
     "name": "剧本管理",
     "icon": "admin-icons-book",
     "url": "/pages/botc/script/list",
     "sort": 104,
     "parent_id": "botc-manage",
     "permission": [],
     "enable": true,
     "create_date": 1702800000000
   }

5. 刷新管理后台页面
```

### 步骤3：运行管理后台

```
HBuilderX → 运行 → 运行到浏览器
```

---

## 🎯 功能亮点

### 1. 完整的CRUD操作
- ✅ Create - 添加新剧本
- ✅ Read - 查看剧本列表和详情
- ✅ Update - 编辑剧本信息
- ✅ Delete - 删除剧本

### 2. 灵活的状态管理
- 待审核 → 已发布
- 已发布 → 已下架
- 已下架 → 已发布（重新上架）

### 3. 多维度筛选
- 状态、类型、难度组合筛选
- 关键词模糊搜索
- 快速定位目标剧本

### 4. 数据可视化
- 评分星级显示
- 状态颜色标签
- 统计数据一目了然

### 5. 表单验证
- 必填字段验证
- 长度限制检查
- 数据格式验证

---

## ⚠️ 注意事项

### 数据安全

1. **删除操作不可恢复**
   - 删除前会弹出二次确认
   - 删除后数据永久丢失
   - 建议先下架，确认无误后再删除

2. **状态切换**
   - 发布操作会记录发布时间
   - 下架不会删除发布时间
   - 重新上架使用原发布时间

3. **数据完整性**
   - creator_id 默认为 "admin"
   - 发布时自动记录 published_at
   - created_at 和 updated_at 自动维护

### 权限说明

当前版本所有管理员都有完整权限：
- ✅ 查看所有剧本
- ✅ 添加新剧本
- ✅ 编辑任意剧本
- ✅ 发布/下架剧本
- ✅ 删除剧本

如需更细粒度的权限控制，可以在菜单配置中添加 `permission` 字段。

---

## 🚀 后续扩展建议

### 1. 批量操作
- 批量发布
- 批量下架
- 批量删除

### 2. 导入导出
- Excel 批量导入剧本
- 剧本数据导出

### 3. 版本管理
- 剧本修订历史
- 版本对比
- 回滚功能

### 4. 审核流程
- 多级审核
- 审核意见记录
- 审核日志

### 5. 数据分析
- 剧本热度排行
- 下载趋势图表
- 用户评分分布

---

## 📝 数据库表结构

**表名：** `botc-scripts`

关键字段：
- `title` - 剧本标题（必填）
- `subtitle` - 副标题
- `author` - 作者
- `script_type` - 类型（1-推理，2-娱乐）
- `difficulty` - 难度（1-4）
- `player_count` - 玩家人数
- `duration` - 时长（分钟）
- `description` - 描述
- `tags` - 标签数组
- `cover_image` - 封面图URL
- `status` - 状态（0-待审核，1-已发布，2-已下架）
- `is_featured` - 是否精选
- `rating` - 评分（0-5）
- `rating_count` - 评分人数
- `view_count` - 浏览量
- `download_count` - 下载量
- `favorite_count` - 收藏量
- `creator_id` - 创建者ID
- `published_at` - 发布时间
- `created_at` - 创建时间
- `updated_at` - 更新时间

---

## ✨ 总结

管理端剧本管理功能提供了：
- ✅ 完整的剧本管理能力
- ✅ 灵活的状态控制
- ✅ 强大的筛选和搜索
- ✅ 直观的数据展示
- ✅ 友好的操作体验

**帮助管理员高效管理小程序端的剧本内容！** 🎉

