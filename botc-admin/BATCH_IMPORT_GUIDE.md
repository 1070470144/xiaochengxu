# 剧本批量导入功能使用指南

## 📋 功能概述

管理后台新增剧本批量导入功能，支持一键上传整个文件夹中的所有JSON剧本文件，自动递归读取子文件夹。

---

## 🚀 使用步骤

### 步骤1：进入剧本管理

```
管理后台 → 血染钟楼管理 → 剧本管理
```

### 步骤2：点击批量导入按钮

点击右上角的 **"📁 批量导入JSON"** 按钮

### 步骤3：选择文件

有两种方式：

#### 方式A：选择整个文件夹（推荐）

```
1. 点击 "📂 选择文件夹" 按钮
2. 在弹出的文件选择对话框中，选择包含剧本JSON的文件夹
3. 浏览器会自动递归读取该文件夹及所有子文件夹中的JSON文件
4. 显示已选择的文件列表
```

#### 方式B：选择多个文件

```
1. 点击 "📄 选择文件" 按钮
2. 在弹出的文件选择对话框中，按住 Ctrl/Cmd 键选择多个JSON文件
3. 点击确定
4. 显示已选择的文件列表
```

### 步骤4：开始导入

```
1. 检查已选择的文件列表
2. 点击 "开始导入" 按钮
3. 等待导入完成（会显示实时进度）
4. 查看导入结果统计
```

---

## 📄 JSON文件格式要求

### 最小格式

```json
{
  "title": "剧本标题"
}
```

### 推荐格式

```json
{
  "title": "剧本标题",
  "subtitle": "副标题",
  "author": "作者名称",
  "description": "剧本描述",
  "player_count": "5-7人",
  "duration": 180,
  "difficulty": 2,
  "script_type": 1,
  "tags": ["推理", "欢乐", "新手友好"],
  "cover_image": "https://example.com/cover.jpg"
}
```

### 完整字段说明

| 字段 | 类型 | 必填 | 说明 | 示例 |
|------|------|------|------|------|
| title | String | ✅ | 剧本标题 | "时间回溯" |
| subtitle | String | ❌ | 副标题 | "一个关于时间的故事" |
| author | String | ❌ | 作者 | "张三" |
| description | String | ❌ | 剧本描述 | "这是一个悬疑推理剧本..." |
| player_count | String | ❌ | 玩家人数 | "5-7人" |
| duration | Number | ❌ | 时长（分钟） | 180 |
| difficulty | Number | ❌ | 难度（1-4） | 2 |
| script_type | Number | ❌ | 类型（1-推理, 2-娱乐） | 1 |
| tags | Array | ❌ | 标签数组 | ["推理", "欢乐"] |
| cover_image | String | ❌ | 封面图URL | "https://..." |

**其他字段：**
- JSON中的其他所有字段都会保存在 `json_data` 字段中
- 可以在剧本详情页面查看完整的JSON数据

---

## 🎯 字段映射规则

### 自动字段映射

如果JSON中使用了不同的字段名，系统会自动尝试映射：

| 目标字段 | 可识别的字段名 |
|---------|---------------|
| title | title, name |
| author | author, creator |
| description | description, desc |
| player_count | player_count, playerCount, players |
| duration | duration, time |
| cover_image | cover_image, cover |

### 自动类型判断

如果JSON中没有 `script_type` 字段，系统会根据内容自动判断：

**推理类关键词：**
- 推理、侦探、悬疑、谋杀、案件、凶手

**娱乐类关键词：**
- 娱乐、欢乐、搞笑、轻松、派对、团建

---

## 📊 导入过程

### 实时进度显示

导入过程中会显示：
- 当前进度：X / Y
- 进度条：百分比显示
- 成功数量
- 失败数量

### 导入结果

导入完成后会显示：
- ✅ 成功导入的数量
- ❌ 失败的数量
- 📋 详细的错误信息（如果有失败的）

---

## ⚠️ 注意事项

### 文件要求

1. **文件格式**
   - 必须是 `.json` 后缀的文件
   - 必须是有效的JSON格式
   - 编码建议使用 UTF-8

2. **文件内容**
   - 至少包含 `title` 字段
   - 其他字段可选，但建议尽量完整

3. **文件大小**
   - 建议单个文件不超过5MB
   - 批量导入建议一次不超过100个文件

### 数据处理

1. **自动设置的字段**
   - `status`: 默认为 0（待审核）
   - `is_featured`: 默认为 false
   - `creator_id`: 设置为 "batch-import"
   - `created_at`: 当前时间
   - `updated_at`: 当前时间
   - 所有统计字段：初始为 0

2. **不会重复导入**
   - 相同标题的剧本会被视为新剧本
   - 建议导入前先检查数据库中是否已存在

3. **原始数据保留**
   - 完整的JSON数据会保存在 `json_data` 字段
   - 可以用于后续数据分析或恢复

---

## 🔍 常见问题

### Q1: 选择文件夹后没有反应？

**可能原因：**
- 浏览器不支持文件夹选择
- 文件夹中没有JSON文件

**解决方法：**
- 使用Chrome或Edge浏览器
- 或改用"选择文件"方式，手动选择JSON文件

### Q2: 导入失败怎么办？

**检查步骤：**
1. 打开浏览器控制台（F12）查看详细错误
2. 检查JSON文件格式是否正确
3. 检查是否有必填字段缺失
4. 检查网络连接是否正常

### Q3: 可以导入多少个文件？

**建议：**
- 单次导入不超过100个文件
- 如果文件较多，可以分批导入
- 每个文件大小不超过5MB

### Q4: 导入后在哪里查看？

**查看步骤：**
1. 在剧本管理列表页刷新
2. 筛选状态选择"待审核"
3. 查看新导入的剧本
4. 点击"编辑"可以修改信息
5. 点击"发布"让用户可见

### Q5: 如何批量发布？

**当前方法：**
1. 在列表页逐个点击"发布"按钮
2. 或者在数据库中批量修改status字段

**未来功能：**
- 计划添加批量操作功能
- 可以一键批量发布或下架

---

## 📂 示例文件结构

### 推荐的文件夹结构

```
剧本JSON/
├── 城市赛专属剧本/
│   ├── 剧本1.json
│   ├── 剧本2.json
│   └── 剧本3.json
├── 推理剧本/
│   ├── 新手向/
│   │   ├── 简单剧本1.json
│   │   └── 简单剧本2.json
│   └── 进阶向/
│       ├── 复杂剧本1.json
│       └── 复杂剧本2.json
└── 娱乐剧本/
    ├── 欢乐向.json
    └── 团建向.json
```

**系统会递归读取所有子文件夹中的JSON文件！**

---

## 📝 示例JSON文件

### 示例1：最小JSON

```json
{
  "title": "上帝缺席"
}
```

### 示例2：推荐JSON

```json
{
  "title": "上帝缺席",
  "subtitle": "一个关于信仰的故事",
  "author": "MtyJ & 小黑",
  "description": "这是一个深度推理剧本，探讨信仰与真相的关系...",
  "player_count": "7-9人",
  "duration": 240,
  "difficulty": 3,
  "script_type": 1,
  "tags": ["推理", "硬核", "还原"],
  "cover_image": "https://example.com/covers/god-absent.jpg",
  "roles": [
    {"name": "角色A", "description": "角色A的描述"},
    {"name": "角色B", "description": "角色B的描述"}
  ],
  "story": "剧本故事背景...",
  "custom_field": "自定义字段也会被保存"
}
```

### 示例3：娱乐剧本

```json
{
  "title": "欢乐派对",
  "author": "李四",
  "description": "适合团建和聚会的轻松剧本",
  "player_count": "5-8人",
  "duration": 120,
  "difficulty": 1,
  "script_type": 2,
  "tags": ["娱乐", "欢乐", "新手友好", "团建"]
}
```

---

## 🎉 功能优势

### 1. 批量处理
- ✅ 一次性导入整个文件夹
- ✅ 自动递归子文件夹
- ✅ 大大节省时间

### 2. 智能解析
- ✅ 自动字段映射
- ✅ 自动类型判断
- ✅ 容错处理

### 3. 实时反馈
- ✅ 进度条显示
- ✅ 实时统计
- ✅ 详细错误信息

### 4. 数据保留
- ✅ 原始JSON完整保存
- ✅ 可以后续查看
- ✅ 可以数据分析

---

## 🔄 后续计划

### 即将推出的功能

1. **批量操作**
   - 批量发布
   - 批量下架
   - 批量删除

2. **导入预览**
   - 导入前预览数据
   - 可以调整字段映射
   - 可以选择性导入

3. **导入模板**
   - 提供标准JSON模板
   - 支持Excel导入转换
   - 支持从其他平台导入

4. **导入历史**
   - 查看导入记录
   - 可以回滚导入
   - 统计分析

---

## ✨ 总结

批量导入功能让您能够：
- 📁 一键导入整个文件夹
- 🔄 自动递归读取子文件夹
- 🎯 智能解析JSON内容
- 📊 实时显示导入进度
- ✅ 快速上架大量剧本

**大大提高了剧本管理效率！** 🎊

