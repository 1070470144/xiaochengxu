# 🖼️ 剧本图片设计方案

## 📋 设计概念

每个剧本包含两种类型的图片：

### 1. 自动生成的预览图（1张）
- **字段名**：`preview_image`
- **数量**：1张（自动生成）
- **格式**：SVG转base64
- **来源**：系统根据JSON自动生成
- **内容**：剧本标题、作者、所有角色、能力描述
- **用途**：剧本详情页展示、快速预览

### 2. 用户上传的图片（0-3张）
- **字段名**：`user_images`（数组）
- **数量**：0-3张（可选）
- **格式**：图片URL数组
- **来源**：用户或管理员上传
- **内容**：剧本介绍图、玩法说明图、示意图等
- **用途**：详情页轮播、补充说明

---

## 🗄️ 数据库Schema设计

```json
{
  "preview_image": {
    "bsonType": "string",
    "description": "自动生成的预览图（SVG base64格式）"
  },
  "user_images": {
    "bsonType": "array",
    "description": "用户上传的图片（0-3张）",
    "maxItems": 3,
    "items": {
      "bsonType": "string"
    }
  },
  "cover_image": {
    "bsonType": "string",
    "description": "封面图URL（已废弃，保留用于兼容）"
  }
}
```

---

## 📊 数据示例

```javascript
{
  "_id": "xxx",
  "title": "传奇之夜",
  "author": "Sui染钟楼",
  
  // 自动生成的预览图（1张）
  "preview_image": "data:image/svg+xml;base64,PHN2ZyB3aWR0...",
  
  // 用户上传的图片（0-3张）
  "user_images": [
    "https://xxx.com/image1.jpg",
    "https://xxx.com/image2.jpg",
    "https://xxx.com/image3.jpg"
  ],
  
  // 旧字段（兼容）
  "cover_image": "https://xxx.com/cover.jpg"
}
```

---

## 🎯 使用场景

### 自动生成的预览图（preview_image）
✅ **剧本详情页主图**：默认显示  
✅ **剧本列表缩略图**：快速预览  
✅ **分享卡片**：生成分享图  
✅ **下载保存**：用户可下载预览图  

### 用户上传的图片（user_images）
✅ **详情页轮播图**：展示多角度说明  
✅ **玩法说明**：图文结合介绍  
✅ **剧情示意图**：帮助理解剧本  
✅ **规则图示**：可视化规则说明  

---

## 🔄 生成和上传流程

### 管理端添加剧本：
```
1. 上传JSON文件 → json_data字段
2. （可选）上传0-3张图片 → user_images数组
3. 点击保存
4. 系统自动生成预览图 → preview_image字段
5. 全部保存到数据库
```

### 批量导入：
```
1. 选择多个JSON文件
2. 系统解析每个JSON
3. 自动生成预览图 → preview_image字段
4. user_images为空数组（可后续编辑补充）
5. 保存到数据库
```

---

## 💡 设计优势

### 1. 完整性
- ✅ 自动生成：确保每个剧本都有预览图
- ✅ 用户补充：允许添加个性化图片
- ✅ 灵活性：0-3张可选

### 2. 用户体验
- ✅ 统一性：自动生成的预览图格式统一
- ✅ 丰富性：可添加多张说明图片
- ✅ 便捷性：JSON上传自动生成，无需额外操作

### 3. 技术实现
- ✅ 无需云存储：preview_image用base64存储
- ✅ 支持云存储：user_images可存储URL
- ✅ 向后兼容：保留cover_image字段

---

## 🎨 前端展示设计

### 剧本详情页（建议）

```
┌─────────────────────────────┐
│                             │
│  自动生成的预览图             │
│  （preview_image）           │
│                             │
└─────────────────────────────┘

如果有 user_images：
┌─────────────────────────────┐
│  [图1] [图2] [图3]           │
│   ●     ○     ○  （轮播）    │
└─────────────────────────────┘
```

### 优先级
1. **主图**：优先显示 `preview_image`（自动生成）
2. **轮播**：如果有 `user_images`，在下方轮播展示
3. **兼容**：如果是旧数据只有 `cover_image`，也能正常显示

---

## ✅ 当前实现状态

### 已完成
- [x] 数据库Schema添加 `user_images` 字段
- [x] 数据库Schema添加 `preview_image` 字段
- [x] 管理端支持上传0-3张图片
- [x] 自动生成预览图功能
- [x] 批量导入生成预览图
- [x] 单个添加生成预览图

### 待完成
- [ ] 上传Schema到云端
- [ ] 上传云函数
- [ ] 测试功能
- [ ] 用户端展示多张图片（如需要）

---

## 📝 字段说明

| 字段名 | 类型 | 说明 | 来源 | 数量 |
|--------|------|------|------|------|
| preview_image | string | 自动生成的预览图 | 系统自动 | 1张 |
| user_images | array | 用户上传的图片 | 用户/管理员 | 0-3张 |
| cover_image | string | 封面图（废弃） | 旧数据兼容 | 0-1张 |

---

## ✅ 符合设计

**当前实现完全符合你的设计概念：**
- ✅ 1张自动生成的图片（preview_image）
- ✅ 0-3张用户上传的图片（user_images）
- ✅ 都保存在数据库中
- ✅ 管理端可以操作

---

**功能版本**: v2.0.0  
**更新时间**: 2025年10月21日  
**状态**: ✅ 设计完成，符合需求

