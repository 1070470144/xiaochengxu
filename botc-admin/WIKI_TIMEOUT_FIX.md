# 🔧 网络超时和解析失败问题修复

## 🐛 遇到的问题

1. **request:fail timeout** - 网络请求超时
2. **无法提取标题** - 正则匹配失败
3. **index.js 和 index.obj.js 冲突** - 已解决 ✅

---

## ✅ 已修复内容

### 修复1：删除文件冲突
- ✅ 已删除 `wiki-admin-sync-single/index.js`
- ✅ 只保留 `index.obj.js`

### 修复2：增加超时时间
- ✅ 从 15秒 → 30秒
- ✅ 云函数配置超时从 60秒 → 120秒

### 修复3：多种方式提取标题
- ✅ 方式1：匹配 `id="firstHeading"`
- ✅ 方式2：匹配 `class="firstHeading"`
- ✅ 方式3：匹配任意 `<h1>` 标签
- ✅ 方式4：从URL中提取标题

---

## 🚀 立即操作

### Step 1: 上传修复后的云函数

```bash
HBuilderX → botc-admin 项目：

1. 右键 wiki-admin-sync-single → 上传部署
   （index.js已删除，只有index.obj.js）

2. 右键 wiki-admin-sync-all → 上传部署
   （已优化超时和解析逻辑）

3. 等待上传完成
```

### Step 2: 测试同步

```bash
1. 刷新管理后台（Ctrl + F5）
2. 进入"百科同步"
3. 在"单个同步"输入：
   https://clocktower-wiki.gstonegames.com/index.php?title=洗衣妇
4. 点击"同步"
5. 等待最多30秒
6. 应该成功！✅
```

---

## 🔍 如果还是超时

### 可能原因：

1. **网络问题** - 云函数无法访问钟楼百科网站
2. **防火墙** - 云服务空间网络限制
3. **网站响应慢** - 钟楼百科服务器响应慢

### 解决方案：

#### 方案A：重试几次
```bash
网络问题可能是临时的
多点几次"同步"按钮
可能就成功了
```

#### 方案B：换个URL试试
```bash
试试其他页面：
https://clocktower-wiki.gstonegames.com/index.php?title=厨师
```

#### 方案C：查看云函数日志
```bash
HBuilderX → 右键 wiki-admin-sync-single → 云函数日志

查看：
- 是否发起了HTTP请求
- HTTP响应状态
- 获取的HTML长度
```

---

## 📊 优化后的配置

### 超时配置
| 项目 | 之前 | 现在 | 提升 |
|------|------|------|------|
| HTTP请求超时 | 15秒 | 30秒 | +100% |
| 云函数超时 | 60秒 | 120秒 | +100% |

### 解析增强
- ✅ 4种方式提取标题
- ✅ 详细的日志输出
- ✅ 更好的错误提示

---

## 🎯 下一步

请先：
1. ✅ 重新上传两个云函数
2. ✅ 测试单个同步
3. ✅ 告诉我是成功还是失败
4. ✅ 如果失败，提供云函数日志

我会继续帮您解决！🔧

---

**修复时间**: 2025年10月17日  
**状态**: ✅ 已优化超时和解析逻辑

