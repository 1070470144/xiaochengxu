{
  "bsonType": "object",
  "description": "血染钟楼社区帖子表",
  "required": ["user_id", "content", "script_id"],
  "permission": {
    "read": true,
    "create": "auth.uid != null",
    "update": "doc.user_id == auth.uid",
    "delete": "doc.user_id == auth.uid"
  },
  "properties": {
    "_id": {
      "description": "帖子ID"
    },
    "user_id": {
      "bsonType": "string",
      "description": "发布者ID",
      "foreignKey": "uni-id-users._id"
    },
    "script_id": {
      "bsonType": "string",
      "description": "关联剧本ID（必选）",
      "foreignKey": "botc-scripts._id",
      "errorMessage": {
        "required": "必须选择一个剧本"
      }
    },
    "content": {
      "bsonType": "string",
      "description": "帖子内容",
      "trim": "both",
      "minLength": 1,
      "maxLength": 5000,
      "errorMessage": {
        "minLength": "帖子内容不能为空",
        "maxLength": "帖子内容不能超过5000字"
      }
    },
    "images": {
      "bsonType": "array",
      "description": "图片URL数组",
      "items": {
        "bsonType": "string"
      },
      "maxItems": 9,
      "errorMessage": {
        "maxItems": "最多上传9张图片"
      }
    },
    "type": {
      "bsonType": "int",
      "description": "帖子类型：1-普通 2-拼车分享 3-剧本推荐 4-游戏心得",
      "enum": [1, 2, 3, 4],
      "defaultValue": 1
    },
    "related_id": {
      "bsonType": "string",
      "description": "关联ID（关联拼车房间、剧本等）"
    },
    "tags": {
      "bsonType": "array",
      "description": "标签",
      "items": {
        "bsonType": "string"
      },
      "maxItems": 5
    },
    "location": {
      "bsonType": "string",
      "description": "发布地点",
      "maxLength": 100
    },
    "view_count": {
      "bsonType": "int",
      "description": "浏览数",
      "defaultValue": 0
    },
    "like_count": {
      "bsonType": "int",
      "description": "点赞数",
      "defaultValue": 0
    },
    "comment_count": {
      "bsonType": "int",
      "description": "评论数",
      "defaultValue": 0
    },
    "share_count": {
      "bsonType": "int",
      "description": "分享数",
      "defaultValue": 0
    },
    "is_top": {
      "bsonType": "bool",
      "description": "是否置顶",
      "defaultValue": false
    },
    "is_hot": {
      "bsonType": "bool",
      "description": "是否热门",
      "defaultValue": false
    },
    "status": {
      "bsonType": "int",
      "description": "状态：0-已删除 1-正常 2-审核中 3-已隐藏",
      "enum": [0, 1, 2, 3],
      "defaultValue": 1
    },
    "created_at": {
      "bsonType": "timestamp",
      "description": "发布时间",
      "forceDefaultValue": {
        "$env": "now"
      }
    },
    "updated_at": {
      "bsonType": "timestamp",
      "description": "更新时间"
    }
  }
}

