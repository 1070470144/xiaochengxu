{
  "bsonType": "object",
  "description": "血染钟楼剧本表",
  "required": ["title", "status"],
  "properties": {
    "_id": {
      "description": "剧本ID"
    },
    "title": {
      "bsonType": "string",
      "description": "剧本标题",
      "maxLength": 100,
      "errorMessage": {
        "required": "剧本标题不能为空",
        "maxLength": "剧本标题不能超过100个字符"
      }
    },
    "subtitle": {
      "bsonType": "string", 
      "description": "副标题",
      "maxLength": 200
    },
    "author": {
      "bsonType": "string",
      "description": "作者",
      "maxLength": 50
    },
    "cover_image": {
      "bsonType": "string",
      "description": "封面图URL"
    },
    "description": {
      "bsonType": "string",
      "description": "剧本描述",
      "maxLength": 1000
    },
    "player_count": {
      "bsonType": "string",
      "description": "玩家人数（如：5-7人）",
      "maxLength": 20
    },
    "script_type": {
      "bsonType": "int",
      "description": "剧本类型：1-推理，2-娱乐",
      "enum": [1, 2],
      "defaultValue": 1
    },
    "difficulty": {
      "bsonType": "int",
      "description": "难度：1-简单，2-中等，3-困难，4-专家",
      "minimum": 1,
      "maximum": 4
    },
    "duration": {
      "bsonType": "int",
      "description": "预计时长（分钟）",
      "minimum": 30,
      "maximum": 600
    },
    "tags": {
      "bsonType": "array",
      "description": "标签数组",
      "items": {
        "bsonType": "string"
      }
    },
    "json_url": {
      "bsonType": "string",
      "description": "剧本JSON文件URL"
    },
    "json_data": {
      "description": "剧本JSON内容（JSON字符串格式）"
    },
    "creator_id": {
      "bsonType": "string",
      "description": "上传者ID",
      "foreignKey": "uni-id-users._id",
      "errorMessage": {
        "required": "上传者不能为空"
      }
    },
    "status": {
      "bsonType": "int",
      "description": "状态：0-待审核，1-已发布，2-已下架",
      "defaultValue": 0,
      "minimum": 0,
      "maximum": 2,
      "errorMessage": {
        "required": "状态不能为空"
      }
    },
    "view_count": {
      "bsonType": "int",
      "description": "浏览量",
      "defaultValue": 0,
      "minimum": 0
    },
    "download_count": {
      "bsonType": "int",
      "description": "下载量",
      "defaultValue": 0,
      "minimum": 0
    },
    "share_count": {
      "bsonType": "int",
      "description": "分享量",
      "defaultValue": 0,
      "minimum": 0
    },
    "favorite_count": {
      "bsonType": "int",
      "description": "收藏量",
      "defaultValue": 0,
      "minimum": 0
    },
    "comment_count": {
      "bsonType": "int",
      "description": "评论量",
      "defaultValue": 0,
      "minimum": 0
    },
    "rating": {
      "bsonType": "double",
      "description": "评分（0-5分）",
      "defaultValue": 0,
      "minimum": 0,
      "maximum": 5
    },
    "rating_count": {
      "bsonType": "int",
      "description": "评分人数",
      "defaultValue": 0,
      "minimum": 0
    },
    "is_featured": {
      "bsonType": "bool",
      "description": "是否精选",
      "defaultValue": false
    },
    "heat_score": {
      "bsonType": "int",
      "description": "热度分数（基于帖子、评论、点赞等计算）",
      "defaultValue": 0,
      "minimum": 0
    },
    "heat_updated_at": {
      "bsonType": "timestamp",
      "description": "热度更新时间"
    },
    "published_at": {
      "bsonType": "timestamp",
      "description": "发布时间"
    },
    "created_at": {
      "bsonType": "timestamp",
      "description": "创建时间",
      "forceDefaultValue": {
        "$env": "now"
      }
    },
    "updated_at": {
      "bsonType": "timestamp",
      "description": "更新时间",
      "forceDefaultValue": {
        "$env": "now"
      }
    }
  },
  "permission": {
    "read": true,
    "create": "auth.uid != null",
    "update": "auth.uid == doc.creator_id",
    "delete": "auth.uid == doc.creator_id"
  }
}
