# 💬 Chat 前端适配测试指南

## 🎯 测试目的

验证 Chat 模块前端适配后的所有功能是否正常工作。

---

## 📋 测试清单

### 准备工作

- [ ] 确保 `chat` 云对象已上传
- [ ] 至少准备 2 个测试账号（用于互相聊天）
- [ ] 清理浏览器缓存
- [ ] 启动项目：`npm run dev`

---

## 🔍 详细测试步骤

### 测试 1：聊天列表页 (`pages/chat/list/list.vue`)

**路径：** `/pages/chat/list/list`

#### 1.1 加载会话列表
**步骤：**
1. 登录账号 A
2. 进入聊天列表页
3. 观察页面加载

**预期结果：**
- ✅ 显示加载动画
- ✅ 加载完成后显示会话列表
- ✅ 如果没有会话，显示空状态
- ✅ 控制台无错误

#### 1.2 显示会话信息
**检查内容：**
- [ ] 头像显示正确
- [ ] 昵称显示正确
- [ ] 最后一条消息显示
- [ ] 时间显示正确
- [ ] 未读数量显示（如果有）

#### 1.3 下拉刷新
**步骤：**
1. 在聊天列表页下拉
2. 观察刷新动画
3. 释放后观察数据更新

**预期结果：**
- ✅ 显示刷新动画
- ✅ 数据重新加载
- ✅ 刷新完成提示

#### 1.4 上拉加载更多
**步骤：**
1. 滚动到列表底部
2. 继续上拉
3. 观察加载更多

**预期结果：**
- ✅ 显示加载动画
- ✅ 加载更多会话
- ✅ 如果没有更多数据，显示提示

#### 1.5 点击进入聊天
**步骤：**
1. 点击任意会话
2. 观察页面跳转

**预期结果：**
- ✅ 正确跳转到聊天详情页
- ✅ 传递正确的 user_id

---

### 测试 2：聊天详情页 (`pages/chat/detail/detail.vue`)

**路径：** `/pages/chat/detail/detail?user_id=xxx`

#### 2.1 页面初始化
**步骤：**
1. 从聊天列表进入聊天详情
2. 观察页面加载

**预期结果：**
- ✅ 显示对方用户信息（头像、昵称）
- ✅ 加载历史消息（如果有）
- ✅ 自动滚动到最新消息
- ✅ 消息自动标记为已读

#### 2.2 发送文本消息
**步骤：**
1. 在输入框输入文本：`测试消息 ${new Date().toLocaleTimeString()}`
2. 点击发送按钮
3. 观察消息发送

**预期结果：**
- ✅ 输入框清空
- ✅ 消息立即显示在列表
- ✅ 消息显示在右侧（我的消息）
- ✅ 显示发送时间
- ✅ 自动滚动到底部
- ✅ 控制台无错误

#### 2.3 发送表情
**步骤：**
1. 点击表情按钮
2. 选择一个表情
3. 点击发送

**预期结果：**
- ✅ 表情正确插入输入框
- ✅ 发送后表情正确显示
- ✅ 表情在消息中渲染正确

#### 2.4 接收消息（模拟）
**步骤：**
1. 使用账号 B 登录
2. 给账号 A 发送消息
3. 切换回账号 A 的聊天详情页
4. 等待或刷新页面

**预期结果：**
- ✅ 收到的消息显示在左侧
- ✅ 显示对方头像和昵称
- ✅ 消息内容正确
- ✅ 时间显示正确

#### 2.5 标记已读
**步骤：**
1. 有未读消息时进入聊天详情
2. 观察标记已读效果

**预期结果：**
- ✅ 进入页面后自动标记已读
- ✅ 返回聊天列表后未读数清零
- ✅ 控制台显示"消息标记为已读成功"

#### 2.6 首次聊天（无 conversation_id）
**步骤：**
1. 从他人资料页点击"💬 私聊"
2. 这是第一次与该用户聊天
3. 发送第一条消息

**预期结果：**
- ✅ 成功创建会话
- ✅ 获取并保存 conversation_id
- ✅ 消息发送成功
- ✅ 后续消息使用相同的 conversation_id

#### 2.7 返回列表更新
**步骤：**
1. 在聊天详情发送几条消息
2. 返回聊天列表
3. 观察列表更新

**预期结果：**
- ✅ 最后一条消息更新
- ✅ 时间更新
- ✅ 该会话置顶（如果逻辑支持）

---

### 测试 3：社区聊天列表 (`pages/community/chat/list/list.vue`)

**路径：** `/pages/community/chat/list/list`

#### 3.1 加载会话列表
**步骤：**
1. 进入社区聊天列表
2. 观察页面加载

**预期结果：**
- ✅ 显示所有会话
- ✅ 显示用户头像、昵称
- ✅ 显示最后消息
- ✅ 显示未读数量

#### 3.2 搜索好友
**步骤：**
1. 在搜索框输入好友昵称
2. 观察搜索结果

**预期结果：**
- ✅ 实时过滤会话列表
- ✅ 匹配昵称的会话显示
- ✅ 不匹配的会话隐藏

#### 3.3 清除搜索
**步骤：**
1. 点击搜索框的清除按钮
2. 观察列表恢复

**预期结果：**
- ✅ 搜索关键词清空
- ✅ 显示所有会话

#### 3.4 下拉刷新
**步骤：**
1. 下拉页面
2. 观察刷新

**预期结果：**
- ✅ 数据重新加载
- ✅ 显示最新会话

#### 3.5 点击进入聊天
**步骤：**
1. 点击任意会话
2. 观察跳转

**预期结果：**
- ✅ 正确跳转到聊天详情页
- ✅ 传递正确的 user_id

---

### 测试 4：他人资料页 (`pages/user/other-profile/other-profile.vue`)

**路径：** `/pages/user/other-profile/other-profile?userId=xxx`

#### 4.1 显示私聊按钮
**步骤：**
1. 进入他人资料页
2. 观察私聊按钮

**预期结果：**
- ✅ 显示 "💬 私聊" 按钮
- ✅ 按钮样式正确（渐变色）

#### 4.2 点击私聊按钮
**步骤：**
1. 点击 "💬 私聊" 按钮
2. 观察页面跳转

**预期结果：**
- ✅ 显示"跳转中..."提示
- ✅ 正确跳转到聊天详情页
- ✅ 传递正确的 user_id
- ✅ 可以正常发送消息

#### 4.3 未登录处理
**步骤：**
1. 退出登录
2. 点击 "💬 私聊" 按钮

**预期结果：**
- ✅ 跳转到登录页
- ✅ 提示需要登录

---

## 🔄 完整流程测试

### 场景 1：完整的聊天流程

**参与者：** 账号 A、账号 B

**步骤：**

1. **账号 A：**
   - [ ] 进入他人资料页（账号 B）
   - [ ] 点击 "💬 私聊"
   - [ ] 发送消息："你好，账号 B"
   - [ ] 观察消息显示在右侧

2. **账号 B：**
   - [ ] 刷新或重新进入聊天列表
   - [ ] 看到来自账号 A 的新消息
   - [ ] 未读数显示为 1
   - [ ] 点击进入聊天详情
   - [ ] 看到账号 A 的消息
   - [ ] 回复："你好，账号 A"

3. **账号 A：**
   - [ ] 刷新聊天详情页
   - [ ] 看到账号 B 的回复
   - [ ] 继续发送几条消息
   - [ ] 测试发送表情

4. **两个账号：**
   - [ ] 返回聊天列表
   - [ ] 观察会话显示正确
   - [ ] 最后消息更新
   - [ ] 时间显示正确

---

### 场景 2：多人聊天列表

**步骤：**

1. 与至少 3 个不同用户聊天
2. 返回聊天列表
3. 检查：
   - [ ] 所有会话都显示
   - [ ] 最新消息排在前面（如果支持）
   - [ ] 未读数正确显示
   - [ ] 头像和昵称正确

---

### 场景 3：未读消息处理

**步骤：**

1. **账号 B：** 给账号 A 发送 3 条消息
2. **账号 A：**
   - [ ] 进入聊天列表
   - [ ] 看到未读数为 3
   - [ ] 点击进入聊天详情
   - [ ] 观察消息自动标记为已读
   - [ ] 返回聊天列表
   - [ ] 未读数清零

---

## 🐛 边界情况测试

### 1. 未登录状态
**步骤：**
- 退出登录
- 尝试访问聊天列表
- 尝试点击私聊按钮

**预期：**
- ✅ 跳转到登录页
- ✅ 提示需要登录

### 2. 网络错误
**步骤：**
- 关闭网络
- 尝试发送消息
- 尝试加载聊天列表

**预期：**
- ✅ 显示错误提示
- ✅ 不会崩溃
- ✅ 可以重试

### 3. 空数据
**步骤：**
- 使用没有聊天记录的新账号
- 进入聊天列表

**预期：**
- ✅ 显示空状态
- ✅ 提示文案正确

### 4. 对方不存在
**步骤：**
- 使用一个不存在的 user_id
- 尝试进入聊天详情

**预期：**
- ✅ 显示错误提示
- ✅ 或显示"用户不存在"

### 5. 特殊字符和表情
**步骤：**
- 发送包含特殊字符的消息：`<script>alert("test")</script>`
- 发送长文本消息（1000字）
- 发送连续多个表情

**预期：**
- ✅ 特殊字符正确转义
- ✅ 长文本正确显示
- ✅ 表情正确渲染

---

## 📊 测试结果记录

### 测试环境
- **测试日期：** ___________
- **测试人员：** ___________
- **浏览器：** ___________
- **设备：** ___________

### 测试结果

| 测试项 | 通过 | 失败 | 备注 |
|-------|------|------|------|
| 聊天列表加载 | ☐ | ☐ | |
| 聊天详情加载 | ☐ | ☐ | |
| 发送消息 | ☐ | ☐ | |
| 标记已读 | ☐ | ☐ | |
| 社区聊天列表 | ☐ | ☐ | |
| 他人资料私聊 | ☐ | ☐ | |
| 下拉刷新 | ☐ | ☐ | |
| 上拉加载 | ☐ | ☐ | |
| 搜索功能 | ☐ | ☐ | |
| 未读数显示 | ☐ | ☐ | |
| 边界情况处理 | ☐ | ☐ | |

### 已发现的问题

| # | 问题描述 | 严重程度 | 状态 |
|---|---------|---------|------|
| 1 | | | |
| 2 | | | |
| 3 | | | |

---

## ✅ 验收标准

**所有以下条件都满足才能通过验收：**

- [ ] 所有功能测试项通过
- [ ] 边界情况正确处理
- [ ] 无控制台错误
- [ ] 无页面崩溃
- [ ] 用户体验流畅
- [ ] 性能良好（加载时间 < 2秒）

---

## 🎯 下一步

**测试通过后：**
1. [ ] 删除旧的 Chat 云函数
2. [ ] 更新项目文档
3. [ ] 继续下一个模块开发

**如果测试失败：**
1. [ ] 记录问题详情
2. [ ] 分析原因
3. [ ] 修复问题
4. [ ] 重新测试

---

_创建时间：2025-11-04_  
_用于：Chat 模块前端适配验收测试_

