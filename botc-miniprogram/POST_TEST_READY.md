# 🧪 Post 云对象测试页面就绪

## ✅ 测试页面已完成

**Post 测试页签已添加到 `script-test.vue`！**

---

## 🎯 访问方式

### URL 访问
```
http://localhost:5173/#/pages/test/script-test
```

### 快捷入口
打开 `测试页面快捷入口.html` 文件，点击对应链接

---

## 📋 测试内容

Post 测试页签包含 **6 个测试功能**：

| # | 功能 | 方法 | 需要登录 |
|---|------|------|---------|
| 1 | 获取帖子列表 | `getList` | ❌ |
| 2 | 发布帖子 | `create` | ✅ |
| 3 | 获取帖子详情 | `getDetail` | ❌ |
| 4 | 点赞/取消点赞 | `toggleLike` | ✅ |
| 5 | 举报帖子 | `report` | ✅ |
| 6 | 删除帖子 | `delete` | ✅ |

---

## 🧪 测试步骤

### 准备工作

1. **上传 Post 云对象**
   - 在 HBuilderX 中右键 `post` 文件夹
   - 选择"上传云对象"
   - 等待上传完成

2. **启动项目**
   ```bash
   npm run dev
   ```

3. **确保已登录**
   - 访问登录页面进行登录
   - 或在测试页面查看登录状态

---

### 1️⃣ 获取帖子列表

**步骤：**
1. 切换到 **📝 Post** 页签
2. 设置查询参数：
   - 页码：1
   - 每页数量：10
   - 帖子类型：可选（全部/普通/活动/求助）
   - 用户ID：可选（查看指定用户的帖子）
   - 排序方式：最新/热门/关注（关注需登录）
3. 点击"获取帖子列表"

**预期结果：**
- ✅ 显示帖子列表
- ✅ 包含用户信息
- ✅ 返回总数和分页信息

---

### 2️⃣ 发布帖子

**步骤：**
1. **⚠️ 确保已登录**
2. 输入帖子信息：
   - 剧本ID：（必填，可从剧本列表获取）
   - 帖子内容：（必填，1-5000字）
   - 标签：用逗号分隔，如 "测试,云对象"
   - 位置：可选
   - 帖子类型：普通/活动/求助
3. 点击"发布帖子"

**预期结果：**
- ✅ 发布成功
- ✅ 返回帖子ID
- ✅ 自动填充到详情和点赞ID输入框

**注意：**
- 内容会经过敏感词过滤
- 标签最多5个
- 剧本必须存在

---

### 3️⃣ 获取帖子详情

**步骤：**
1. 输入帖子ID（可使用发布后自动填充的ID）
2. 点击"获取详情"

**预期结果：**
- ✅ 显示帖子完整信息
- ✅ 包含用户信息
- ✅ 包含评论列表
- ✅ 显示点赞状态（已登录时）
- ✅ 浏览数自动 +1

---

### 4️⃣ 点赞/取消点赞

**步骤：**
1. **⚠️ 确保已登录**
2. 输入帖子ID
3. 点击"点赞/取消"

**预期结果：**
- ✅ 首次点击：点赞成功
- ✅ 再次点击：取消点赞
- ✅ 返回最新点赞数

**测试场景：**
- 对同一帖子多次点赞/取消
- 查看点赞数变化

---

### 5️⃣ 举报帖子

**步骤：**
1. **⚠️ 确保已登录**
2. 输入帖子ID
3. 选择举报原因：
   - 垃圾广告
   - 违法违规
   - 辱骂攻击
   - 色情低俗
   - 其他
4. 输入详细描述（可选）
5. 点击"提交举报"

**预期结果：**
- ✅ 举报成功
- ✅ 返回当前举报次数
- ✅ 同一用户不能重复举报
- ✅ 3次举报自动隐藏帖子
- ✅ 5次举报永久封禁帖子

**测试自动处理：**
- 使用多个账号举报同一帖子
- 观察3次和5次举报后的状态变化

---

### 6️⃣ 删除帖子

**步骤：**
1. **⚠️ 确保已登录**
2. 输入帖子ID（必须是自己发布的）
3. 点击"删除帖子"

**预期结果：**
- ✅ 删除成功（软删除）
- ✅ 只能删除自己的帖子
- ✅ 删除后帖子不可见

**权限测试：**
- 尝试删除他人的帖子（应失败）
- 删除不存在的帖子（应提示不存在）

---

## 🎬 完整测试流程

### 流程 1：发布→详情→点赞→删除

```
1. 登录系统
2. 发布一条测试帖子
   → 记录返回的 post_id
3. 查看帖子详情
   → 确认内容正确
   → 浏览数 = 1
4. 点赞该帖子
   → 点赞数 +1
   → isLiked = true
5. 再次点赞（取消）
   → 点赞数 -1
   → isLiked = false
6. 删除该帖子
   → 删除成功
7. 再次查看详情
   → 应提示"帖子已删除"
```

### 流程 2：列表查询

```
1. 获取全部帖子列表（time排序）
2. 切换到 hot 排序
3. 使用 userId 筛选
4. 测试分页功能
```

### 流程 3：举报处理

```
1. 账号A 发布帖子
2. 账号B 举报（1次）
3. 账号C 举报（2次）
4. 账号D 举报（3次）
   → 帖子自动隐藏
5. 账号E 举报（4次）
6. 账号F 举报（5次）
   → 帖子永久封禁
```

---

## ⚠️ 注意事项

### 数据准备

1. **剧本数据**
   - 需要至少1个剧本
   - 可从 Script 页签上传测试剧本

2. **用户账号**
   - 需要登录才能发布、点赞、举报、删除
   - 测试举报功能需要多个账号

### 常见问题

**Q: 发布失败，提示"剧本不存在"？**
A: 先在 Script 页签上传一个测试剧本，记录剧本ID

**Q: 发布失败，提示内容违规？**
A: 检查内容是否包含敏感词，尝试修改内容

**Q: 删除失败，提示"没有权限"？**
A: 只能删除自己发布的帖子，确认帖子是当前账号发布的

**Q: 关注排序无数据？**
A: 需要先关注一些用户，且这些用户有发布帖子

---

## 📊 测试检查清单

### 功能测试
- [ ] 获取列表（全部类型、全部排序）
- [ ] 发布帖子（各种类型）
- [ ] 获取详情（包含评论）
- [ ] 点赞和取消点赞
- [ ] 举报（各种原因）
- [ ] 删除自己的帖子

### 边界测试
- [ ] 空参数测试
- [ ] 不存在的帖子ID
- [ ] 超长内容（>5000字）
- [ ] 超多图片（>9张）
- [ ] 超多标签（>5个）
- [ ] 重复举报
- [ ] 删除他人帖子

### 权限测试
- [ ] 未登录状态访问
- [ ] 发布需要登录
- [ ] 点赞需要登录
- [ ] 举报需要登录
- [ ] 删除需要登录且是作者

---

## 📝 测试结果记录

### 测试环境
- **日期：** ___________
- **测试人：** ___________
- **云对象版本：** 1.0.0

### 测试结果

| 功能 | 通过 | 失败 | 备注 |
|-----|------|------|------|
| 获取列表 | ☐ | ☐ | |
| 发布帖子 | ☐ | ☐ | |
| 获取详情 | ☐ | ☐ | |
| 点赞/取消 | ☐ | ☐ | |
| 举报帖子 | ☐ | ☐ | |
| 删除帖子 | ☐ | ☐ | |

---

## 🎯 下一步

**测试通过后：**

1. **前端适配**
   - 查找使用 post 云函数的页面
   - 替换为云对象调用

2. **删除旧云函数**
   - `post-list`
   - `post-create`
   - `post-detail`
   - `post-like`
   - `post-report`

3. **继续开发下一个模块**
   - Collection
   - Storyteller
   - Shop
   - Wiki
   - System

---

**🎉 Post 测试页面已就绪！开始测试吧！** 🚀

_创建时间：2025-11-04_

