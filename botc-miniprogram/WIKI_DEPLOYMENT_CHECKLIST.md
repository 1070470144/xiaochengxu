# 血染百科功能 - 部署检查清单

## 📋 部署前准备

### ✅ 环境检查
- [ ] HBuilderX 已安装（推荐3.0+版本）
- [ ] 微信开发者工具已安装
- [ ] uniCloud云服务空间已创建
- [ ] 已登录uniCloud账号

### ✅ 代码检查
- [ ] 所有云函数文件已创建
- [ ] 所有Schema文件已创建
- [ ] 小程序页面文件已修改/创建
- [ ] 代码无语法错误

---

## 🚀 部署步骤

### 第一步：上传云函数（预计3分钟）

#### 1.1 上传 wiki-parse-url
```bash
1. 在 HBuilderX 中展开项目
2. 找到 uniCloud-aliyun/cloudfunctions/wiki-parse-url
3. 右键 → 上传部署
4. 等待上传完成（首次会安装cheerio依赖，需1-2分钟）
5. 看到"上传成功"提示
```
- [ ] wiki-parse-url 上传成功

#### 1.2 上传 wiki-search
```bash
1. 右键 wiki-search
2. 选择"上传部署"
3. 等待上传完成
```
- [ ] wiki-search 上传成功

#### 1.3 上传 wiki-detail
```bash
1. 右键 wiki-detail
2. 选择"上传部署"
3. 等待上传完成
```
- [ ] wiki-detail 上传成功

#### 1.4 验证云函数
```bash
1. 打开 uniCloud Web控制台
2. 进入"云函数"
3. 确认3个云函数都显示"已部署"状态
4. 查看部署时间是否为刚才
```
- [ ] 3个云函数全部部署成功

---

### 第二步：创建数据库集合（预计5分钟）

#### 2.1 创建 wiki_entries 集合
```bash
1. 打开 uniCloud Web控制台
2. 点击"云数据库"
3. 点击"新建集合"
4. 集合名称输入：wiki_entries
5. 点击"确定"创建
```
- [ ] wiki_entries 集合已创建

#### 2.2 导入 wiki_entries Schema
```bash
1. 点击刚创建的 wiki_entries 集合
2. 点击"DB Schema"标签
3. 点击"导入Schema"按钮
4. 打开文件：uniCloud-aliyun/database/wiki_entries.schema.json
5. 复制所有内容
6. 粘贴到Schema编辑器
7. 点击"保存"
```
- [ ] wiki_entries Schema 已导入

#### 2.3 创建 wiki_favorites 集合
```bash
重复步骤2.1-2.2
集合名：wiki_favorites
Schema：wiki_favorites.schema.json
```
- [ ] wiki_favorites 集合已创建
- [ ] wiki_favorites Schema 已导入

#### 2.4 创建 wiki_search_history 集合
```bash
重复步骤2.1-2.2
集合名：wiki_search_history
Schema：wiki_search_history.schema.json
```
- [ ] wiki_search_history 集合已创建
- [ ] wiki_search_history Schema 已导入

#### 2.5 配置数据库权限
```bash
1. 在每个集合中点击"权限"标签
2. 设置读写权限：
   - .read: true
   - .create: auth.uid != null
   - .update: false
   - .delete: false
3. 点击"保存"
```
- [ ] wiki_entries 权限已配置
- [ ] wiki_favorites 权限已配置
- [ ] wiki_search_history 权限已配置

---

### 第三步：配置小程序（预计2分钟）

#### 3.1 检查pages.json配置
```bash
1. 打开 pages.json
2. 确认包含以下路由：
   - pages/tools/wiki/wiki
   - pages/tools/wiki/detail (新增)
3. 如果没有detail路由，添加：
```

```json
{
  "path": "pages/tools/wiki/detail",
  "style": {
    "navigationBarTitleText": "百科详情",
    "enablePullDownRefresh": false
  }
}
```
- [ ] pages.json 已配置

#### 3.2 检查uni_modules
```bash
确认项目中已安装 uni-popup 组件
如果没有，在 HBuilderX 中：
1. 右键 uni_modules
2. 选择"从插件市场导入"
3. 搜索"uni-popup"
4. 点击导入
```
- [ ] uni-popup 组件已安装

---

### 第四步：运行测试（预计5分钟）

#### 4.1 运行小程序
```bash
1. 在 HBuilderX 中点击"运行" → "运行到小程序模拟器"
2. 微信开发者工具会自动打开
3. 等待编译完成
```
- [ ] 小程序运行成功

#### 4.2 测试导入功能
```bash
1. 在小程序中点击：工具 → 血染百科
2. 点击"导入百科链接"
3. 复制测试URL：
   https://clocktower-wiki.gstonegames.com/index.php?title=洗衣妇
4. 点击"粘贴"按钮
5. 点击"开始导入"
6. 等待3-5秒
7. 查看是否跳转到详情页
8. 验证内容是否完整
```
- [ ] 导入功能正常
- [ ] 详情页显示正常
- [ ] 内容解析正确

#### 4.3 测试缓存功能
```bash
1. 返回百科主页
2. 再次导入同一个URL
3. 观察是否提示"已加载"
4. 验证加载速度是否<1秒
```
- [ ] 缓存功能正常

#### 4.4 测试搜索功能
```bash
1. 在搜索框输入"洗衣妇"
2. 按回车
3. 验证是否找到结果
4. 验证是否跳转到详情页
```
- [ ] 搜索功能正常

#### 4.5 测试收藏功能
```bash
1. 在详情页点击"收藏"按钮
2. 验证是否提示"收藏成功"
3. 返回主页再进入详情
4. 验证收藏状态是否保持
5. 点击"已收藏"取消收藏
6. 验证是否提示"已取消收藏"
```
- [ ] 收藏功能正常

#### 4.6 测试其他功能
```bash
测试以下功能：
- 图片预览
- 相关链接导入
- 查看原文（复制链接）
- 最近导入列表
```
- [ ] 图片预览正常
- [ ] 相关链接功能正常
- [ ] 复制链接功能正常
- [ ] 最近导入显示正常

---

## 🐛 问题排查

### 问题1：云函数上传失败
**检查项：**
- [ ] 网络连接是否正常
- [ ] uniCloud账号是否登录
- [ ] 云服务空间是否选择正确
- [ ] package.json 格式是否正确

**解决方案：**
1. 检查网络
2. 重新登录uniCloud
3. 切换云服务空间
4. 检查代码语法

---

### 问题2：导入时提示"网页加载失败"
**检查项：**
- [ ] URL是否正确
- [ ] 网络是否正常
- [ ] 云函数是否已部署
- [ ] 云函数日志是否有错误

**解决方案：**
1. 在浏览器验证URL可访问
2. 检查云函数部署状态
3. 查看云函数日志
4. 增加云函数超时时间

---

### 问题3：详情页显示空白
**检查项：**
- [ ] entry_id 是否正确传递
- [ ] 数据库集合是否创建
- [ ] 数据库权限是否配置
- [ ] 云函数返回数据是否正确

**解决方案：**
1. 检查URL参数
2. 确认数据库集合存在
3. 检查数据库权限
4. 查看云函数返回数据

---

### 问题4：搜索无结果
**检查项：**
- [ ] 是否已导入相关词条
- [ ] 搜索关键词是否正确
- [ ] 数据库查询是否正常

**解决方案：**
1. 先导入一些词条
2. 使用准确的关键词
3. 查看云函数日志

---

## 📊 性能验证

### 性能指标检查
```bash
使用秒表记录以下操作时间：

1. 首次导入URL：____秒（目标<5秒）
2. 缓存读取：____秒（目标<1秒）
3. 搜索查询：____秒（目标<2秒）
4. 详情页加载：____秒（目标<1秒）
```

- [ ] 所有性能指标达标

---

## 📈 数据验证

### 数据库检查
```bash
1. 打开 uniCloud Web控制台
2. 进入"云数据库"
3. 查看 wiki_entries 集合
4. 确认已有测试数据
```
- [ ] 数据成功保存到数据库

### 缓存验证
```bash
1. 导入同一个URL两次
2. 第二次应显示"来自缓存"
3. 检查 cache_expires_at 字段
```
- [ ] 缓存机制正常工作

---

## 🎯 上线前最终检查

### 功能完整性
- [ ] URL导入功能正常
- [ ] 搜索功能正常
- [ ] 详情展示正常
- [ ] 收藏功能正常
- [ ] 图片预览正常
- [ ] 相关推荐正常

### 用户体验
- [ ] 加载提示友好
- [ ] 错误提示清晰
- [ ] 操作流程顺畅
- [ ] UI美观大方
- [ ] 无明显卡顿

### 稳定性
- [ ] 无崩溃
- [ ] 无内存泄漏
- [ ] 错误恢复正常
- [ ] 边界情况处理完善

### 文档完整性
- [ ] 使用文档齐全
- [ ] 部署文档清晰
- [ ] 测试用例完整
- [ ] 代码注释充分

---

## 🎉 部署完成确认

当所有检查项都打勾✅后，说明部署成功！

### 成功标志
- ✅ 云函数全部部署
- ✅ 数据库集合全部创建
- ✅ 小程序运行正常
- ✅ 功能测试通过
- ✅ 性能指标达标

### 下一步
1. 邀请用户试用
2. 收集使用反馈
3. 持续优化改进
4. 准备正式发布

---

## 📞 获取帮助

### 遇到问题？
1. 查看 [QUICK_START.md](./pages/tools/wiki/QUICK_START.md)
2. 查看 [DEPLOYMENT_GUIDE.md](./pages/tools/wiki/DEPLOYMENT_GUIDE.md)
3. 查看云函数日志
4. 检查数据库配置

### 技术支持
- 📖 完整文档：`pages/tools/wiki/`
- 🧪 测试用例：`pages/tools/wiki/TEST_CASES.md`
- 📊 功能总结：`WIKI_FEATURE_SUMMARY.md`

---

**检查清单版本**: v1.0.0  
**创建时间**: 2025年10月17日  
**适用版本**: 血染百科功能 v1.0.0

