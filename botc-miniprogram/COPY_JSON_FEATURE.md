# 剧本详情页「复制JSON」功能实现说明

## ✅ 功能概述

在剧本详情页面新增了「复制JSON」按钮，用户点击后可以将剧本的完整JSON数据复制到剪贴板，方便用户快速获取和分享剧本数据。

## 📋 实现方案

### 1. 云存储方案
- **数据存储**：JSON数据存储在数据库的 `json_data` 字段中
- **数据格式**：JSON对象格式，存储在 `botc-scripts` 集合中
- **数据获取**：通过 `script-detail` 云函数获取剧本详情时自动返回 `json_data`

### 2. 前端实现

#### 2.1 UI设计
在剧本详情页面的操作区域新增两个按钮：
- **📋 复制JSON**：将JSON数据复制到剪贴板
- **💾 下载.json文件**：下载JSON文件到本地

#### 2.2 按钮样式
- **复制按钮**：蓝色渐变背景 (#4facfe → #00f2fe)
- **下载按钮**：紫色渐变背景 (#667eea → #764ba2)
- **交互效果**：
  - 点击时缩放动画 (scale: 0.98)
  - 阴影效果变化
  - 加载状态文字提示

#### 2.3 功能逻辑
```javascript
async copyJsonToClipboard() {
  // 1. 检查剧本数据是否存在
  // 2. 检查 json_data 字段是否存在
  // 3. 将JSON对象转换为格式化字符串 (JSON.stringify with indent)
  // 4. 使用 uni.setClipboardData 复制到剪贴板
  // 5. 显示成功/失败提示
}
```

### 3. 数据流程

```
用户点击「复制JSON」按钮
    ↓
检查 this.scriptDetail 是否存在
    ↓
检查 this.scriptDetail.json_data 是否存在
    ↓
JSON.stringify(json_data, null, 2) 格式化
    ↓
uni.setClipboardData() 复制到剪贴板
    ↓
显示 Toast 提示用户
```

## 🎯 核心代码

### 前端代码位置
- **文件**：`botc-miniprogram/pages/script/detail/detail.vue`
- **方法**：`copyJsonToClipboard()`
- **按钮位置**：第114-120行

### 数据库字段
- **集合**：`botc-scripts`
- **字段**：`json_data`
- **类型**：JSON对象
- **Schema定义**：`uniCloud-aliyun/database/botc-scripts.schema.json`

### 云函数
- **函数名**：`script-detail`
- **位置**：`uniCloud-aliyun/cloudfunctions/script-detail/index.js`
- **返回数据**：包含完整的剧本数据，包括 `json_data` 字段

## 📱 使用方式

### 用户端操作
1. 进入剧本详情页面
2. 滚动到操作按钮区域
3. 点击「📋 复制JSON」按钮
4. 等待提示「✅ JSON已复制到剪贴板」
5. 在任意支持粘贴的地方使用（如聊天窗口、文本编辑器等）

### 使用场景
- **分享剧本**：快速将剧本数据分享给其他玩家
- **备份数据**：将剧本数据备份到其他地方
- **数据编辑**：复制后粘贴到编辑器进行修改
- **快速预览**：在文本编辑器中查看JSON结构

## 🔍 技术细节

### 1. 数据格式化
- 使用 `JSON.stringify(json_data, null, 2)` 进行格式化
- 缩进为2个空格，提高可读性
- 保留JSON的原始结构

### 2. 错误处理
- **剧本数据不存在**：显示「剧本数据不存在」
- **JSON数据不存在**：显示「该剧本暂无JSON数据」
- **复制失败**：显示「复制失败」并记录错误日志

### 3. 状态管理
- `copyingJson`：控制按钮的加载状态
- 复制过程中按钮显示「⏳ 复制中...」
- 复制完成后恢复为「📋 复制JSON」

### 4. 兼容性
- ✅ **微信小程序**：完全支持
- ✅ **H5**：完全支持
- ✅ **App**：完全支持

## 🎨 UI展示

### 按钮布局
```
┌─────────────────────────────┐
│   📋 复制JSON               │  ← 蓝色渐变
├─────────────────────────────┤
│   💾 下载.json文件           │  ← 紫色渐变
└─────────────────────────────┘
```

### 样式规范
- **高度**：88rpx
- **圆角**：16rpx
- **字体大小**：30rpx
- **字重**：600 (semi-bold)
- **间距**：20rpx
- **阴影**：0 6rpx 20rpx rgba(...)

## 🔄 与下载功能的区别

| 功能 | 复制JSON | 下载JSON文件 |
|------|----------|-------------|
| **操作方式** | 复制到剪贴板 | 保存为文件 |
| **使用场景** | 快速分享、临时使用 | 永久保存、导入使用 |
| **跨平台** | 剪贴板通用 | 需要文件系统支持 |
| **速度** | 极快（毫秒级） | 较快（秒级） |
| **便捷性** | 一键复制粘贴 | 需要选择保存位置 |

## 📊 数据示例

### 复制的JSON格式
```json
{
  "meta": [
    {
      "id": "troublebrewing",
      "name": "暗流涌动",
      "author": "TPI"
    }
  ],
  "_roles": [
    {
      "id": "washerwoman",
      "name": "洗衣妇",
      "team": "townsfolk",
      "ability": "在首个夜晚，你会得知两名玩家，其中一人是特定的镇民角色。"
    }
    // ... 更多角色数据
  ]
}
```

## ✨ 优势特点

1. **🚀 快速便捷**：一键复制，无需等待文件下载
2. **🔒 数据完整**：保留完整的JSON结构和格式
3. **📱 跨平台支持**：在任何支持剪贴板的地方都能使用
4. **💡 用户友好**：明确的成功提示，清晰的错误信息
5. **🎯 符合规范**：遵循项目UI设计规范（Apple HIG风格）

## 🛠️ 维护说明

### 数据来源
JSON数据来自 `script-detail` 云函数返回的 `json_data` 字段，确保：
1. 上传剧本时正确保存 `json_data`
2. 云函数返回时包含完整的 `json_data`
3. 权限控制正确（只有已发布或本人的剧本才能查看）

### 未来优化方向
1. **压缩JSON**：对于大型JSON，可以提供压缩选项
2. **格式选择**：提供多种格式化选项（缩进2/4空格、紧凑模式）
3. **部分复制**：支持复制JSON的特定部分（如只复制角色列表）
4. **历史记录**：记录用户最近复制的剧本

## 📝 更新日志

### v1.0.0 (2025-10-21)
- ✨ 新增「复制JSON」功能
- 🎨 优化按钮UI设计
- 🐛 完善错误处理机制
- 📖 添加功能文档

---

**开发者**: AI Assistant  
**更新时间**: 2025年10月21日  
**版本**: v1.0.0

