# User äº‘å¯¹è±¡æµ‹è¯•æ¸…å•

## âœ… å·²å®ŒæˆåŠŸèƒ½æµ‹è¯•

### 1. sendSms - å‘é€çŸ­ä¿¡éªŒè¯ç  âœ…
**æµ‹è¯•æ­¥éª¤ï¼š**
- [x] è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·
- [x] ç‚¹å‡»"å‘é€éªŒè¯ç "
- [x] éªŒè¯è¿”å›æ ¼å¼æ­£ç¡®
- [x] å¼€å‘æ¨¡å¼è¿”å› `devCode`

**é¢„æœŸç»“æœï¼š**
```javascript
{
  code: 0,
  message: "éªŒè¯ç å·²å‘é€ï¼ˆå¼€å‘æ¨¡å¼ï¼‰",
  data: {
    expiresIn: 180,
    devCode: "123456" // 6ä½æ•°å­—
  }
}
```

**å¼‚å¸¸æƒ…å†µæµ‹è¯•ï¼š**
- [ ] æ‰‹æœºå·ä¸ºç©º - åº”æç¤º"è¯·è¾“å…¥æ‰‹æœºå·"
- [ ] æ‰‹æœºå·æ ¼å¼é”™è¯¯ - åº”æç¤º"æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®"
- [ ] 60ç§’å†…é‡å¤å‘é€ - åº”æç¤º"è¯·Xç§’åå†è¯•"

---

### 2. login - æ‰‹æœºå·éªŒè¯ç ç™»å½• âœ…
**æµ‹è¯•æ­¥éª¤ï¼š**
- [x] è¾“å…¥æ‰‹æœºå·å’ŒéªŒè¯ç 
- [x] ç‚¹å‡»"ç™»å½•"
- [x] éªŒè¯è¿”å› token å’Œç”¨æˆ·ä¿¡æ¯
- [x] éªŒè¯æœ¬åœ°å­˜å‚¨ token

**é¢„æœŸç»“æœï¼š**
```javascript
{
  code: 0,
  message: "ç™»å½•æˆåŠŸ",
  data: {
    token: "userid_timestamp_random",
    tokenExpired: 1730000000000,
    userInfo: {
      _id: "...",
      uid: "...",
      mobile: "19533284032",
      nickname: "...",
      avatar: "...",
      gender: 0,
      level: 1,
      exp: 0,
      status: 0,
      role: 0,
      register_date: ...,
      last_login_date: ...
    }
  }
}
```

**å¼‚å¸¸æƒ…å†µæµ‹è¯•ï¼š**
- [ ] æ‰‹æœºå·ä¸ºç©º - åº”æç¤º"è¯·è¾“å…¥æ‰‹æœºå·"
- [ ] éªŒè¯ç ä¸ºç©º - åº”æç¤º"è¯·è¾“å…¥éªŒè¯ç "
- [ ] éªŒè¯ç æ ¼å¼é”™è¯¯ï¼ˆé6ä½æ•°å­—ï¼‰- åº”æç¤º"éªŒè¯ç æ ¼å¼ä¸æ­£ç¡®"
- [ ] éªŒè¯ç é”™è¯¯æˆ–è¿‡æœŸ - åº”æç¤º"éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸ"

**æ–°ç”¨æˆ·æ³¨å†Œæµ‹è¯•ï¼š**
- [ ] ä½¿ç”¨æœªæ³¨å†Œæ‰‹æœºå·ç™»å½•
- [ ] éªŒè¯è‡ªåŠ¨åˆ›å»ºæ–°ç”¨æˆ·
- [ ] éªŒè¯é»˜è®¤æ˜µç§°ä¸º "ç”¨æˆ·xxx"

---

## ğŸ”² å¾…æµ‹è¯•åŠŸèƒ½

### 3. getInfo - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
**æµ‹è¯•æ­¥éª¤ï¼š**
1. ç¡®ä¿å·²ç™»å½•ï¼ˆæœ‰ tokenï¼‰
2. åœ¨ä»»æ„é¡µé¢è°ƒç”¨äº‘å¯¹è±¡æ–¹æ³•

**æµ‹è¯•ä»£ç ï¼š**
```javascript
// åœ¨æ§åˆ¶å°æˆ–é¡µé¢ä¸­æµ‹è¯•
const userObj = uniCloud.importObject('user')
const result = await userObj.getInfo()
console.log('ç”¨æˆ·ä¿¡æ¯:', result)
```

**é¢„æœŸç»“æœï¼š**
```javascript
{
  code: 0,
  message: "è·å–æˆåŠŸ",
  data: {
    _id: "...",
    uid: "...",
    mobile: "19533284032",
    nickname: "...",
    avatar: "...",
    gender: 0,
    level: 1,
    exp: 0,
    status: 0,
    role: 0,
    register_date: ...,
    last_login_date: ...,
    following_count: 0,  // å…³æ³¨æ•°
    followers_count: 0,  // ç²‰ä¸æ•°
    background_image: ""
  }
}
```

**å¼‚å¸¸æƒ…å†µæµ‹è¯•ï¼š**
- [ ] æœªç™»å½•çŠ¶æ€è°ƒç”¨ - åº”æç¤º"è¯·å…ˆç™»å½•"
- [ ] token è¿‡æœŸ - åº”æç¤º"è¯·å…ˆç™»å½•"

---

### 4. update - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
**æµ‹è¯•æ­¥éª¤ï¼š**
1. ç¡®ä¿å·²ç™»å½•
2. ä¿®æ”¹ç”¨æˆ·èµ„æ–™

**æµ‹è¯•ä»£ç ï¼š**
```javascript
// æ›´æ–°æ˜µç§°
const userObj = uniCloud.importObject('user')
const result = await userObj.update({
  nickname: "æ–°æ˜µç§°"
})
console.log('æ›´æ–°ç»“æœ:', result)

// æ›´æ–°å¤šä¸ªå­—æ®µ
const result2 = await userObj.update({
  nickname: "æµ‹è¯•ç”¨æˆ·",
  gender: 1,
  avatar: "https://example.com/avatar.jpg"
})
```

**é¢„æœŸç»“æœï¼š**
- è¿”å›æ›´æ–°åçš„å®Œæ•´ç”¨æˆ·ä¿¡æ¯ï¼ˆè°ƒç”¨ getInfoï¼‰

**å­—æ®µéªŒè¯ï¼š**
- [ ] `nickname` - æ˜µç§°ï¼ˆ1-20ä¸ªå­—ç¬¦ï¼‰
- [ ] `avatar` - å¤´åƒURL
- [ ] `gender` - æ€§åˆ«ï¼ˆ0-æœªçŸ¥ï¼Œ1-ç”·ï¼Œ2-å¥³ï¼‰
- [ ] `background_image` - èƒŒæ™¯å›¾ç‰‡URL

**å¼‚å¸¸æƒ…å†µæµ‹è¯•ï¼š**
- [ ] æœªç™»å½•è°ƒç”¨ - åº”æç¤º"è¯·å…ˆç™»å½•"
- [ ] æ˜µç§°ä¸ºç©º - åº”æç¤º"æ˜µç§°ä¸èƒ½ä¸ºç©º"
- [ ] æ˜µç§°è¶…è¿‡20å­—ç¬¦ - åº”æç¤º"æ˜µç§°ä¸èƒ½è¶…è¿‡20ä¸ªå­—ç¬¦"
- [ ] æ€§åˆ«å‚æ•°é”™è¯¯ï¼ˆé0/1/2ï¼‰- åº”æç¤º"æ€§åˆ«å‚æ•°é”™è¯¯"
- [ ] æ²¡æœ‰è¦æ›´æ–°çš„æ•°æ® - åº”æç¤º"æ²¡æœ‰è¦æ›´æ–°çš„æ•°æ®"

---

### 5. logout - ç”¨æˆ·ç™»å‡º
**æµ‹è¯•æ­¥éª¤ï¼š**
1. ç¡®ä¿å·²ç™»å½•
2. è°ƒç”¨ç™»å‡ºæ–¹æ³•
3. éªŒè¯æœ¬åœ° token æ¸…é™¤

**æµ‹è¯•ä»£ç ï¼š**
```javascript
const userObj = uniCloud.importObject('user')
const result = await userObj.logout()
console.log('ç™»å‡ºç»“æœ:', result)

// æ¸…é™¤æœ¬åœ°å­˜å‚¨
uni.removeStorageSync('uni_id_token')
uni.removeStorageSync('uni_id_token_expired')
```

**é¢„æœŸç»“æœï¼š**
```javascript
{
  code: 0,
  message: "ç™»å‡ºæˆåŠŸ",
  data: null
}
```

**éªŒè¯ï¼š**
- [ ] æ•°æ®åº“ä¸­è®°å½•äº† `last_logout_date`
- [ ] æœ¬åœ° token å·²æ¸…é™¤
- [ ] å†æ¬¡è°ƒç”¨ getInfo åº”æç¤º"è¯·å…ˆç™»å½•"

**å¼‚å¸¸æƒ…å†µæµ‹è¯•ï¼š**
- [ ] æœªç™»å½•è°ƒç”¨ - åº”æç¤º"è¯·å…ˆç™»å½•"

---

## ğŸ§ª ç»¼åˆæµ‹è¯•åœºæ™¯

### åœºæ™¯ 1ï¼šå®Œæ•´çš„ç™»å½•æµç¨‹
1. [ ] å‘é€éªŒè¯ç 
2. [ ] ä½¿ç”¨éªŒè¯ç ç™»å½•
3. [ ] è·å–ç”¨æˆ·ä¿¡æ¯
4. [ ] æ›´æ–°ç”¨æˆ·èµ„æ–™
5. [ ] é€€å‡ºç™»å½•

### åœºæ™¯ 2ï¼šæ–°ç”¨æˆ·æ³¨å†Œæµç¨‹
1. [ ] ä½¿ç”¨æ–°æ‰‹æœºå·å‘é€éªŒè¯ç 
2. [ ] ç™»å½•ï¼ˆè‡ªåŠ¨æ³¨å†Œï¼‰
3. [ ] éªŒè¯ç”¨æˆ·ä¿¡æ¯é»˜è®¤å€¼
4. [ ] å®Œå–„ç”¨æˆ·èµ„æ–™

### åœºæ™¯ 3ï¼šé”™è¯¯å¤„ç†
1. [ ] å„ç§å‚æ•°éªŒè¯é”™è¯¯
2. [ ] æœªç™»å½•çŠ¶æ€è®¿é—®éœ€è¦é‰´æƒçš„æ¥å£
3. [ ] éªŒè¯ç è¿‡æœŸ/é”™è¯¯
4. [ ] é¢‘ç¹å‘é€éªŒè¯ç é™åˆ¶

### åœºæ™¯ 4ï¼šå¹¶å‘æµ‹è¯•
1. [ ] åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚
2. [ ] éªŒè¯æ•°æ®ä¸€è‡´æ€§
3. [ ] éªŒè¯é”™è¯¯å¤„ç†

---

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### å“åº”æ—¶é—´
- [ ] `sendSms` - åº” < 500ms
- [ ] `login` - åº” < 1000ms
- [ ] `getInfo` - åº” < 500ms
- [ ] `update` - åº” < 800ms
- [ ] `logout` - åº” < 300ms

### æ•°æ®åº“æŸ¥è¯¢
- [ ] éªŒè¯ç´¢å¼•ä½¿ç”¨ï¼ˆæ‰‹æœºå·æŸ¥è¯¢ï¼‰
- [ ] éªŒè¯ç»Ÿè®¡æŸ¥è¯¢æ•ˆç‡ï¼ˆå…³æ³¨æ•°/ç²‰ä¸æ•°ï¼‰

---

## ğŸ” å®‰å…¨æµ‹è¯•

### Token å®‰å…¨
- [ ] Token æ˜¯å¦æ­£ç¡®ç”Ÿæˆ
- [ ] Token æ˜¯å¦æ­£ç¡®è§£æ
- [ ] Token è¿‡æœŸå¤„ç†

### å‚æ•°éªŒè¯
- [ ] æ‰€æœ‰è¾“å…¥å‚æ•°éƒ½æœ‰éªŒè¯
- [ ] SQL æ³¨å…¥é˜²æŠ¤ï¼ˆuniCloud è‡ªå¸¦ï¼‰
- [ ] XSS é˜²æŠ¤ï¼ˆå‰ç«¯å¤„ç†ï¼‰

### æƒé™éªŒè¯
- [ ] åªèƒ½æ“ä½œå½“å‰ç™»å½•ç”¨æˆ·çš„æ•°æ®
- [ ] æœªç™»å½•æ— æ³•è®¿é—®éœ€è¦é‰´æƒçš„æ¥å£

---

## ğŸ“ æµ‹è¯•è®°å½•

| åŠŸèƒ½ | æµ‹è¯•æ—¶é—´ | æµ‹è¯•äºº | ç»“æœ | å¤‡æ³¨ |
|------|---------|--------|------|------|
| sendSms | 2025-11-03 17:0x | - | âœ… é€šè¿‡ | å¼€å‘æ¨¡å¼æ­£å¸¸ |
| login | 2025-11-03 17:0x | - | âœ… é€šè¿‡ | ç™»å½•æˆåŠŸ |
| getInfo | - | - | ğŸ”² å¾…æµ‹ | - |
| update | - | - | ğŸ”² å¾…æµ‹ | - |
| logout | - | - | ğŸ”² å¾…æµ‹ | - |

---

## ğŸ› å·²çŸ¥é—®é¢˜

æ— 

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **å¼€å‘æ¨¡å¼é…ç½®**
   - `sendSms` æ–¹æ³•ä¸­ `isDev = true`ï¼Œä¼šç›´æ¥è¿”å›éªŒè¯ç 
   - ç”Ÿäº§ç¯å¢ƒéœ€æ”¹ä¸º `isDev = false` å¹¶æ¥å…¥çœŸå®çŸ­ä¿¡æœåŠ¡

2. **Token æœºåˆ¶**
   - å½“å‰ä½¿ç”¨ç®€å•çš„ token ç”Ÿæˆæ–¹å¼
   - ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ JWT

3. **æ•°æ®åº“ç´¢å¼•**
   - ç¡®ä¿ `uni-id-users.mobile` æœ‰ç´¢å¼•
   - ç¡®ä¿ `sms-codes.phone` å’Œ `created_at` æœ‰ç´¢å¼•

4. **é”™è¯¯å¤„ç†**
   - æ‰€æœ‰é”™è¯¯éƒ½é€šè¿‡ `_after` é’©å­ç»Ÿä¸€å¤„ç†
   - è¿”å›æ ¼å¼ç»Ÿä¸€ä¸º `{ code, message, data }`

5. **éªŒè¯ç é™åˆ¶**
   - 1åˆ†é’Ÿå†…åªèƒ½å‘é€ä¸€æ¬¡
   - éªŒè¯ç 3åˆ†é’Ÿåè¿‡æœŸ
   - éªŒè¯ç ä½¿ç”¨åæ ‡è®°ä¸ºå·²ä½¿ç”¨

---

## ğŸ¯ ä¸‹ä¸€æ­¥

å®Œæˆæ‰€æœ‰æµ‹è¯•åï¼š
1. [ ] ä¿®å¤å‘ç°çš„é—®é¢˜
2. [ ] ä¼˜åŒ–æ€§èƒ½ç“¶é¢ˆ
3. [ ] å®Œå–„é”™è¯¯æç¤º
4. [ ] æ›´æ–°æ–‡æ¡£
5. [ ] ç»§ç»­è¿ç§»å…¶ä»–äº‘å¯¹è±¡ï¼ˆscriptã€carpool ç­‰ï¼‰

