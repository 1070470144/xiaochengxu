# 血染百科功能测试用例

## 🧪 测试准备

### 测试环境
- HBuilderX 版本：最新版
- 微信开发者工具：最新版
- uniCloud 云服务空间：已创建

### 测试数据
准备以下钟楼百科URL用于测试：

```javascript
// 角色页面
const roleUrls = [
  'https://clocktower-wiki.gstonegames.com/index.php?title=洗衣妇',
  'https://clocktower-wiki.gstonegames.com/index.php?title=图书管理员',
  'https://clocktower-wiki.gstonegames.com/index.php?title=厨师',
  'https://clocktower-wiki.gstonegames.com/index.php?title=小恶魔',
  'https://clocktower-wiki.gstonegames.com/index.php?title=男爵'
];

// 规则页面
const ruleUrls = [
  'https://clocktower-wiki.gstonegames.com/index.php?title=规则概要',
  'https://clocktower-wiki.gstonegames.com/index.php?title=术语汇总',
  'https://clocktower-wiki.gstonegames.com/index.php?title=重要细节'
];

// 剧本页面
const scriptUrls = [
  'https://clocktower-wiki.gstonegames.com/index.php?title=暗流涌动',
  'https://clocktower-wiki.gstonegames.com/index.php?title=黯月初升',
  'https://clocktower-wiki.gstonegames.com/index.php?title=梦殒春宵'
];
```

---

## 📋 测试用例

### 测试1：云函数 wiki-parse-url

#### 用例1.1：解析角色页面 - 洗衣妇
**测试步骤：**
1. 在 HBuilderX 中右键 `wiki-parse-url` 云函数
2. 选择"运行-云端"
3. 输入参数：
   ```json
   {
     "url": "https://clocktower-wiki.gstonegames.com/index.php?title=洗衣妇"
   }
   ```
4. 点击"运行"

**预期结果：**
```json
{
  "code": 0,
  "message": "解析成功",
  "data": {
    "entry_type": "role",
    "title": "洗衣妇",
    "role_info": {
      "team": "townsfolk",
      "team_name": "镇民",
      "ability": "开局得知某位玩家的角色"
    },
    "content": {
      "text": "...",
      "sections": [...],
      "summary": "..."
    }
  }
}
```

**验收标准：**
- [ ] code 为 0
- [ ] entry_type 为 "role"
- [ ] title 正确提取
- [ ] role_info.team 为 "townsfolk"
- [ ] role_info.ability 正确提取
- [ ] content.sections 有内容

---

#### 用例1.2：解析规则页面 - 规则概要
**测试步骤：**
```json
{
  "url": "https://clocktower-wiki.gstonegames.com/index.php?title=规则概要"
}
```

**预期结果：**
- entry_type 为 "rule" 或 "guide"
- title 为 "规则概要"
- content.sections 包含多个段落

**验收标准：**
- [ ] 解析成功
- [ ] 标题正确
- [ ] 内容完整

---

#### 用例1.3：缓存机制测试
**测试步骤：**
1. 首次解析某个URL（记录时间T1）
2. 立即再次解析同一个URL（记录时间T2）
3. 比较 T1 和 T2

**预期结果：**
- 首次：`from_cache: false`，耗时3-5秒
- 二次：`from_cache: true`，耗时<1秒

**验收标准：**
- [ ] 首次解析成功
- [ ] 二次返回缓存
- [ ] 缓存数据与首次一致

---

#### 用例1.4：错误处理测试
**测试步骤：**
```json
// 测试无效URL
{ "url": "https://baidu.com" }

// 测试空URL
{ "url": "" }

// 测试不存在的页面
{ "url": "https://clocktower-wiki.gstonegames.com/index.php?title=不存在的页面" }
```

**预期结果：**
- 无效URL：返回 code 400，message "请输入钟楼百科的页面链接"
- 空URL：返回 code 400
- 不存在页面：能解析但内容可能为空

**验收标准：**
- [ ] 错误提示友好
- [ ] 不会崩溃
- [ ] 返回正确的错误码

---

### 测试2：云函数 wiki-search

#### 用例2.1：搜索角色名
**测试步骤：**
```json
{
  "keyword": "洗衣妇"
}
```

**预期结果：**
- 找到"洗衣妇"相关词条
- 返回数据包含 title、entry_type 等信息

**验收标准：**
- [ ] 搜索成功
- [ ] 结果准确
- [ ] 数据格式正确

---

#### 用例2.2：类型筛选
**测试步骤：**
```json
{
  "keyword": "镇民",
  "entry_type": "role"
}
```

**预期结果：**
- 只返回角色类型的词条
- 包含"镇民"关键词

**验收标准：**
- [ ] 筛选生效
- [ ] 结果正确

---

### 测试3：云函数 wiki-detail

#### 用例3.1：查询词条详情
**测试步骤：**
1. 先导入一个词条，获取 _id
2. 使用 _id 查询详情
   ```json
   {
     "entry_id": "刚才获取的_id"
   }
   ```

**预期结果：**
- 返回完整的词条信息
- 包含 related_entries（相关词条）
- view_count 增加1

**验收标准：**
- [ ] 查询成功
- [ ] 数据完整
- [ ] 浏览计数正确

---

### 测试4：小程序页面

#### 用例4.1：导入功能测试
**测试步骤：**
1. 打开小程序
2. 进入 工具 → 血染百科
3. 点击"导入百科链接"
4. 输入URL：`https://clocktower-wiki.gstonegames.com/index.php?title=洗衣妇`
5. 点击"开始导入"

**预期结果：**
- 显示"解析中..."加载提示
- 3-5秒后提示"导入成功"
- 自动跳转到详情页
- 详情页显示完整内容

**验收标准：**
- [ ] 导入流程顺畅
- [ ] 加载提示友好
- [ ] 跳转正确
- [ ] 内容显示完整

---

#### 用例4.2：粘贴URL测试
**测试步骤：**
1. 在浏览器中复制URL
2. 打开导入弹窗
3. 点击"粘贴"按钮

**预期结果：**
- URL 自动填充到输入框
- 提示"粘贴成功"

**验收标准：**
- [ ] 粘贴功能正常
- [ ] URL 正确填充

---

#### 用例4.3：最近导入显示测试
**测试步骤：**
1. 导入3个不同的词条
2. 返回百科主页
3. 查看"最近导入"区域

**预期结果：**
- 显示最近导入的3个词条
- 按时间倒序排列
- 点击可以查看详情

**验收标准：**
- [ ] 最近导入正确显示
- [ ] 排序正确
- [ ] 点击跳转正常

---

#### 用例4.4：搜索功能测试
**测试步骤：**
1. 先导入几个词条（如：洗衣妇、厨师）
2. 在搜索框输入"洗衣妇"
3. 按回车或点击搜索

**预期结果：**
- 找到"洗衣妇"词条
- 自动跳转到详情页

**验收标准：**
- [ ] 搜索成功
- [ ] 跳转正确

---

#### 用例4.5：详情页显示测试
**测试步骤：**
1. 导入一个角色（如：洗衣妇）
2. 进入详情页

**预期结果：**
- 显示角色图标
- 显示阵营信息
- 显示能力描述
- 显示完整内容
- 底部显示操作按钮

**验收标准：**
- [ ] 布局美观
- [ ] 信息完整
- [ ] 图片正常显示
- [ ] 操作按钮可用

---

#### 用例4.6：收藏功能测试
**测试步骤：**
1. 在详情页点击"收藏"按钮
2. 返回主页再进入详情
3. 点击"已收藏"取消收藏

**预期结果：**
- 首次点击：提示"收藏成功"，按钮变为"💛 已收藏"
- 二次进入：仍显示"已收藏"
- 取消收藏：提示"已取消收藏"，按钮变为"🤍 收藏"

**验收标准：**
- [ ] 收藏状态正确
- [ ] 数据库更新成功
- [ ] UI状态同步

---

#### 用例4.7：查看原文测试
**测试步骤：**
1. 在详情页点击"原文"按钮

**预期结果：**
- 提示"链接已复制"
- 剪贴板中有正确的URL

**验收标准：**
- [ ] 链接复制成功
- [ ] URL 正确

---

### 测试5：边界测试

#### 用例5.1：网络异常测试
**测试步骤：**
1. 关闭网络
2. 尝试导入URL

**预期结果：**
- 提示"网络错误，请稍后重试"

**验收标准：**
- [ ] 错误提示友好
- [ ] 不会崩溃

---

#### 用例5.2：并发请求测试
**测试步骤：**
1. 快速连续导入5个不同URL

**预期结果：**
- 所有请求都能正常处理
- 数据不会混乱

**验收标准：**
- [ ] 并发处理正常
- [ ] 数据准确

---

#### 用例5.3：长文本测试
**测试步骤：**
1. 导入内容很长的页面（如：规则概要）

**预期结果：**
- 能正常解析
- 内容不会截断（或合理截断）

**验收标准：**
- [ ] 长文本处理正常
- [ ] 显示流畅

---

## ✅ 测试结果记录

### 测试日期：2025年10月17日

| 用例编号 | 测试项 | 结果 | 备注 |
|---------|--------|------|------|
| 1.1 | 解析角色页面 | ⏳ 待测试 | - |
| 1.2 | 解析规则页面 | ⏳ 待测试 | - |
| 1.3 | 缓存机制 | ⏳ 待测试 | - |
| 1.4 | 错误处理 | ⏳ 待测试 | - |
| 2.1 | 搜索功能 | ⏳ 待测试 | - |
| 2.2 | 类型筛选 | ⏳ 待测试 | - |
| 3.1 | 查询详情 | ⏳ 待测试 | - |
| 4.1 | 导入功能 | ⏳ 待测试 | - |
| 4.2 | 粘贴URL | ⏳ 待测试 | - |
| 4.3 | 最近导入 | ⏳ 待测试 | - |
| 4.4 | 搜索功能 | ⏳ 待测试 | - |
| 4.5 | 详情显示 | ⏳ 待测试 | - |
| 4.6 | 收藏功能 | ⏳ 待测试 | - |
| 4.7 | 查看原文 | ⏳ 待测试 | - |
| 5.1 | 网络异常 | ⏳ 待测试 | - |
| 5.2 | 并发请求 | ⏳ 待测试 | - |
| 5.3 | 长文本 | ⏳ 待测试 | - |

**测试完成度：** 0/17

---

## 🔍 性能测试

### 响应时间测试
| 操作 | 目标时间 | 实际时间 | 结果 |
|------|---------|---------|------|
| 首次导入 | < 5秒 | ⏳ 待测试 | - |
| 缓存读取 | < 1秒 | ⏳ 待测试 | - |
| 搜索查询 | < 2秒 | ⏳ 待测试 | - |
| 详情加载 | < 1秒 | ⏳ 待测试 | - |

### 内存使用测试
| 场景 | 峰值内存 | 结果 |
|------|---------|------|
| 导入单个词条 | ⏳ 待测试 | - |
| 查看详情 | ⏳ 待测试 | - |
| 浏览10个词条 | ⏳ 待测试 | - |

---

## 📝 测试报告模板

### 测试问题记录

#### 问题1
- **发现日期**：
- **测试用例**：
- **问题描述**：
- **复现步骤**：
- **预期行为**：
- **实际行为**：
- **严重程度**：🔴 高 / 🟡 中 / 🟢 低
- **解决方案**：
- **修复状态**：⏳ 待修复 / ✅ 已修复

---

## 🎯 测试完成标准

### 功能测试
- [ ] 所有核心功能用例通过
- [ ] 所有边界测试用例通过
- [ ] 无严重bug

### 性能测试
- [ ] 响应时间达标
- [ ] 内存使用合理
- [ ] 无明显卡顿

### 兼容性测试
- [ ] iOS系统正常
- [ ] Android系统正常
- [ ] 不同屏幕尺寸适配

### 用户体验测试
- [ ] 操作流程顺畅
- [ ] 提示信息清晰
- [ ] UI美观易用

---

**测试人员**: 开发团队  
**创建时间**: 2025年10月17日  
**版本**: v1.0.0

