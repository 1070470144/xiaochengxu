# 血染百科 - 网页解析功能

## 🎉 功能介绍

将钟楼百科（https://clocktower-wiki.gstonegames.com/）的内容自动解析并展示在小程序中，让玩家无需跳转浏览器即可查看完整的官方百科内容。

---

## ✨ 核心功能

### 📥 自动导入
- 输入钟楼百科URL
- 自动抓取网页内容
- 智能解析并结构化展示
- 支持角色、规则、剧本等所有类型页面

### 🔍 智能搜索
- 关键词搜索
- 类型筛选
- 搜索历史记录

### 💛 收藏管理
- 收藏常用词条
- 快速访问
- 收藏列表

### 🚀 性能优化
- 云端缓存7天
- 本地缓存3天
- 二次访问秒开
- 图片懒加载

---

## 🎯 使用方法

### 方法1：导入百科页面

1. 在浏览器打开钟楼百科：https://clocktower-wiki.gstonegames.com/
2. 浏览到想要导入的页面（如：洗衣妇）
3. 复制页面URL
4. 打开小程序 → 工具 → 血染百科
5. 点击"导入百科链接"
6. 粘贴URL
7. 点击"开始导入"
8. 等待解析完成
9. 查看详细内容

### 方法2：搜索已导入内容

1. 在搜索框输入关键词
2. 按回车搜索
3. 查看搜索结果

### 方法3：浏览最近导入

1. 在"最近导入"区域浏览
2. 点击词条卡片查看详情

---

## 📱 页面截图

### 百科主页
- 导入功能区
- 最近导入列表
- 搜索框
- 分类导航

### 词条详情页
- 标题和图标
- 角色信息（阵营、能力）
- 完整内容
- 相关图片
- 相关链接
- 操作按钮（收藏、分享、原文）

---

## 🔧 技术实现

### 架构
```
小程序 → uniCloud云函数 → 抓取百科网页 → 解析HTML → 存储数据 → 展示
```

### 核心技术
- **云函数**: uniCloud serverless
- **HTML解析**: cheerio
- **数据库**: MongoDB
- **缓存**: 云数据库 + 本地存储

---

## 📚 支持的页面类型

### ✅ 角色页面
示例：https://clocktower-wiki.gstonegames.com/index.php?title=洗衣妇

**提取内容：**
- 角色名称
- 阵营信息
- 能力描述
- 所属剧本
- 角色图标
- 详细说明

### ✅ 规则页面
示例：https://clocktower-wiki.gstonegames.com/index.php?title=规则概要

**提取内容：**
- 规则标题
- 分段内容
- 相关图片
- 相关链接

### ✅ 剧本页面
示例：https://clocktower-wiki.gstonegames.com/index.php?title=暗流涌动

**提取内容：**
- 剧本名称
- 剧本介绍
- 角色列表
- 游戏流程

### ✅ 其他页面
- 术语解释
- 游戏指南
- 任何百科页面

---

## 💡 使用技巧

### 技巧1：快速导入多个页面
```
在浏览器中打开多个标签页 → 依次复制URL → 在小程序中快速导入
```

### 技巧2：收藏常用角色
```
导入常玩角色 → 点击收藏 → 下次快速查看
```

### 技巧3：相关链接快速导入
```
在详情页点击相关链接 → 一键导入相关词条
```

### 技巧4：离线查看
```
提前导入需要的内容 → 离线时也能查看（缓存有效期内）
```

---

## ⚙️ 配置要求

### 环境要求
- HBuilderX 3.0+
- uniCloud 云服务空间
- 微信开发者工具

### 依赖包
```json
{
  "cheerio": "^1.0.0-rc.12"
}
```

---

## 🐛 常见问题

### Q: 为什么导入失败？
**A**: 
1. 检查URL是否正确（必须是钟楼百科）
2. 检查网络连接
3. 确认云函数已部署
4. 查看云函数日志

### Q: 为什么解析这么慢？
**A**: 
- 首次导入需要抓取网页，约3-5秒
- 二次访问会使用缓存，<1秒
- 如果网络慢，时间会更长

### Q: 部分内容显示不全？
**A**: 
- 百科页面结构复杂，部分特殊格式可能解析不完整
- 可以点击"查看原文"在浏览器中查看
- 后续会持续优化解析规则

### Q: 收藏功能无法使用？
**A**: 
- 需要登录后才能使用
- 检查是否已登录小程序

---

## 📖 相关文档

- **快速开始**: [QUICK_START.md](./QUICK_START.md)
- **部署指南**: [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md)
- **测试用例**: [TEST_CASES.md](./TEST_CASES.md)
- **使用指南**: [WIKI_FEATURE_README.md](./WIKI_FEATURE_README.md)

---

## 🎯 快速测试

### 测试URL
复制以下URL进行测试：

```
洗衣妇（角色）:
https://clocktower-wiki.gstonegames.com/index.php?title=洗衣妇

规则概要（规则）:
https://clocktower-wiki.gstonegames.com/index.php?title=规则概要

暗流涌动（剧本）:
https://clocktower-wiki.gstonegames.com/index.php?title=暗流涌动
```

---

**功能版本**: v1.0.0  
**创建时间**: 2025年10月17日  
**维护团队**: 血染钟楼小程序开发组

