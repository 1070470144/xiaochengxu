# 🧪 测试页面使用指南

## 📍 访问地址

```
http://localhost:5173/#/pages/test/script-test
```

---

## 🎯 页面功能

### 多页签测试中心

现在的测试页面支持**多个云对象的测试**，通过页签切换：

| 页签 | 图标 | 功能 | 方法数 |
|-----|------|------|--------|
| **Script** | 🎬 | 剧本云对象测试 | 14个方法 |
| **Carpool** | 🚗 | 拼车云对象测试 | 9个方法 |

---

## 📱 使用方式

### 1. 页签切换

点击顶部的页签即可切换不同的测试内容：

```
┌─────────────────────────────────┐
│  云对象测试中心    ✅ 已登录       │
├─────────────────────────────────┤
│  🎬          │  🚗               │
│  Script      │  Carpool          │
│  ────────    │                   │
└─────────────────────────────────┘
```

### 2. Script 页签

**包含 14 个测试方法：**

1. ✅ getList - 获取剧本列表
2. ✅ getDetail - 获取剧本详情
3. ✅ upload - 上传剧本
4. ✅ getMyUploads - 我的上传
5. ✅ delete - 删除剧本
6. ✅ createReview - 创建评论
7. ✅ rate - 评分剧本
8. ✅ getJson - 获取JSON内容
9. ✅ getRankingHot - 热门排行
10. ✅ getRankingNew - 最新排行
11. ✅ getRankingRating - 评分排行
12. ✅ getRankingDownload - 下载排行
13. ✅ calculateHeat - 计算热度
14. ✅ generateJsonUrl - 生成JSON URL

### 3. Carpool 页签

**包含 9 个测试方法：**

1. ✅ create - 创建拼车
2. ✅ getList - 拼车列表
3. ✅ getDetail - 拼车详情
4. ✅ apply - 申请加入
5. ✅ getMyApplications - 我的申请
6. ✅ cancelApply - 取消申请
7. ✅ confirmMember - 确认成员（车主）
8. ✅ removeMember - 移除成员（车主）
9. ✅ updateStatus - 更新状态（车主）

---

## 🧪 Carpool 测试流程

### 完整测试流程示例

#### 步骤 1：创建拼车
```javascript
// 填写表单
标题: 周末拼车
剧本ID: (可选)
游戏时间: 2025-11-10 14:00
地点: 上海市
详细地址: (可选)
最大人数: 7
描述: 欢迎新手
联系微信: (可选)

// 点击"创建拼车"
// 成功后会返回 room_id
```

#### 步骤 2：查看拼车列表
```javascript
// 设置筛选条件
页码: 1
每页数量: 20
地点筛选: (可选)
排序: 最新/即将开始/最热门
时间: 全部/今天/本周

// 点击"获取拼车列表"
// 返回拼车列表数据
```

#### 步骤 3：查看拼车详情
```javascript
// 输入拼车ID
拼车ID: (从步骤1或步骤2获取)

// 点击"查看详情"
// 返回完整的拼车信息
```

#### 步骤 4：申请加入（使用另一个账号）
```javascript
// 输入信息
拼车ID: xxx
申请留言: 我想参加

// 点击"申请加入"
// 等待车主确认
```

#### 步骤 5：车主确认成员
```javascript
// 车主操作
拼车ID: xxx
用户ID: (申请人的ID)

// 点击"确认成员"
// 成员加入拼车
```

#### 步骤 6：查看我的申请
```javascript
// 查看当前用户的所有申请
页码: 1
每页数量: 10

// 点击"查看我的申请"
// 返回申请列表
```

---

## ⚠️ 注意事项

### 1. 登录状态

部分功能需要登录：

| 功能 | 是否需要登录 |
|-----|------------|
| 获取列表 | ❌ 不需要 |
| 查看详情 | ❌ 不需要 |
| **创建拼车** | ✅ 需要 |
| **申请加入** | ✅ 需要 |
| **我的申请** | ✅ 需要 |
| **取消申请** | ✅ 需要 |
| **确认成员** | ✅ 需要（车主）|
| **移除成员** | ✅ 需要（车主）|
| **更新状态** | ✅ 需要（车主）|

### 2. 权限要求

**车主专属操作：**
- confirmMember（确认成员）
- removeMember（移除成员）
- updateStatus（更新状态）

只有拼车的创建者才能执行这些操作。

### 3. 时间格式

游戏时间格式：`YYYY-MM-DD HH:mm`

示例：
- `2025-11-10 14:00`
- `2025-11-15 19:30`

**注意：** 游戏时间必须是未来的时间，不能是过去。

### 4. 状态说明

拼车状态值：

| 值 | 状态 | 说明 |
|----|------|------|
| 1 | 招募中 | 可以申请加入 |
| 2 | 已满员 | 人数已满，不能申请 |
| 3 | 已完成 | 游戏已结束 |
| 4 | 已取消 | 拼车已取消 |

---

## 🎨 界面说明

### 测试结果展示区

每次测试后，结果会显示在页面顶部：

```
┌─────────────────────────────────┐
│ 最后测试结果       ✅ 成功          │
├─────────────────────────────────┤
│ 创建成功                          │
│                                  │
│ 返回数据（部分）：                 │
│ {                                │
│   "room_id": "xxx",              │
│   "room_number": "BOTC123456",  │
│   "status": 1                    │
│ }                                │
└─────────────────────────────────┘
```

### 输入框说明

- **普通输入框** - 输入文本或ID
- **数字输入框** - 只能输入数字
- **选择器** - 点击选择预设选项
- **多行文本** - 输入较长内容（如描述、留言）

---

## 🐛 常见问题

### 1. "Method[xxx] was not found in index.obj.js"

**原因：** Carpool 云对象未上传

**解决：**
```bash
1. 在 HBuilderX 中找到 uniCloud-aliyun/cloudfunctions/carpool
2. 右键点击 carpool 文件夹
3. 选择"上传云函数"
4. 等待上传完成，等待 1-2 分钟
5. 刷新页面重试
```

### 2. "请先登录"

**原因：** 执行需要登录的操作时未登录

**解决：**
```bash
1. 访问登录页面进行登录
2. 或在页面右上角查看登录状态
3. 如果显示"❌ 未登录"，请先登录
```

### 3. "无权操作"

**原因：** 尝试执行车主专属操作但不是车主

**解决：**
```bash
1. 确认操作的拼车是由当前用户创建的
2. 或使用创建拼车的账号登录
3. 车主专属操作：确认成员、移除成员、更新状态
```

### 4. "游戏时间不能是过去的时间"

**原因：** 填写的游戏时间早于当前时间

**解决：**
```bash
1. 使用未来的日期和时间
2. 格式：2025-11-10 14:00
3. 确保日期和时间都是正确的
```

### 5. "房间人数已满"

**原因：** 拼车人数已达到最大值

**解决：**
```bash
1. 查看其他拼车
2. 或等待车主增加人数限制
3. 或创建新的拼车
```

---

## 📊 测试检查清单

### Carpool 云对象完整测试

- [ ] **创建拼车**
  - [ ] 填写完整信息成功创建
  - [ ] 缺少必填项失败
  - [ ] 时间验证（过去时间失败）

- [ ] **拼车列表**
  - [ ] 获取全部列表
  - [ ] 地点筛选
  - [ ] 时间筛选（今天/本周）
  - [ ] 排序（最新/即将开始/最热门）
  - [ ] 分页

- [ ] **拼车详情**
  - [ ] 查看存在的拼车
  - [ ] 查看不存在的拼车（失败）
  - [ ] 详情包含成员列表

- [ ] **申请加入**
  - [ ] 成功申请
  - [ ] 重复申请（失败）
  - [ ] 车主申请自己的拼车（失败）
  - [ ] 人数已满（失败）

- [ ] **我的申请**
  - [ ] 查看申请列表
  - [ ] 分页
  - [ ] 包含拼车信息

- [ ] **取消申请**
  - [ ] 成功取消
  - [ ] 取消不存在的申请（失败）

- [ ] **确认成员（车主）**
  - [ ] 车主成功确认
  - [ ] 非车主操作（失败）
  - [ ] 确认不存在的申请（失败）

- [ ] **移除成员（车主）**
  - [ ] 车主成功移除
  - [ ] 非车主操作（失败）
  - [ ] 移除自己（失败）

- [ ] **更新状态（车主）**
  - [ ] 车主成功更新
  - [ ] 非车主操作（失败）
  - [ ] 无效状态值（失败）

---

## 🚀 快速开始

### 5 分钟快速测试

1. **打开测试页面**
   ```
   http://localhost:5173/#/pages/test/script-test
   ```

2. **切换到 Carpool 页签**
   - 点击页面顶部的 "🚗 Carpool" 标签

3. **测试创建拼车（需登录）**
   - 填写标题、时间、地点
   - 点击"创建拼车"
   - 记下返回的 room_id

4. **测试拼车列表**
   - 点击"获取拼车列表"
   - 查看返回的列表数据

5. **测试拼车详情**
   - 输入刚创建的 room_id
   - 点击"查看详情"

✅ 如果以上步骤都成功，说明 Carpool 云对象工作正常！

---

_创建时间：2025-11-04_  
_版本：v2.0 - 支持多云对象测试_  
_下一步：测试所有功能，确保正常工作_

