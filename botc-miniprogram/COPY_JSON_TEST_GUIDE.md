# 「复制JSON」功能测试指南

## 📋 测试前准备

### 1. 确保数据库中有测试剧本
确保 `botc-scripts` 集合中至少有一个剧本包含 `json_data` 字段。

### 2. 测试用户登录
- 确保已登录用户
- 或使用游客模式（可以查看已发布的剧本）

## 🧪 测试步骤

### 测试1：正常复制JSON

#### 步骤：
1. 打开小程序
2. 进入「剧本」→「剧本列表」
3. 选择任意一个已发布的剧本
4. 滚动到页面中部，找到「JSON操作按钮」区域
5. 点击「📋 复制JSON」按钮

#### 预期结果：
- ✅ 按钮显示「⏳ 复制中...」
- ✅ 1秒内显示 Toast：「✅ JSON已复制到剪贴板」
- ✅ 按钮恢复为「📋 复制JSON」

#### 验证方式：
1. 打开微信聊天窗口
2. 长按输入框，选择「粘贴」
3. 应该看到完整的JSON数据（格式化后的）

#### 示例输出：
```json
{
  "meta": [
    {
      "id": "troublebrewing",
      "name": "暗流涌动",
      "author": "TPI"
    }
  ],
  "_roles": [
    ...
  ]
}
```

---

### 测试2：无JSON数据的剧本

#### 步骤：
1. 找到一个没有 `json_data` 字段的剧本
2. 进入剧本详情页
3. 点击「📋 复制JSON」按钮

#### 预期结果：
- ✅ 显示 Toast：「该剧本暂无JSON数据」
- ✅ 按钮状态立即恢复

---

### 测试3：网络异常情况

#### 步骤：
1. 进入剧本详情页
2. 关闭网络或开启飞行模式
3. 刷新页面（会加载失败）
4. 点击「📋 复制JSON」按钮

#### 预期结果：
- ✅ 显示 Toast：「剧本数据不存在」
- ✅ 不会崩溃

---

### 测试4：按钮交互效果

#### 步骤：
1. 进入有JSON数据的剧本详情页
2. 观察按钮样式
3. 点击按钮时观察动画

#### 预期结果：
- ✅ 按钮颜色：蓝色渐变（#4facfe → #00f2fe）
- ✅ 点击时有缩放动画（scale: 0.98）
- ✅ 阴影效果在点击时变化
- ✅ 与下载按钮间距正常（20rpx）

---

### 测试5：复制后使用JSON

#### 步骤：
1. 复制JSON后
2. 打开文本编辑器（如微信记事本）
3. 粘贴内容
4. 验证JSON格式

#### 预期结果：
- ✅ JSON格式正确（有缩进，易读）
- ✅ 数据完整（包含所有角色、元数据等）
- ✅ 可以被JSON解析器正确解析

---

### 测试6：与下载功能对比

#### 步骤：
1. 先点击「📋 复制JSON」
2. 粘贴到文本A
3. 再点击「💾 下载.json文件」
4. 打开下载的文件
5. 对比两者内容

#### 预期结果：
- ✅ 内容完全一致
- ✅ 格式完全一致（都是格式化的JSON）

---

## 🔍 控制台日志检查

### 正常情况日志：
```
[copyJsonToClipboard] 开始复制JSON，剧本ID: xxx
[copyJsonToClipboard] JSON长度: 12345
[copyJsonToClipboard] 复制成功
```

### 异常情况日志：
```
[copyJsonToClipboard] 复制JSON失败: Error: ...
```

## 📱 跨平台测试

### 微信小程序
- ✅ iOS微信
- ✅ Android微信

### H5
- ✅ Chrome浏览器
- ✅ Safari浏览器
- ✅ 微信内置浏览器

## 🐛 已知问题

### 问题1：JSON数据过大
- **现象**：非常大的JSON（>100KB）可能复制缓慢
- **解决方案**：已经使用异步处理，用户体验良好

### 问题2：剪贴板权限
- **现象**：部分手机可能需要用户授权剪贴板权限
- **解决方案**：uni.setClipboardData会自动处理权限请求

## ✅ 测试清单

使用以下清单确保所有功能正常：

- [ ] 正常复制JSON成功
- [ ] 显示成功Toast提示
- [ ] 复制的JSON格式正确
- [ ] 无JSON数据时提示正确
- [ ] 按钮样式符合设计
- [ ] 点击动画流畅
- [ ] 加载状态显示正确
- [ ] 错误处理完善
- [ ] 控制台日志正确
- [ ] 微信小程序测试通过
- [ ] H5测试通过
- [ ] 与下载功能内容一致

## 📊 性能测试

### 复制速度测试
| JSON大小 | 复制耗时 | 用户体验 |
|---------|---------|---------|
| < 10KB  | < 100ms | 极快 ✅ |
| 10-50KB | < 500ms | 快速 ✅ |
| 50-100KB | < 1s   | 正常 ✅ |
| > 100KB | 1-2s   | 可接受 ⚠️ |

## 🎯 验收标准

### 功能完整性
- ✅ 所有测试用例通过
- ✅ 无未处理的错误
- ✅ 日志记录完整

### 用户体验
- ✅ 操作流畅，无卡顿
- ✅ 提示信息清晰友好
- ✅ 按钮样式美观

### 代码质量
- ✅ 无linter错误
- ✅ 代码注释完整
- ✅ 符合项目规范

---

**测试人员**: ___________  
**测试日期**: ___________  
**测试结果**: ☐ 通过  ☐ 未通过  
**备注**: ___________

