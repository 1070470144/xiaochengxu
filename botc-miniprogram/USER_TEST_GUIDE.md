# 📱 User 云对象完整测试指南

## 🎯 测试页面说明

测试页面路径：`pages/test/user-test-complete.vue`

这是一个功能完整的测试页面，包含了 User 云对象的所有 14 个方法的测试。

---

## 🚀 如何访问测试页面

### 方法 1：直接在代码中跳转
在任意页面添加以下代码：
```javascript
uni.navigateTo({
  url: '/pages/test/user-test-complete'
})
```

### 方法 2：在 HBuilderX 中运行
1. 打开 `pages/test/user-test-complete.vue`
2. 点击"运行" → "运行到浏览器" → "Chrome"

### 方法 3：添加到首页入口（推荐）
在 `pages/index/index.vue` 添加一个测试入口按钮。

---

## 📋 测试功能清单

### 1️⃣ 登录模块（2个方法）

#### ✅ sendSms - 发送验证码
**测试步骤：**
1. 输入手机号：`19533284032`
2. 点击"发送验证码"
3. 查看开发模式验证码（自动填充）

**预期结果：**
- ✅ 显示"验证码已发送"
- ✅ 显示开发模式验证码（如：`123456`）
- ✅ 验证码自动填充到登录输入框

#### ✅ login - 用户登录
**测试步骤：**
1. 使用上面获取的验证码
2. 点击"立即登录"

**预期结果：**
- ✅ 显示"登录成功"
- ✅ 页面顶部状态变为"✅ 已登录"
- ✅ 用户昵称自动填充到更新资料表单

---

### 2️⃣ 用户信息模块（2个方法）

#### ✅ getInfo - 获取当前用户信息
**测试步骤：**
1. 确保已登录
2. 点击"获取我的信息"

**预期结果：**
- ✅ 返回完整用户信息
- ✅ 包含：昵称、头像、性别、等级、经验值、关注数、粉丝数

#### ✅ update - 更新用户信息
**测试步骤：**
1. 修改昵称：`测试用户`
2. 选择性别：`男/女/保密`
3. 输入头像URL（可选）：`https://example.com/avatar.jpg`
4. 点击"更新资料"

**预期结果：**
- ✅ 显示"更新成功"
- ✅ 返回更新后的完整用户信息
- ✅ 本地存储已更新

---

### 3️⃣ 他人资料模块（1个方法）

#### ✅ getProfile - 查看他人资料
**测试步骤：**
1. 输入目标用户ID（需要一个真实存在的用户ID）
2. 点击"查看资料"

**预期结果：**
- ✅ 返回用户完整资料
- ✅ 包含：用户信息、统计数据、关注状态
- ✅ 包含：最近帖子、最近评价

**注意：** 需要数据库中有其他用户才能测试。

---

### 4️⃣ 关注功能模块（4个方法）

#### ✅ follow - 关注用户
**测试步骤：**
1. 输入要关注的用户ID
2. 点击"➕ 关注"

**预期结果：**
- ✅ 显示"关注成功"
- ✅ 对方粉丝数+1
- ✅ 自己关注数+1

#### ✅ unfollow - 取消关注
**测试步骤：**
1. 使用同一个用户ID
2. 点击"➖ 取消关注"

**预期结果：**
- ✅ 显示"取消关注成功"
- ✅ 对方粉丝数-1
- ✅ 自己关注数-1

#### ✅ checkFollow - 检查关注状态
**测试步骤：**
1. 输入要检查的用户ID
2. 点击"检查关注状态"

**预期结果：**
- ✅ 显示"已关注"或"未关注"
- ✅ 如果互关显示"（互关）"
- ✅ 返回详细关注状态

#### ✅ getFollowingList - 获取关注列表
**测试步骤：**
1. 输入页码：`1`（默认值）
2. 输入每页数量：`20`（默认值）
3. 点击"获取关注列表"

**预期结果：**
- ✅ 返回关注列表
- ✅ 显示总数：`获取成功，共X人`
- ✅ 包含分页信息

#### ✅ getFollowersList - 获取粉丝列表
**测试步骤：**
1. 点击"获取粉丝列表"

**预期结果：**
- ✅ 返回粉丝列表
- ✅ 显示总数：`获取成功，共X人`
- ✅ 包含分页信息

---

### 5️⃣ 等级系统模块（2个方法）

#### ✅ getLevel - 获取等级信息
**测试步骤：**
1. 留空（查询自己的等级）或输入用户ID
2. 点击"查看等级信息"

**预期结果：**
- ✅ 显示当前等级：`Lv.1 新手玩家`
- ✅ 返回详细等级数据：
  - 当前等级
  - 当前经验值
  - 升级所需经验
  - 等级称号

#### ✅ addExp - 增加经验值
**测试步骤：**
1. 输入目标用户ID
2. 输入经验值数量：`100`
3. 输入原因：`测试`
4. 点击"增加经验值"

**预期结果：**
- ✅ 显示"经验值增加成功"
- ✅ 如果升级显示"升级到X级！"
- ✅ 返回最新等级信息

**注意：** 此功能通常由系统调用，测试时需要有足够的权限。

---

### 6️⃣ 登出模块（1个方法）

#### ✅ logout - 退出登录
**测试步骤：**
1. 确保已登录
2. 点击"退出登录"

**预期结果：**
- ✅ 显示"已退出登录"
- ✅ 页面顶部状态变为"❌ 未登录"
- ✅ 本地存储已清除

---

## 🎨 测试页面功能

### 1. 实时结果展示
- 每次测试后，结果会显示在页面顶部的"最后测试结果"面板
- 成功显示绿色 ✅，失败显示红色 ❌
- 完整显示返回的 JSON 数据

### 2. 登录状态检测
- 页面顶部实时显示登录状态
- 需要登录的功能会自动禁用（未登录时）

### 3. 自动填充
- 发送验证码后，开发模式验证码自动填充
- 登录成功后，用户信息自动填充

### 4. 详细日志
- 所有操作都会在控制台输出详细日志
- 格式：`✅ 成功消息` 或 `❌ 错误消息`

---

## 🧪 完整测试流程（推荐顺序）

### 阶段 1：登录测试
1. ✅ 发送验证码 → 获取开发模式验证码
2. ✅ 登录 → 使用验证码登录

### 阶段 2：用户信息测试
3. ✅ 获取当前用户信息 → 查看完整资料
4. ✅ 更新用户信息 → 修改昵称、性别

### 阶段 3：关注功能测试
5. ✅ 关注用户 → 需要另一个用户ID
6. ✅ 检查关注状态 → 应显示"已关注"
7. ✅ 获取关注列表 → 应包含刚关注的用户
8. ✅ 取消关注 → 取消刚才的关注
9. ✅ 获取粉丝列表 → 查看粉丝

### 阶段 4：等级系统测试
10. ✅ 获取等级信息 → 查看自己的等级
11. ✅ 增加经验值 → 测试升级逻辑

### 阶段 5：他人资料测试
12. ✅ 查看他人资料 → 查看其他用户资料

### 阶段 6：登出测试
13. ✅ 退出登录 → 清除登录状态

---

## 🐛 常见问题排查

### 问题 1：发送验证码失败
**可能原因：**
- 手机号格式不正确
- 云对象未上传或未更新

**解决方法：**
- 检查手机号是否为11位数字
- 重新上传 `user` 云对象

### 问题 2：登录后仍显示未登录
**可能原因：**
- Token 未正确保存

**解决方法：**
- 检查浏览器控制台是否有错误
- 查看 Storage 中是否有 `uni_id_token`

### 问题 3：关注功能测试失败
**可能原因：**
- 目标用户ID不存在
- 自己关注自己

**解决方法：**
- 使用真实存在的用户ID
- 不要使用自己的ID

### 问题 4：返回数据为空
**可能原因：**
- 数据库中没有相关数据

**解决方法：**
- 先创建测试数据
- 检查数据库表是否正确

---

## 📊 测试数据准备

### 1. 用户数据
至少需要 2 个用户才能完整测试关注功能：
- 用户A（当前登录用户）
- 用户B（测试关注的目标用户）

### 2. 测试手机号
开发环境使用：`19533284032`

### 3. 测试用户ID
需要从数据库获取真实的用户ID用于测试：
- 查看他人资料
- 关注/取消关注
- 检查关注状态

---

## 📝 测试记录模板

```
# User 云对象测试记录

测试时间：2025-11-03
测试人员：[你的名字]
测试环境：开发环境 / 生产环境

## 登录模块
- [ ] sendSms - 发送验证码：✅ 成功 / ❌ 失败
- [ ] login - 用户登录：✅ 成功 / ❌ 失败

## 用户信息模块
- [ ] getInfo - 获取用户信息：✅ 成功 / ❌ 失败
- [ ] update - 更新用户信息：✅ 成功 / ❌ 失败

## 他人资料模块
- [ ] getProfile - 查看他人资料：✅ 成功 / ❌ 失败

## 关注功能模块
- [ ] follow - 关注用户：✅ 成功 / ❌ 失败
- [ ] unfollow - 取消关注：✅ 成功 / ❌ 失败
- [ ] checkFollow - 检查关注状态：✅ 成功 / ❌ 失败
- [ ] getFollowingList - 关注列表：✅ 成功 / ❌ 失败
- [ ] getFollowersList - 粉丝列表：✅ 成功 / ❌ 失败

## 等级系统模块
- [ ] getLevel - 获取等级信息：✅ 成功 / ❌ 失败
- [ ] addExp - 增加经验值：✅ 成功 / ❌ 失败

## 登出模块
- [ ] logout - 退出登录：✅ 成功 / ❌ 失败

## 问题记录
1. [问题描述]
   - 原因：[分析]
   - 解决：[方案]

## 总结
- 通过数：X/14
- 失败数：X/14
- 测试结论：✅ 通过 / ❌ 未通过
```

---

## 🎯 下一步

测试完成后：
1. ✅ 记录测试结果
2. ✅ 修复发现的问题
3. ✅ 更新文档
4. ✅ 开始其他云对象开发

---

**创建时间：** 2025-11-03  
**测试页面：** `pages/test/user-test-complete.vue`  
**功能覆盖：** 14/14 个方法

