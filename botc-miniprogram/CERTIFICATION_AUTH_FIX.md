# ğŸ”§ è®¤è¯é¡µé¢ç™»å½•æ£€æŸ¥ä¿®å¤

## âœ… é—®é¢˜å·²è§£å†³

å·²ä¿®å¤ç™»å½•æ£€æŸ¥é€»è¾‘ï¼Œä½¿ç”¨æ ‡å‡†çš„ `Auth.isLogin()` æ–¹æ³•ï¼Œä¸å…¶ä»–é¡µé¢ä¿æŒä¸€è‡´ã€‚

---

## âŒ é—®é¢˜æè¿°

**ç°è±¡**ï¼š
- ç”¨æˆ·å·²ç™»å½•
- è®¿é—®è®¤è¯é¡µé¢æ—¶ä»æç¤º"è¯·å…ˆç™»å½•"

**åŸå› **ï¼š
- ä¹‹å‰ä½¿ç”¨ç®€å•çš„ `uni.getStorageSync('uni_id_token')` æ£€æŸ¥
- æ²¡æœ‰æ£€æŸ¥ token è¿‡æœŸæ—¶é—´
- æ²¡æœ‰ä½¿ç”¨é¡¹ç›®ç»Ÿä¸€çš„ Auth å·¥å…·ç±»

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®æ”¹å‰ï¼ˆæœ‰é—®é¢˜ï¼‰

```javascript
checkLogin() {
  const token = uni.getStorageSync('uni_id_token')
  
  if (!token) {
    uni.showToast({ title: 'è¯·å…ˆç™»å½•', icon: 'none' })
    setTimeout(() => {
      uni.reLaunch({ url: '/pages/login/sms-login' })
    }, 500)
    return false
  }
  
  this.loadCertificationInfo()
  return true
}
```

**é—®é¢˜**ï¼š
- âŒ åªæ£€æŸ¥ token å­˜åœ¨æ€§
- âŒ ä¸æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸ
- âŒ ä¸å…¶ä»–é¡µé¢é€»è¾‘ä¸ä¸€è‡´

### ä¿®æ”¹åï¼ˆæ­£ç¡®ï¼‰

```javascript
import Auth from '@/utils/auth.js'

checkLogin() {
  if (!Auth.isLogin()) {
    Auth.toLogin()
    return false
  }
  
  this.loadCertificationInfo()
  return true
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… ä½¿ç”¨é¡¹ç›®ç»Ÿä¸€çš„ Auth å·¥å…·ç±»
- âœ… å®Œæ•´çš„ç™»å½•æ£€æŸ¥ï¼ˆtoken + è¿‡æœŸæ—¶é—´ï¼‰
- âœ… ä¸å…¶ä»–é¡µé¢é€»è¾‘ä¸€è‡´
- âœ… ä»£ç æ›´ç®€æ´

---

## ğŸ” Auth.isLogin() è¯¦è§£

### å®Œæ•´æ£€æŸ¥é€»è¾‘

```javascript
static isLogin() {
  const token = uni.getStorageSync('uni_id_token')
  const tokenExpired = uni.getStorageSync('uni_id_token_expired')
  
  // 1. æ£€æŸ¥ token æ˜¯å¦å­˜åœ¨
  if (!token) {
    return false
  }
  
  // 2. æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸ
  if (tokenExpired && tokenExpired < Date.now()) {
    this.logout()  // è‡ªåŠ¨æ¸…ç†è¿‡æœŸ token
    return false
  }
  
  return true
}
```

### æ£€æŸ¥é¡¹

1. **Token å­˜åœ¨æ€§æ£€æŸ¥**
   - æ£€æŸ¥ `uni_id_token` æ˜¯å¦å­˜å‚¨

2. **Token è¿‡æœŸæ£€æŸ¥**
   - æ£€æŸ¥ `uni_id_token_expired` æ—¶é—´æˆ³
   - ä¸å½“å‰æ—¶é—´å¯¹æ¯”
   - è¿‡æœŸåˆ™è‡ªåŠ¨æ¸…ç†

3. **è‡ªåŠ¨æ¸…ç†**
   - Token è¿‡æœŸæ—¶è°ƒç”¨ `logout()`
   - æ¸…ç† tokenã€userInfo ç­‰æ•°æ®

---

## ğŸ“Š å…¶ä»–é¡µé¢ä½¿ç”¨ç¤ºä¾‹

### profile.vueï¼ˆä¸ªäººä¸­å¿ƒï¼‰

```javascript
import Auth from '@/utils/auth.js'

onLoad() {
  this.checkLogin()
}

checkLogin() {
  if (!Auth.isLogin()) {
    Auth.toLogin()
    return
  }
  this.loadUserData()
}
```

### my-posts.vueï¼ˆæˆ‘çš„å¸–å­ï¼‰

```javascript
import Auth from '@/utils/auth.js'

onLoad() {
  if (!Auth.isLogin()) {
    Auth.toLogin()
    return
  }
  this.loadPosts()
}
```

### ç»Ÿä¸€æ¨¡å¼

**æ‰€æœ‰éœ€è¦ç™»å½•çš„é¡µé¢éƒ½ä½¿ç”¨ç›¸åŒé€»è¾‘**ï¼š
1. å¯¼å…¥ `Auth`
2. è°ƒç”¨ `Auth.isLogin()` æ£€æŸ¥
3. æœªç™»å½•åˆ™è°ƒç”¨ `Auth.toLogin()`

---

## ğŸ¯ ä¸ºä»€ä¹ˆä¼šå‡ºç°"å·²ç™»å½•è¿˜æç¤ºç™»å½•"

### å¯èƒ½åŸå› 

1. **Token å­˜åœ¨ä½†è¿‡æœŸ**
   ```
   uni_id_token: "xxxxx"           âœ… å­˜åœ¨
   uni_id_token_expired: 1234567   âŒ å·²è¿‡æœŸ
   ```
   ç®€å•æ£€æŸ¥åªçœ‹åˆ° token å­˜åœ¨ï¼Œä½† `Auth.isLogin()` ä¼šæ£€æµ‹åˆ°è¿‡æœŸ

2. **Token è¢«æ¸…ç†**
   - ç”¨æˆ·åœ¨å…¶ä»–é¡µé¢é€€å‡ºç™»å½•
   - Token è¢«æ¸…ç†
   - ä½†é¡µé¢ç¼“å­˜è¿˜åœ¨

3. **å¤šç«¯ç™»å½•å†²çª**
   - åœ¨å…¶ä»–è®¾å¤‡ç™»å½•
   - å½“å‰è®¾å¤‡ token å¤±æ•ˆ

### Auth.isLogin() çš„ä¼˜åŠ¿

**å…¨é¢æ£€æŸ¥**ï¼š
- æ£€æŸ¥ token å­˜åœ¨
- æ£€æŸ¥ token è¿‡æœŸ
- è‡ªåŠ¨æ¸…ç†æ— æ•ˆ token

**ä¸€è‡´æ€§**ï¼š
- ä¸é¡¹ç›®å…¶ä»–é¡µé¢é€»è¾‘ç»Ÿä¸€
- å‡å°‘ç»´æŠ¤æˆæœ¬

---

## ğŸ”„ å®Œæ•´æµç¨‹å¯¹æ¯”

### ä¿®æ”¹å‰

```
è¿›å…¥è®¤è¯é¡µé¢
    â†“
æ£€æŸ¥ token æ˜¯å¦å­˜åœ¨
    â†“
å­˜åœ¨ â†’ åŠ è½½è®¤è¯ä¿¡æ¯
ä¸å­˜åœ¨ â†’ è·³è½¬ç™»å½•
```

**é—®é¢˜**ï¼šä¸æ£€æŸ¥è¿‡æœŸæ—¶é—´

### ä¿®æ”¹å

```
è¿›å…¥è®¤è¯é¡µé¢
    â†“
è°ƒç”¨ Auth.isLogin()
    â†“
æ£€æŸ¥ token å­˜åœ¨ + æ£€æŸ¥è¿‡æœŸæ—¶é—´
    â†“
æœ‰æ•ˆ â†’ åŠ è½½è®¤è¯ä¿¡æ¯
æ— æ•ˆ â†’ è‡ªåŠ¨æ¸…ç† + è·³è½¬ç™»å½•
```

**ä¼˜åŠ¿**ï¼šå®Œæ•´å¯é 

---

## âœ… æµ‹è¯•éªŒè¯

### æµ‹è¯•1ï¼šæ­£å¸¸ç™»å½•

**æ­¥éª¤**ï¼š
1. æ­£å¸¸ç™»å½•
2. è¿›å…¥"è¯´ä¹¦äººè®¤è¯"

**é¢„æœŸ**ï¼š
- âœ… ç›´æ¥æ˜¾ç¤ºè®¤è¯é¡µé¢
- âœ… æ­£å¸¸åŠ è½½è®¤è¯ä¿¡æ¯

### æµ‹è¯•2ï¼šToken è¿‡æœŸ

**æ­¥éª¤**ï¼š
1. ä¿®æ”¹ `uni_id_token_expired` ä¸ºè¿‡å»æ—¶é—´
2. è¿›å…¥"è¯´ä¹¦äººè®¤è¯"

**é¢„æœŸ**ï¼š
- âœ… æ£€æµ‹åˆ° token è¿‡æœŸ
- âœ… è‡ªåŠ¨æ¸…ç† token
- âœ… è·³è½¬åˆ°ç™»å½•é¡µ

### æµ‹è¯•3ï¼šæœªç™»å½•

**æ­¥éª¤**ï¼š
1. æ¸…é™¤æ‰€æœ‰ storage
2. è¿›å…¥"è¯´ä¹¦äººè®¤è¯"

**é¢„æœŸ**ï¼š
- âœ… æ£€æµ‹åˆ°æœªç™»å½•
- âœ… è·³è½¬åˆ°ç™»å½•é¡µ

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶

### certification.vue

**ä¿®æ”¹å†…å®¹**ï¼š
```diff
+ import Auth from '@/utils/auth.js'

  checkLogin() {
-   const token = uni.getStorageSync('uni_id_token')
-   if (!token) {
-     uni.showToast({ title: 'è¯·å…ˆç™»å½•', icon: 'none' })
-     setTimeout(() => {
-       uni.reLaunch({ url: '/pages/login/sms-login' })
-     }, 500)
+   if (!Auth.isLogin()) {
+     Auth.toLogin()
      return false
    }
    
    this.loadCertificationInfo()
    return true
  }
```

**ä»£ç ç»Ÿè®¡**ï¼š
- æ–°å¢ï¼š2è¡Œ
- åˆ é™¤ï¼š8è¡Œ
- å‡€å‡å°‘ï¼š6è¡Œ
- æ›´ç®€æ´ï¼âœ…

---

## ğŸ‰ æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›

âœ… **ä½¿ç”¨æ ‡å‡† Auth å·¥å…·ç±»** - ä¸é¡¹ç›®ä¿æŒä¸€è‡´  
âœ… **å®Œæ•´çš„ç™»å½•æ£€æŸ¥** - Token + è¿‡æœŸæ—¶é—´  
âœ… **è‡ªåŠ¨æ¸…ç†æœºåˆ¶** - è¿‡æœŸ token è‡ªåŠ¨æ¸…é™¤  
âœ… **ä»£ç æ›´ç®€æ´** - å‡å°‘6è¡Œä»£ç   

### é—®é¢˜è§£å†³

âœ… **å·²ç™»å½•è¿˜æç¤ºç™»å½•** â†’ å·²ä¿®å¤  
âœ… **Token è¿‡æœŸæœªæ£€æµ‹** â†’ å·²ä¿®å¤  
âœ… **é€»è¾‘ä¸ä¸€è‡´** â†’ å·²ç»Ÿä¸€  

---

**ä¿®å¤å®Œæˆæ—¶é—´**ï¼š2025-10-27  
**çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤  
**ä»£ç è´¨é‡**ï¼šâœ… 0é”™è¯¯

**ç°åœ¨ç™»å½•æ£€æŸ¥é€»è¾‘å®Œå…¨æ­£ç¡®ï¼** ğŸ”âœ…

