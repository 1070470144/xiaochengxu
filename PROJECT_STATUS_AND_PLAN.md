# 血染钟楼小程序 - 项目状态与开发计划

## 📋 当前项目状态（2025-10-20）

### ✅ 已完成功能模块

#### 1. 用户系统 (90%完成)
- ✅ 微信授权登录
- ✅ 用户资料管理（查看、编辑）
- ✅ 用户关注/粉丝系统
- ✅ 用户收藏夹
- ✅ 浏览历史
- ⚠️ **缺失**: 用户等级和经验值系统

#### 2. 剧本系统 (95%完成)
- ✅ 剧本列表（分页、搜索）
- ✅ 剧本详情页
- ✅ 剧本上传（JSON）
- ✅ 剧本下载
- ✅ JSON链接生成（新）
- ✅ 剧本评论和评分
- ✅ 剧本收藏
- ✅ 热度计算
- ⚠️ **缺失**: 完整的排行榜云函数

#### 3. 社交功能 (85%完成)
- ✅ 私聊系统
- ✅ 会话列表
- ✅ 消息已读状态
- ✅ 社区帖子
- ✅ 点赞和评论
- ⚠️ **缺失**: WebSocket实时推送（目前是轮询）

#### 4. 拼车功能 (80%完成)
- ✅ 拼车创建
- ✅ 拼车列表（筛选）
- ✅ 拼车报名
- ✅ 拼车详情
- ⚠️ **缺失**: 发起人确认/拒绝机制
- ⚠️ **缺失**: 拼车状态自动更新

#### 5. 说书人系统 (70%完成)
- ✅ 说书人列表
- ✅ 说书人详情页
- ✅ 说书人评价
- ⚠️ **缺失**: 说书人认证申请流程
- ⚠️ **缺失**: 认证审核（需要后台）

#### 6. 百科功能 (90%完成)
- ✅ 角色百科
- ✅ 百科搜索
- ✅ 角色详情
- ✅ 角色评论和点赞

#### 7. 排行榜系统 (60%完成)
- ✅ 前端页面（说书人榜、角色榜）
- ✅ 前端页面（剧本榜单）
- ⚠️ **缺失**: 完整的剧本排行榜云函数
- ⚠️ **缺失**: 定时计算排行榜分数

#### 8. Web管理后台 (0%完成)
- ❌ **未开始**: 完全缺失
- ❌ 需要按照 speckit 规范搭建

---

## 🎯 开发优先级计划

### 第一优先级：立即完成（本周）

#### 1. 部署新功能
- [ ] 部署 `script-json-get` 云函数
- [ ] 配置 HTTP 访问
- [ ] 测试 JSON 链接功能

#### 2. 完善剧本排行榜
**目标**: 实现 speckit 中定义的多维度排行榜

**需要创建的云函数:**
```
script-ranking-hot      # 热门排行（综合浏览、下载、评分）
script-ranking-new      # 最新排行
script-ranking-download # 下载排行
script-ranking-rating   # 评分排行
```

**排行榜算法（按照 speckit）:**
- 热门分数 = 浏览量×0.3 + 下载量×0.4 + 评分×20 + 收藏×0.3
- 最新排行：按创建时间倒序
- 下载排行：按下载次数倒序
- 评分排行：按平均评分倒序

### 第二优先级：核心功能完善（1-2周）

#### 3. 用户等级系统
**目标**: 实现完整的用户等级和经验值体系

**需要实现:**
- 等级配置表（10个等级）
- 经验值计算规则
- 等级升级逻辑
- 前端等级显示
- 云函数：`user-add-exp`, `user-level-info`

**经验值规则（speckit定义）:**
```javascript
{
  LOGIN: 5,           // 每日首次登录
  UPLOAD_SCRIPT: 20,  // 上传剧本
  COMMENT: 10,        // 发表评论
  SHARE: 5,           // 分享内容
  CREATE_CARPOOL: 10, // 创建拼车
  REVIEW: 5           // 评价说书人
}
```

#### 4. 完善拼车功能
**需要添加:**
- 发起人确认/拒绝报名功能
- 拼车状态管理（招募中→已满员→已确认→已结束）
- 过期拼车自动关闭
- 云函数：`carpool-confirm-member`, `carpool-remove-member`, `carpool-close`

### 第三优先级：管理后台（2-3周）

#### 5. Web管理后台搭建
**技术栈（按照 speckit）:**
- Vue 3 + Element Plus
- Vite
- uniCloud 前端网页托管

**核心功能模块:**
1. 仪表盘（数据统计）
2. 剧本管理（审核、删除）
3. 用户管理（查看、禁用）
4. 评论管理
5. 拼车管理
6. 说书人认证审核
7. 内容审核工具

### 第四优先级：体验优化（持续）

#### 6. 性能优化
- [ ] 图片懒加载
- [ ] 列表虚拟滚动
- [ ] Redis 缓存热门数据
- [ ] CDN 静态资源加速

#### 7. 功能增强
- [ ] WebSocket 实时消息推送
- [ ] 消息通知系统
- [ ] 签到系统
- [ ] 任务系统

---

## 📝 当前需要立即解决的问题

### 1. 新增云函数列表

根据 speckit 规范，还需要创建以下云函数：

#### 排行榜相关
```
script-ranking-hot      # 热门排行
script-ranking-new      # 最新排行  
script-ranking-download # 下载排行
script-ranking-rating   # 评分排行
```

#### 用户等级相关
```
user-add-exp           # 增加经验值
user-level-info        # 获取等级信息
user-level-config      # 获取等级配置
```

#### 拼车功能完善
```
carpool-confirm-member # 确认报名成员
carpool-remove-member  # 移除成员
carpool-close         # 关闭招募
carpool-update-status # 更新状态
```

#### 说书人系统
```
storyteller-apply      # 申请成为说书人
storyteller-audit      # 认证审核（后台）
```

#### 管理后台
```
admin-login           # 管理员登录
admin-dashboard       # 数据统计
admin-script-audit    # 剧本审核
admin-user-list       # 用户管理
admin-comment-list    # 评论管理
```

### 2. 数据库表需要添加的字段

根据 speckit 规范检查：

#### uni-id-users 表需要添加:
```javascript
{
  level: 1,              // 用户等级
  exp: 0,                // 经验值
  role: 1,               // 角色（1-普通用户，3-说书人，9-管理员）
  login_count: 0,        // 登录次数
  last_login_at: Date    // 最后登录时间
}
```

#### opendb-botc-scripts 表需要添加:
```javascript
{
  is_featured: false,    // 是否精选
  heat_score: 0          // 热度分数（用于排行）
}
```

---

## 🚀 本周具体开发任务

### Day 1: 部署和测试
1. ✅ 部署 `script-json-get` 云函数
2. ✅ 配置 HTTP 访问
3. ✅ 测试功能

### Day 2-3: 排行榜系统
1. 创建 4 个排行榜云函数
2. 实现排行榜算法
3. 前端接入云函数
4. 测试排行榜数据

### Day 4-5: 用户等级系统
1. 设计等级配置
2. 创建经验值云函数
3. 实现等级升级逻辑
4. 前端显示等级信息

### Day 6-7: 拼车功能完善
1. 添加确认/拒绝功能
2. 完善状态管理
3. 测试完整流程

---

## 📊 项目完成度评估

| 模块 | 完成度 | 状态 |
|------|--------|------|
| 用户系统 | 90% | ⚠️ 缺少等级系统 |
| 剧本系统 | 95% | ⚠️ 排行榜需完善 |
| 社交功能 | 85% | ✅ 基本完善 |
| 拼车功能 | 80% | ⚠️ 状态管理需加强 |
| 说书人系统 | 70% | ⚠️ 缺少认证流程 |
| 百科功能 | 90% | ✅ 基本完善 |
| 排行榜 | 60% | ⚠️ 云函数需补充 |
| Web后台 | 0% | ❌ 未开始 |
| **总体** | **75%** | ⚠️ 核心功能基本完成 |

---

## 🎯 与 speckit 规范的对齐情况

### ✅ 已对齐
1. 使用 uniCloud 云开发架构 ✅
2. 云函数命名规范 ✅
3. 数据库设计基本符合 ✅
4. 核心功能模块完整 ✅

### ⚠️ 需要对齐
1. 用户等级系统（speckit 第 5.4 节）
2. 排行榜算法（speckit 第 4.6 节）
3. 拼车状态管理（speckit 第 5.2 节）
4. Web 管理后台（speckit 第 3.3 节）

### ❌ 缺失
1. Web 管理后台完全缺失
2. 说书人认证审核流程
3. 定时任务（排行榜更新、过期拼车处理）

---

## 💡 开发建议

### 1. 近期重点
**按照 speckit 的阶段规划，项目当前处于阶段二后期。**

建议优先完成：
1. ✅ 排行榜系统（本周）
2. ✅ 用户等级系统（下周）
3. ✅ 拼车功能完善（下周）

### 2. 中期规划
- 开始搭建 Web 管理后台（2-3周）
- 性能优化和用户体验提升
- 小程序提交审核准备

### 3. 技术债务
- WebSocket 实时推送（当前是轮询）
- 图片上传优化
- 缓存策略
- 错误监控

---

## 📌 总结

项目已经完成了大部分核心功能（约 75%），基础架构稳固，代码质量良好。

**当前状态**: 阶段二（社交功能）基本完成，阶段三（拼车功能）进行中

**下一步**: 
1. 完善现有功能与 speckit 规范对齐
2. 开始阶段四（说书人和等级系统）
3. 启动阶段五（后台管理）

**预计上线时间**: 
- 小程序端：2-3周后可提交审核
- Web管理后台：4-6周后完成

项目进展良好，继续按照 speckit 规范推进即可！🎉

