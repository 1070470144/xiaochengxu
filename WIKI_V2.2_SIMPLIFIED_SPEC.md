# 血染百科 v2.2 - 角色管理系统（简化版）

## 🎯 核心功能（精简）

### 1. 角色名称管理
- ✅ 批量添加角色名称
- ✅ 保存到数据库
- ✅ 显示角色列表
- ✅ 删除单个角色
- ✅ 一键同步所有角色

### 2. 搜索功能
- ✅ 按角色名称搜索
- ✅ 按同步状态筛选（已同步/未同步/失败）

### 3. 简化功能
- ❌ 删除"同步所有内容"按钮
- ❌ 删除"仅同步剧本"按钮
- ❌ 删除"仅同步规则"按钮
- ❌ 不需要按剧本筛选
- ❌ 不需要导入/导出功能

---

## 💾 数据库设计

### wiki_role_list

```javascript
{
  _id: String,
  role_name: String,        // 角色名称
  role_url: String,         // 自动生成的URL
  is_synced: Boolean,       // 是否已同步
  last_sync_time: Date,     // 最后同步时间
  sync_status: String,      // success/failed/pending
  sync_error: String,       // 错误信息（如果失败）
  created_at: Date,
  updated_at: Date
}
```

---

## 📱 界面设计（简化版）

```
┌───────────────────────────────────────────┐
│  📚 角色管理                              │
├───────────────────────────────────────────┤
│                                            │
│  🔍 搜索角色                               │
│  ┌─────────────┬──────────────────────┐  │
│  │ [🔍 搜索...] │ [▼ 全部状态      ▼] │  │
│  └─────────────┴──────────────────────┘  │
│                                            │
│  📝 批量添加角色                           │
│  ┌────────────────────────────────────┐  │
│  │ 哲学家                              │  │
│  │ 送茶侍者                            │  │
│  │ 祖母                                │  │
│  │ 水手                                │  │
│  └────────────────────────────────────┘  │
│  [ 添加到列表 ]  [ 清空 ]                │
│                                            │
│  ─────────────────────────────────────   │
│                                            │
│  📋 角色列表（共45个）                    │
│  [ 同步所有未同步角色(21) ] [ 全部重新同步 ]│
│                                            │
│  ┌────────────────────────────────────┐  │
│  │ ✅ 洗衣妇                           │  │
│  │    已同步 | 2025-10-18 14:00       │  │
│  │    [查看] [重新同步] [删除]        │  │
│  │                                     │  │
│  │ ✅ 图书管理员                       │  │
│  │    已同步 | 2025-10-18 14:15       │  │
│  │    [查看] [重新同步] [删除]        │  │
│  │                                     │  │
│  │ ⏳ 哲学家                           │  │
│  │    未同步                           │  │
│  │    [立即同步] [删除]               │  │
│  │                                     │  │
│  │ ❌ 送茶侍者                         │  │
│  │    同步失败：网络超时               │  │
│  │    [重试] [删除]                   │  │
│  └────────────────────────────────────┘  │
│                                            │
│  分页：[上一页] 第1页 [下一页]           │
└───────────────────────────────────────────┘
```

---

## 🔧 开发内容

### 数据库（1个）
1. ✅ wiki_role_list 集合

### 云函数（4个）
2. ✅ wiki-role-add：添加角色到列表
3. ✅ wiki-role-list：获取列表（支持搜索）
4. ✅ wiki-role-delete：删除角色
5. ✅ wiki-role-sync：同步角色（单个/批量）

### 前端页面（1个）
6. ✅ sync.vue 优化：
   - 删除剧本/规则同步按钮
   - 添加搜索框
   - 添加角色名称输入区
   - 添加角色列表展示
   - 添加批量操作按钮

---

## 📋 功能详细说明

### 功能1：添加角色

```
输入框填写：
哲学家
送茶侍者
祖母

点击"添加到列表"
↓
云函数自动：
- 生成URL
- 保存到 wiki_role_list
- 状态：pending（未同步）
↓
列表中显示新角色
```

---

### 功能2：搜索角色

```
搜索框输入：洗
↓
实时筛选显示：
- 洗衣妇
```

状态筛选：
```
选择"已同步"
↓
只显示 sync_status = 'success' 的角色
```

---

### 功能3：同步操作

#### 同步单个
```
点击某个角色的"立即同步"
↓
调用 wiki-admin-sync-single
↓
更新状态和时间
```

#### 批量同步
```
点击"同步所有未同步角色"
↓
查询 is_synced = false 的角色
↓
逐个同步
↓
显示进度：已同步3/21
↓
完成，显示结果
```

---

### 功能4：查看和删除

```
[查看]：跳转到详情页
[删除]：从列表删除（不删除已同步的数据）
[重新同步]：强制重新同步
[重试]：对失败的角色重试
```

---

## ⏱️ 开发时间（简化后）

- **数据库设计**：0.5小时
- **云函数开发**：1.5小时
- **前端界面**：2.5小时
- **测试优化**：1小时

**总计：5.5小时**

---

## 🎊 优势

1. ✅ **永久保存** - 不用每次输入
2. ✅ **批量管理** - 一次添加多个
3. ✅ **状态追踪** - 知道哪些已同步
4. ✅ **搜索快速** - 快速找到角色
5. ✅ **操作简单** - 界面清晰

---

## 🚀 开始开发？

回复 **/implement** 我将立即开发！

包含：
- ✅ 角色名称管理
- ✅ 搜索功能
- ✅ 批量同步
- ❌ 无剧本筛选
- ❌ 无导入导出

---

**版本**: v2.2.0  
**开发时间**: 5.5小时  
**准备好了吗？** 🚀

