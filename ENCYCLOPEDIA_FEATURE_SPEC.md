# è¡€æŸ“ç™¾ç§‘åŠŸèƒ½éœ€æ±‚è§„æ ¼è¯´æ˜

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 åŠŸèƒ½åç§°
è¡€æŸ“ç™¾ç§‘ï¼ˆBlood on the Clocktower Encyclopediaï¼‰- ç½‘é¡µå†…å®¹è§£æä¸å±•ç¤º

### 1.2 åŠŸèƒ½å®šä½
ä¸ºç©å®¶æä¾›ä¸€ä¸ª**ä¾¿æ·çš„è§’è‰²ã€å‰§æœ¬å’Œæ¸¸æˆæœºåˆ¶æŸ¥è¯¢å·¥å…·**ï¼Œé€šè¿‡è¾“å…¥ç™¾ç§‘ç½‘é¡µåœ°å€ï¼Œè‡ªåŠ¨è§£æå¹¶ä»¥å‹å¥½çš„æ–¹å¼å±•ç¤ºè¡€æŸ“é’Ÿæ¥¼ç›¸å…³çŸ¥è¯†å†…å®¹ã€‚

### 1.3 æ ¸å¿ƒä»·å€¼
- ğŸ“š **çŸ¥è¯†èšåˆ**ï¼šå°†åˆ†æ•£çš„ç™¾ç§‘å†…å®¹é›†ä¸­å±•ç¤º
- ğŸ” **å¿«é€ŸæŸ¥è¯¢**ï¼šé€šè¿‡æœç´¢æˆ–URLè¾“å…¥å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€ä¿¡æ¯
- ğŸ“± **ç§»åŠ¨ä¼˜åŒ–**ï¼šå°†PCç«¯ç™¾ç§‘å†…å®¹é€‚é…å°ç¨‹åºå±•ç¤º
- ğŸ’¾ **ç¦»çº¿ç¼“å­˜**ï¼šæŸ¥çœ‹è¿‡çš„å†…å®¹å¯ç¦»çº¿è®¿é—®
- â­ **æ”¶è—ç®¡ç†**ï¼šå¸¸ç”¨å†…å®¹å¿«é€Ÿæ”¶è—

### 1.4 ç›®æ ‡ç”¨æˆ·
- æ–°æ‰‹ç©å®¶ï¼šå­¦ä¹ æ¸¸æˆè§„åˆ™ã€è§’è‰²æŠ€èƒ½
- èµ„æ·±ç©å®¶ï¼šæŸ¥è¯¢å¤æ‚æœºåˆ¶ã€å‰§æœ¬ç»†èŠ‚
- è¯´ä¹¦äººï¼šå‡†å¤‡æ¸¸æˆæ—¶æŸ¥é˜…å‚è€ƒèµ„æ–™

---

## 2. åŠŸèƒ½éœ€æ±‚

### 2.1 æ ¸å¿ƒåŠŸèƒ½

#### 2.1.1 URL è§£æä¸å±•ç¤º
**åŠŸèƒ½æè¿°**ï¼šç”¨æˆ·è¾“å…¥è¡€æŸ“ç™¾ç§‘ç½‘é¡µåœ°å€ï¼Œç³»ç»Ÿè‡ªåŠ¨è§£æå¹¶å±•ç¤ºå†…å®¹

**æ”¯æŒçš„ç™¾ç§‘æº**ï¼š
1. è¡€æŸ“é’Ÿæ¥¼ä¸­æ–‡ Wiki
2. Blood on the Clocktower å®˜æ–¹ Wiki
3. å…¶ä»–ç¤¾åŒºç™¾ç§‘ç«™ç‚¹

**æŠ€æœ¯å®ç°æ–¹æ¡ˆ**ï¼š
```
æ–¹æ¡ˆ1ï¼šåç«¯è§£æï¼ˆæ¨èï¼‰
ç”¨æˆ· â†’ å°ç¨‹åº â†’ äº‘å‡½æ•° â†’ æŠ“å–ç½‘é¡µ â†’ è§£æHTML â†’ è¿”å›ç»“æ„åŒ–æ•°æ® â†’ å°ç¨‹åºå±•ç¤º

ä¼˜ç‚¹ï¼š
- é¿å…è·¨åŸŸé—®é¢˜
- å¯ä»¥ç¼“å­˜å†…å®¹
- ç»Ÿä¸€ç®¡ç†
- å¯ä»¥åšå†…å®¹å®¡æ ¸

æ–¹æ¡ˆ2ï¼šå°ç¨‹åºç›´æ¥è¯·æ±‚
ç”¨æˆ· â†’ å°ç¨‹åº â†’ ç½‘é¡µåœ°å€ â†’ è¿”å›HTML â†’ æœ¬åœ°è§£æ â†’ å±•ç¤º

ç¼ºç‚¹ï¼š
- å¾®ä¿¡å°ç¨‹åºå¯¹ç¬¬ä¸‰æ–¹ç½‘ç»œè¯·æ±‚æœ‰é™åˆ¶
- éœ€è¦é…ç½®åˆæ³•åŸŸå
- æ— æ³•ç¼“å­˜ä¼˜åŒ–
```

**é‡‡ç”¨æ–¹æ¡ˆ**ï¼šæ–¹æ¡ˆ1 - äº‘å‡½æ•°åç«¯è§£æ

#### 2.1.2 å†…å®¹åˆ†ç±»å±•ç¤º
å°†ç™¾ç§‘å†…å®¹åˆ†ä¸ºä»¥ä¸‹ç±»åˆ«ï¼š
- ğŸ­ **è§’è‰²ç™¾ç§‘**ï¼šè§’è‰²åç§°ã€é˜µè¥ã€èƒ½åŠ›ã€ç©æ³•æŠ€å·§
- ğŸ“œ **å‰§æœ¬ç™¾ç§‘**ï¼šå‰§æœ¬ä»‹ç»ã€è§’è‰²é…ç½®ã€æ¸¸æˆæµç¨‹
- âš™ï¸ **æ¸¸æˆæœºåˆ¶**ï¼šè§„åˆ™è¯´æ˜ã€ç‰¹æ®Šæœºåˆ¶ã€å¸¸è§é—®é¢˜
- ğŸ›ï¸ **æ¸¸æˆèƒŒæ™¯**ï¼šæ•…äº‹è®¾å®šã€ä¸–ç•Œè§‚

#### 2.1.3 æœç´¢åŠŸèƒ½
- **å…³é”®è¯æœç´¢**ï¼šæ”¯æŒè§’è‰²åã€æŠ€èƒ½åã€å‰§æœ¬å
- **æ™ºèƒ½æ¨è**ï¼šæ ¹æ®ç”¨æˆ·æŸ¥è¯¢å†å²æ¨èç›¸å…³å†…å®¹
- **çƒ­é—¨è¯æ¡**ï¼šæ˜¾ç¤ºæœ€å¸¸æŸ¥è¯¢çš„ç™¾ç§‘è¯æ¡

#### 2.1.4 æ”¶è—ä¸å†å²
- **æ”¶è—åŠŸèƒ½**ï¼šç”¨æˆ·å¯æ”¶è—å¸¸ç”¨ç™¾ç§‘è¯æ¡
- **æµè§ˆå†å²**ï¼šè®°å½•ç”¨æˆ·æœ€è¿‘æŸ¥çœ‹çš„è¯æ¡
- **å¿«é€Ÿè®¿é—®**ï¼šé¦–é¡µå¿«æ·å…¥å£è®¿é—®æ”¶è—å’Œå†å²

### 2.2 æ•°æ®ç®¡ç†

#### 2.2.1 ç¼“å­˜ç­–ç•¥
- **äº‘ç«¯ç¼“å­˜**ï¼šè§£æåçš„ç™¾ç§‘å†…å®¹ç¼“å­˜7å¤©
- **æœ¬åœ°ç¼“å­˜**ï¼šç”¨æˆ·æŸ¥çœ‹è¿‡çš„å†…å®¹æœ¬åœ°ç¼“å­˜3å¤©
- **æ›´æ–°æœºåˆ¶**ï¼šç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°æˆ–ç¼“å­˜è¿‡æœŸåé‡æ–°æŠ“å–

#### 2.2.2 å†…å®¹å®¡æ ¸
- è‡ªåŠ¨è¿‡æ»¤æ•æ„Ÿè¯
- äººå·¥å®¡æ ¸æœºåˆ¶ï¼ˆç®¡ç†åå°ï¼‰
- ç”¨æˆ·ä¸¾æŠ¥åŠŸèƒ½

---

## 3. æŠ€æœ¯è®¾è®¡

### 3.1 æ•°æ®åº“è®¾è®¡

#### 3.1.1 ç™¾ç§‘å†…å®¹è¡¨ (encyclopedia_entries)
```sql
CREATE TABLE encyclopedia_entries (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    entry_type VARCHAR(20) NOT NULL COMMENT 'è¯æ¡ç±»å‹ï¼šrole-è§’è‰²ï¼Œscript-å‰§æœ¬ï¼Œmechanism-æœºåˆ¶ï¼Œlore-èƒŒæ™¯',
    title VARCHAR(200) NOT NULL COMMENT 'è¯æ¡æ ‡é¢˜',
    subtitle VARCHAR(300) COMMENT 'å‰¯æ ‡é¢˜',
    source_url VARCHAR(500) COMMENT 'æ¥æºURL',
    source_type VARCHAR(50) COMMENT 'æ¥æºç±»å‹ï¼šofficial_wiki, community_wiki',
    content_text TEXT COMMENT 'çº¯æ–‡æœ¬å†…å®¹',
    content_html TEXT COMMENT 'HTMLæ ¼å¼å†…å®¹',
    content_json JSON COMMENT 'ç»“æ„åŒ–å†…å®¹ï¼ˆJSONæ ¼å¼ï¼‰',
    images JSON COMMENT 'å›¾ç‰‡URLæ•°ç»„',
    tags JSON COMMENT 'æ ‡ç­¾æ•°ç»„',
    view_count INT DEFAULT 0 COMMENT 'æŸ¥çœ‹æ¬¡æ•°',
    favorite_count INT DEFAULT 0 COMMENT 'æ”¶è—æ¬¡æ•°',
    search_count INT DEFAULT 0 COMMENT 'æœç´¢æ¬¡æ•°',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0-ä¸‹æ¶ï¼Œ1-æ­£å¸¸ï¼Œ2-å¾…å®¡æ ¸',
    cache_expires_at DATETIME COMMENT 'ç¼“å­˜è¿‡æœŸæ—¶é—´',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at DATETIME COMMENT 'è½¯åˆ é™¤æ—¶é—´',
    INDEX idx_type (entry_type),
    INDEX idx_title (title),
    INDEX idx_source_url (source_url),
    INDEX idx_status (status),
    INDEX idx_view_count (view_count),
    INDEX idx_cache_expires (cache_expires_at),
    FULLTEXT INDEX ft_title_content (title, content_text) WITH PARSER ngram
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç™¾ç§‘è¯æ¡è¡¨';
```

#### 3.1.2 ç”¨æˆ·æ”¶è—ç™¾ç§‘è¡¨ (user_encyclopedia_favorites)
```sql
CREATE TABLE user_encyclopedia_favorites (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    entry_id BIGINT NOT NULL COMMENT 'è¯æ¡ID',
    notes TEXT COMMENT 'ç”¨æˆ·å¤‡æ³¨',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_user_entry (user_id, entry_id),
    INDEX idx_user (user_id),
    INDEX idx_entry (entry_id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (entry_id) REFERENCES encyclopedia_entries(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·æ”¶è—ç™¾ç§‘è¡¨';
```

#### 3.1.3 ç™¾ç§‘æµè§ˆå†å²è¡¨ (encyclopedia_history)
```sql
CREATE TABLE encyclopedia_history (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    entry_id BIGINT NOT NULL COMMENT 'è¯æ¡ID',
    view_duration INT DEFAULT 0 COMMENT 'æµè§ˆæ—¶é•¿ï¼ˆç§’ï¼‰',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user (user_id),
    INDEX idx_entry (entry_id),
    INDEX idx_created_at (created_at),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (entry_id) REFERENCES encyclopedia_entries(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç™¾ç§‘æµè§ˆå†å²è¡¨';
```

#### 3.1.4 æœç´¢è®°å½•è¡¨ (encyclopedia_searches)
```sql
CREATE TABLE encyclopedia_searches (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT COMMENT 'ç”¨æˆ·IDï¼ˆå¯ä¸ºç©ºï¼‰',
    keyword VARCHAR(200) NOT NULL COMMENT 'æœç´¢å…³é”®è¯',
    result_count INT DEFAULT 0 COMMENT 'ç»“æœæ•°é‡',
    clicked_entry_id BIGINT COMMENT 'ç‚¹å‡»çš„è¯æ¡ID',
    ip VARCHAR(45) COMMENT 'IPåœ°å€',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user (user_id),
    INDEX idx_keyword (keyword),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æœç´¢è®°å½•è¡¨';
```

### 3.2 äº‘å‡½æ•°è®¾è®¡

#### 3.2.1 ç™¾ç§‘ç›¸å…³äº‘å‡½æ•°
```javascript
// äº‘å‡½æ•°åˆ—è¡¨
encyclopedia-parse-url      // è§£æç™¾ç§‘URL
encyclopedia-detail         // è·å–ç™¾ç§‘è¯¦æƒ…
encyclopedia-list           // è·å–ç™¾ç§‘åˆ—è¡¨
encyclopedia-search         // æœç´¢ç™¾ç§‘
encyclopedia-favorite       // æ”¶è—/å–æ¶ˆæ”¶è—
encyclopedia-favorites      // è·å–æ”¶è—åˆ—è¡¨
encyclopedia-history        // è·å–æµè§ˆå†å²
encyclopedia-hot-keywords   // è·å–çƒ­é—¨æœç´¢è¯
encyclopedia-related        // è·å–ç›¸å…³æ¨è
```

#### 3.2.2 æ ¸å¿ƒäº‘å‡½æ•°å®ç°

##### encyclopedia-parse-url äº‘å‡½æ•°
```javascript
'use strict';
const cheerio = require('cheerio'); // HTMLè§£æåº“
const axios = require('axios');

exports.main = async (event, context) => {
  const { url } = event;
  
  // 1. éªŒè¯URLåˆæ³•æ€§
  if (!url || !isValidEncyclopediaUrl(url)) {
    return {
      code: 400,
      message: 'æ— æ•ˆçš„ç™¾ç§‘åœ°å€'
    };
  }
  
  // 2. æ£€æŸ¥ç¼“å­˜
  const db = uniCloud.database();
  const cached = await db.collection('encyclopedia_entries')
    .where({
      source_url: url,
      cache_expires_at: db.command.gte(new Date())
    })
    .get();
  
  if (cached.data.length > 0) {
    return {
      code: 0,
      message: 'æˆåŠŸï¼ˆæ¥è‡ªç¼“å­˜ï¼‰',
      data: cached.data[0]
    };
  }
  
  // 3. æŠ“å–ç½‘é¡µå†…å®¹
  let html;
  try {
    const response = await axios.get(url, {
      timeout: 10000,
      headers: {
        'User-Agent': 'Mozilla/5.0 (compatible; BOTCWikiBot/1.0)'
      }
    });
    html = response.data;
  } catch (error) {
    return {
      code: 500,
      message: 'ç½‘é¡µæŠ“å–å¤±è´¥ï¼š' + error.message
    };
  }
  
  // 4. è§£æHTMLå†…å®¹
  const parsedData = parseHtmlContent(html, url);
  
  // 5. å†…å®¹å®¡æ ¸
  const auditResult = await contentAudit(parsedData.content_text);
  if (!auditResult.pass) {
    return {
      code: 403,
      message: 'å†…å®¹åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œæ— æ³•å±•ç¤º'
    };
  }
  
  // 6. ä¿å­˜åˆ°æ•°æ®åº“
  parsedData.cache_expires_at = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000); // 7å¤©åè¿‡æœŸ
  parsedData.status = 1; // æ­£å¸¸çŠ¶æ€
  
  const result = await db.collection('encyclopedia_entries').add(parsedData);
  parsedData.id = result.id;
  
  // 7. å¢åŠ ç»éªŒå€¼
  if (event.userId) {
    await uniCloud.callFunction({
      name: 'user-add-exp',
      data: {
        userId: event.userId,
        expType: 'VIEW_ENCYCLOPEDIA',
        amount: 2
      }
    });
  }
  
  return {
    code: 0,
    message: 'è§£ææˆåŠŸ',
    data: parsedData
  };
};

// è§£æHTMLå†…å®¹
function parseHtmlContent(html, url) {
  const $ = cheerio.load(html);
  
  // æ ¹æ®ä¸åŒçš„ç™¾ç§‘ç½‘ç«™ï¼Œä½¿ç”¨ä¸åŒçš„è§£æè§„åˆ™
  let parser;
  if (url.includes('botc.wiki')) {
    parser = parseBOTCWiki;
  } else if (url.includes('bloodontheclocktower.com')) {
    parser = parseOfficialWiki;
  } else {
    parser = parseGenericWiki;
  }
  
  return parser($, url);
}

// è§£æ BOTC Wiki
function parseBOTCWiki($, url) {
  // æå–æ ‡é¢˜
  const title = $('#firstHeading').text().trim() || $('h1').first().text().trim();
  
  // æå–å†…å®¹
  const contentHtml = $('#mw-content-text').html() || $('article').html();
  const contentText = $('#mw-content-text').text().trim() || $('article').text().trim();
  
  // æå–å›¾ç‰‡
  const images = [];
  $('.image img, article img').each((i, elem) => {
    const src = $(elem).attr('src') || $(elem).attr('data-src');
    if (src) {
      images.push(src.startsWith('http') ? src : 'https:' + src);
    }
  });
  
  // æå–åˆ†ç±»å’Œæ ‡ç­¾
  const tags = [];
  $('.category, .tag').each((i, elem) => {
    tags.push($(elem).text().trim());
  });
  
  // åˆ¤æ–­è¯æ¡ç±»å‹
  let entryType = 'mechanism'; // é»˜è®¤æœºåˆ¶ç±»
  if (title.match(/(è§’è‰²|Character)/i) || contentText.includes('é˜µè¥')) {
    entryType = 'role';
  } else if (title.match(/(å‰§æœ¬|Script)/i)) {
    entryType = 'script';
  } else if (contentText.includes('æ•…äº‹') || contentText.includes('èƒŒæ™¯')) {
    entryType = 'lore';
  }
  
  // æ„å»ºç»“æ„åŒ–å†…å®¹
  const contentJson = {
    sections: extractSections($),
    infobox: extractInfobox($),
    relatedLinks: extractRelatedLinks($)
  };
  
  return {
    entry_type: entryType,
    title: title,
    source_url: url,
    source_type: 'botc_wiki',
    content_text: contentText.substring(0, 10000), // é™åˆ¶æ–‡æœ¬é•¿åº¦
    content_html: contentHtml,
    content_json: contentJson,
    images: images.slice(0, 20), // æœ€å¤š20å¼ å›¾ç‰‡
    tags: tags
  };
}

// æå–ç« èŠ‚
function extractSections($) {
  const sections = [];
  $('h2, h3').each((i, elem) => {
    const heading = $(elem).text().trim();
    const content = $(elem).nextUntil('h2, h3').text().trim();
    if (heading && content) {
      sections.push({ heading, content });
    }
  });
  return sections;
}

// æå–ä¿¡æ¯æ¡†
function extractInfobox($) {
  const infobox = {};
  $('.infobox tr, .info-box tr').each((i, elem) => {
    const key = $(elem).find('th').text().trim();
    const value = $(elem).find('td').text().trim();
    if (key && value) {
      infobox[key] = value;
    }
  });
  return infobox;
}

// æå–ç›¸å…³é“¾æ¥
function extractRelatedLinks($) {
  const links = [];
  $('.related-links a, .see-also a').each((i, elem) => {
    const text = $(elem).text().trim();
    const href = $(elem).attr('href');
    if (text && href) {
      links.push({ text, href });
    }
  });
  return links.slice(0, 10); // æœ€å¤š10ä¸ªç›¸å…³é“¾æ¥
}

// éªŒè¯URL
function isValidEncyclopediaUrl(url) {
  const validDomains = [
    'botc.wiki',
    'bloodontheclocktower.com',
    'wiki.bloodontheclocktower.com'
  ];
  
  try {
    const urlObj = new URL(url);
    return validDomains.some(domain => urlObj.hostname.includes(domain));
  } catch {
    return false;
  }
}

// å†…å®¹å®¡æ ¸
async function contentAudit(content) {
  // è°ƒç”¨å¾®ä¿¡å†…å®¹å®‰å…¨API
  try {
    const res = await uniCloud.httpclient.request({
      method: 'POST',
      url: 'https://api.weixin.qq.com/wxa/msg_sec_check',
      data: {
        content: content.substring(0, 1000) // å®¡æ ¸å‰1000å­—ç¬¦
      },
      contentType: 'json'
    });
    
    return {
      pass: res.data.errcode === 0
    };
  } catch (error) {
    // å®¡æ ¸å¤±è´¥æ—¶å…è®¸é€šè¿‡
    console.error('å†…å®¹å®¡æ ¸å¤±è´¥', error);
    return { pass: true };
  }
}
```

##### encyclopedia-search äº‘å‡½æ•°
```javascript
'use strict';

exports.main = async (event, context) => {
  const { keyword, page = 1, pageSize = 20, userId } = event;
  
  if (!keyword || keyword.trim().length === 0) {
    return {
      code: 400,
      message: 'æœç´¢å…³é”®è¯ä¸èƒ½ä¸ºç©º'
    };
  }
  
  const db = uniCloud.database();
  const _ = db.command;
  
  // è®°å½•æœç´¢
  await db.collection('encyclopedia_searches').add({
    user_id: userId || null,
    keyword: keyword.trim(),
    created_at: new Date()
  });
  
  // æœç´¢è¯æ¡ï¼ˆæ ‡é¢˜å’Œå†…å®¹ï¼‰
  const searchResult = await db.collection('encyclopedia_entries')
    .where({
      status: 1,
      _or: [
        { title: new RegExp(keyword, 'i') },
        { content_text: new RegExp(keyword, 'i') },
        { tags: _.in([keyword]) }
      ]
    })
    .field({
      id: true,
      entry_type: true,
      title: true,
      subtitle: true,
      images: true,
      tags: true,
      view_count: true,
      favorite_count: true
    })
    .orderBy('view_count', 'desc')
    .skip((page - 1) * pageSize)
    .limit(pageSize)
    .get();
  
  // æ›´æ–°æœç´¢ç»“æœæ•°é‡
  await db.collection('encyclopedia_searches')
    .where({ keyword: keyword.trim() })
    .orderBy('created_at', 'desc')
    .limit(1)
    .update({
      result_count: searchResult.data.length
    });
  
  return {
    code: 0,
    message: 'æœç´¢æˆåŠŸ',
    data: {
      list: searchResult.data,
      total: searchResult.data.length,
      page,
      pageSize,
      keyword
    }
  };
};
```

### 3.3 å°ç¨‹åºé¡µé¢è®¾è®¡

#### 3.3.1 é¡µé¢ç»“æ„
```
pages/encyclopedia/
â”œâ”€â”€ index/              # ç™¾ç§‘é¦–é¡µ
â”‚   â”œâ”€â”€ index.vue
â”‚   â””â”€â”€ index.js
â”œâ”€â”€ parse/              # URLè§£æé¡µé¢
â”‚   â”œâ”€â”€ parse.vue
â”‚   â””â”€â”€ parse.js
â”œâ”€â”€ detail/             # è¯æ¡è¯¦æƒ…
â”‚   â”œâ”€â”€ detail.vue
â”‚   â””â”€â”€ detail.js
â”œâ”€â”€ search/             # æœç´¢é¡µé¢
â”‚   â”œâ”€â”€ search.vue
â”‚   â””â”€â”€ search.js
â”œâ”€â”€ favorites/          # æ”¶è—åˆ—è¡¨
â”‚   â”œâ”€â”€ favorites.vue
â”‚   â””â”€â”€ favorites.js
â””â”€â”€ history/            # æµè§ˆå†å²
    â”œâ”€â”€ history.vue
    â””â”€â”€ history.js
```

#### 3.3.2 ç™¾ç§‘é¦–é¡µ UI è®¾è®¡
```vue
<template>
  <view class="encyclopedia-index">
    <!-- æœç´¢æ  -->
    <view class="search-bar">
      <view class="search-input" @click="goToSearch">
        <image class="search-icon" src="/static/icons/search.png" />
        <text class="search-placeholder">æœç´¢è§’è‰²ã€å‰§æœ¬ã€æ¸¸æˆæœºåˆ¶...</text>
      </view>
      <view class="parse-btn" @click="goToParse">
        <image class="link-icon" src="/static/icons/link.png" />
      </view>
    </view>
    
    <!-- å¿«æ·å…¥å£ -->
    <view class="quick-access">
      <view class="access-item" @click="goToFavorites">
        <image class="access-icon" src="/static/icons/star.png" />
        <text class="access-text">æˆ‘çš„æ”¶è—</text>
        <text class="access-count">{{ favoriteCount }}</text>
      </view>
      <view class="access-item" @click="goToHistory">
        <image class="access-icon" src="/static/icons/history.png" />
        <text class="access-text">æµè§ˆå†å²</text>
        <text class="access-count">{{ historyCount }}</text>
      </view>
    </view>
    
    <!-- çƒ­é—¨æœç´¢ -->
    <view class="hot-keywords">
      <view class="section-title">çƒ­é—¨æœç´¢</view>
      <view class="keyword-list">
        <view 
          v-for="(keyword, index) in hotKeywords" 
          :key="index"
          class="keyword-item"
          @click="searchKeyword(keyword)"
        >
          <text class="keyword-rank">{{ index + 1 }}</text>
          <text class="keyword-text">{{ keyword }}</text>
        </view>
      </view>
    </view>
    
    <!-- åˆ†ç±»å¯¼èˆª -->
    <view class="categories">
      <view class="section-title">åˆ†ç±»æµè§ˆ</view>
      <view class="category-grid">
        <view 
          v-for="category in categories" 
          :key="category.type"
          class="category-item"
          @click="goToCategory(category.type)"
        >
          <image class="category-icon" :src="category.icon" />
          <text class="category-name">{{ category.name }}</text>
          <text class="category-count">{{ category.count }}æ¡</text>
        </view>
      </view>
    </view>
    
    <!-- æ¨èè¯æ¡ -->
    <view class="recommended">
      <view class="section-title">æ¨èè¯æ¡</view>
      <view class="entry-list">
        <encyclopedia-card 
          v-for="entry in recommendedEntries" 
          :key="entry.id"
          :entry="entry"
          @click="goToDetail(entry.id)"
        />
      </view>
    </view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      favoriteCount: 0,
      historyCount: 0,
      hotKeywords: [],
      categories: [
        { type: 'role', name: 'è§’è‰²', icon: '/static/icons/role.png', count: 0 },
        { type: 'script', name: 'å‰§æœ¬', icon: '/static/icons/script.png', count: 0 },
        { type: 'mechanism', name: 'æ¸¸æˆæœºåˆ¶', icon: '/static/icons/mechanism.png', count: 0 },
        { type: 'lore', name: 'æ¸¸æˆèƒŒæ™¯', icon: '/static/icons/lore.png', count: 0 }
      ],
      recommendedEntries: []
    };
  },
  onLoad() {
    this.loadData();
  },
  methods: {
    async loadData() {
      // åŠ è½½ç»Ÿè®¡æ•°æ®
      const stats = await this.getStats();
      this.favoriteCount = stats.favoriteCount;
      this.historyCount = stats.historyCount;
      
      // åŠ è½½çƒ­é—¨å…³é”®è¯
      this.hotKeywords = await this.getHotKeywords();
      
      // åŠ è½½åˆ†ç±»ç»Ÿè®¡
      const categoryCounts = await this.getCategoryCounts();
      this.categories.forEach(cat => {
        cat.count = categoryCounts[cat.type] || 0;
      });
      
      // åŠ è½½æ¨èè¯æ¡
      this.recommendedEntries = await this.getRecommendedEntries();
    },
    
    goToSearch() {
      uni.navigateTo({
        url: '/pages/encyclopedia/search/search'
      });
    },
    
    goToParse() {
      uni.navigateTo({
        url: '/pages/encyclopedia/parse/parse'
      });
    },
    
    goToFavorites() {
      uni.navigateTo({
        url: '/pages/encyclopedia/favorites/favorites'
      });
    },
    
    goToHistory() {
      uni.navigateTo({
        url: '/pages/encyclopedia/history/history'
      });
    },
    
    goToDetail(entryId) {
      uni.navigateTo({
        url: `/pages/encyclopedia/detail/detail?id=${entryId}`
      });
    },
    
    searchKeyword(keyword) {
      uni.navigateTo({
        url: `/pages/encyclopedia/search/search?keyword=${encodeURIComponent(keyword)}`
      });
    },
    
    goToCategory(type) {
      uni.navigateTo({
        url: `/pages/encyclopedia/search/search?type=${type}`
      });
    },
    
    async getStats() {
      const res = await uniCloud.callFunction({
        name: 'encyclopedia-user-stats'
      });
      return res.result.data;
    },
    
    async getHotKeywords() {
      const res = await uniCloud.callFunction({
        name: 'encyclopedia-hot-keywords',
        data: { limit: 10 }
      });
      return res.result.data;
    },
    
    async getCategoryCounts() {
      const res = await uniCloud.callFunction({
        name: 'encyclopedia-category-counts'
      });
      return res.result.data;
    },
    
    async getRecommendedEntries() {
      const res = await uniCloud.callFunction({
        name: 'encyclopedia-list',
        data: { 
          page: 1, 
          pageSize: 6,
          orderBy: 'view_count'
        }
      });
      return res.result.data.list;
    }
  }
};
</script>

<style lang="scss" scoped>
.encyclopedia-index {
  padding: 32rpx;
  background: #F8F8F8;
  min-height: 100vh;
}

.search-bar {
  display: flex;
  align-items: center;
  margin-bottom: 32rpx;
  
  .search-input {
    flex: 1;
    display: flex;
    align-items: center;
    height: 80rpx;
    padding: 0 32rpx;
    background: #FFFFFF;
    border-radius: 40rpx;
    box-shadow: 0 4rpx 20rpx rgba(139, 69, 19, 0.08);
    
    .search-icon {
      width: 40rpx;
      height: 40rpx;
      margin-right: 16rpx;
    }
    
    .search-placeholder {
      font-size: 28rpx;
      color: #999999;
    }
  }
  
  .parse-btn {
    width: 80rpx;
    height: 80rpx;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #8B4513;
    border-radius: 40rpx;
    margin-left: 16rpx;
    
    .link-icon {
      width: 40rpx;
      height: 40rpx;
    }
  }
}

.quick-access {
  display: flex;
  gap: 16rpx;
  margin-bottom: 48rpx;
  
  .access-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 32rpx;
    background: #FFFFFF;
    border-radius: 16rpx;
    box-shadow: 0 4rpx 20rpx rgba(139, 69, 19, 0.08);
    
    .access-icon {
      width: 60rpx;
      height: 60rpx;
      margin-bottom: 16rpx;
    }
    
    .access-text {
      font-size: 26rpx;
      color: #666666;
      margin-bottom: 8rpx;
    }
    
    .access-count {
      font-size: 32rpx;
      font-weight: 600;
      color: #8B4513;
    }
  }
}

.section-title {
  font-size: 32rpx;
  font-weight: 600;
  color: #1A1A1A;
  margin-bottom: 24rpx;
}

.hot-keywords {
  margin-bottom: 48rpx;
  
  .keyword-list {
    display: flex;
    flex-wrap: wrap;
    gap: 16rpx;
    
    .keyword-item {
      display: flex;
      align-items: center;
      padding: 16rpx 24rpx;
      background: #FFFFFF;
      border-radius: 40rpx;
      box-shadow: 0 2rpx 12rpx rgba(139, 69, 19, 0.06);
      
      .keyword-rank {
        width: 40rpx;
        height: 40rpx;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
        color: #FFFFFF;
        font-size: 24rpx;
        font-weight: 600;
        border-radius: 50%;
        margin-right: 12rpx;
      }
      
      .keyword-text {
        font-size: 28rpx;
        color: #333333;
      }
    }
  }
}

.categories {
  margin-bottom: 48rpx;
  
  .category-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16rpx;
    
    .category-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 32rpx;
      background: #FFFFFF;
      border-radius: 16rpx;
      box-shadow: 0 4rpx 20rpx rgba(139, 69, 19, 0.08);
      
      .category-icon {
        width: 80rpx;
        height: 80rpx;
        margin-bottom: 16rpx;
      }
      
      .category-name {
        font-size: 28rpx;
        font-weight: 500;
        color: #333333;
        margin-bottom: 8rpx;
      }
      
      .category-count {
        font-size: 24rpx;
        color: #999999;
      }
    }
  }
}

.recommended {
  .entry-list {
    display: flex;
    flex-direction: column;
    gap: 16rpx;
  }
}
</style>
```

#### 3.3.3 URL è§£æé¡µé¢
```vue
<template>
  <view class="parse-page">
    <view class="parse-header">
      <text class="header-title">è¾“å…¥ç™¾ç§‘åœ°å€</text>
      <text class="header-desc">æ”¯æŒè¡€æŸ“é’Ÿæ¥¼å®˜æ–¹Wikiå’Œç¤¾åŒºç™¾ç§‘</text>
    </view>
    
    <view class="url-input-box">
      <textarea 
        v-model="url"
        class="url-input"
        placeholder="ç²˜è´´ç™¾ç§‘ç½‘é¡µåœ°å€ï¼Œä¾‹å¦‚ï¼šhttps://botc.wiki/..."
        placeholder-class="url-placeholder"
        auto-height
        maxlength="500"
      />
      <view class="input-actions">
        <view class="char-count">{{ url.length }}/500</view>
        <view class="paste-btn" @click="pasteUrl">
          <image class="paste-icon" src="/static/icons/paste.png" />
          <text>ç²˜è´´</text>
        </view>
      </view>
    </view>
    
    <button 
      class="parse-btn" 
      :disabled="!url || parsing"
      :loading="parsing"
      @click="parseUrl"
    >
      {{ parsing ? 'è§£æä¸­...' : 'å¼€å§‹è§£æ' }}
    </button>
    
    <!-- æ”¯æŒçš„ç½‘ç«™è¯´æ˜ -->
    <view class="supported-sites">
      <view class="sites-title">æ”¯æŒçš„ç™¾ç§‘ç½‘ç«™</view>
      <view class="site-list">
        <view class="site-item" v-for="site in supportedSites" :key="site.url">
          <image class="site-icon" :src="site.icon" />
          <view class="site-info">
            <text class="site-name">{{ site.name }}</text>
            <text class="site-url">{{ site.url }}</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- æœ€è¿‘è§£æ -->
    <view class="recent-parses" v-if="recentParses.length > 0">
      <view class="section-title">æœ€è¿‘è§£æ</view>
      <view class="parse-list">
        <view 
          v-for="item in recentParses" 
          :key="item.id"
          class="parse-item"
          @click="goToDetail(item.id)"
        >
          <text class="parse-title">{{ item.title }}</text>
          <text class="parse-time">{{ formatTime(item.created_at) }}</text>
        </view>
      </view>
    </view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      url: '',
      parsing: false,
      supportedSites: [
        {
          name: 'è¡€æŸ“é’Ÿæ¥¼ä¸­æ–‡Wiki',
          url: 'botc.wiki',
          icon: '/static/icons/wiki-cn.png'
        },
        {
          name: 'Blood on the Clocktower Wiki',
          url: 'bloodontheclocktower.com',
          icon: '/static/icons/wiki-en.png'
        }
      ],
      recentParses: []
    };
  },
  onLoad() {
    this.loadRecentParses();
  },
  methods: {
    async pasteUrl() {
      try {
        const res = await uni.getClipboardData();
        this.url = res.data;
        uni.showToast({
          title: 'ç²˜è´´æˆåŠŸ',
          icon: 'success'
        });
      } catch (error) {
        uni.showToast({
          title: 'ç²˜è´´å¤±è´¥',
          icon: 'none'
        });
      }
    },
    
    async parseUrl() {
      if (!this.url) {
        uni.showToast({
          title: 'è¯·è¾“å…¥ç½‘å€',
          icon: 'none'
        });
        return;
      }
      
      this.parsing = true;
      
      try {
        const res = await uniCloud.callFunction({
          name: 'encyclopedia-parse-url',
          data: {
            url: this.url.trim()
          }
        });
        
        if (res.result.code === 0) {
          uni.showToast({
            title: 'è§£ææˆåŠŸ',
            icon: 'success'
          });
          
          // è·³è½¬åˆ°è¯¦æƒ…é¡µ
          setTimeout(() => {
            uni.redirectTo({
              url: `/pages/encyclopedia/detail/detail?id=${res.result.data.id}`
            });
          }, 1000);
        } else {
          uni.showToast({
            title: res.result.message || 'è§£æå¤±è´¥',
            icon: 'none'
          });
        }
      } catch (error) {
        console.error('è§£æå¤±è´¥', error);
        uni.showToast({
          title: 'è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘å€',
          icon: 'none'
        });
      } finally {
        this.parsing = false;
      }
    },
    
    async loadRecentParses() {
      const res = await uniCloud.callFunction({
        name: 'encyclopedia-history',
        data: {
          page: 1,
          pageSize: 5
        }
      });
      this.recentParses = res.result.data.list;
    },
    
    goToDetail(entryId) {
      uni.navigateTo({
        url: `/pages/encyclopedia/detail/detail?id=${entryId}`
      });
    },
    
    formatTime(time) {
      // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
      const date = new Date(time);
      const now = new Date();
      const diff = now - date;
      
      if (diff < 60000) {
        return 'åˆšåˆš';
      } else if (diff < 3600000) {
        return `${Math.floor(diff / 60000)}åˆ†é’Ÿå‰`;
      } else if (diff < 86400000) {
        return `${Math.floor(diff / 3600000)}å°æ—¶å‰`;
      } else {
        return `${Math.floor(diff / 86400000)}å¤©å‰`;
      }
    }
  }
};
</script>

<style lang="scss" scoped>
.parse-page {
  padding: 32rpx;
  background: #F8F8F8;
  min-height: 100vh;
}

.parse-header {
  text-align: center;
  margin-bottom: 48rpx;
  
  .header-title {
    display: block;
    font-size: 40rpx;
    font-weight: 600;
    color: #1A1A1A;
    margin-bottom: 16rpx;
  }
  
  .header-desc {
    display: block;
    font-size: 26rpx;
    color: #666666;
  }
}

.url-input-box {
  background: #FFFFFF;
  border-radius: 16rpx;
  padding: 24rpx;
  margin-bottom: 32rpx;
  box-shadow: 0 4rpx 20rpx rgba(139, 69, 19, 0.08);
  
  .url-input {
    width: 100%;
    min-height: 160rpx;
    font-size: 28rpx;
    color: #333333;
    line-height: 1.6;
  }
  
  .input-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 16rpx;
    
    .char-count {
      font-size: 24rpx;
      color: #999999;
    }
    
    .paste-btn {
      display: flex;
      align-items: center;
      gap: 8rpx;
      padding: 12rpx 24rpx;
      background: #8B4513;
      color: #FFFFFF;
      font-size: 26rpx;
      border-radius: 40rpx;
      
      .paste-icon {
        width: 32rpx;
        height: 32rpx;
      }
    }
  }
}

.parse-btn {
  width: 100%;
  height: 88rpx;
  background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
  color: #FFFFFF;
  font-size: 32rpx;
  font-weight: 600;
  border-radius: 44rpx;
  border: none;
  box-shadow: 0 8rpx 24rpx rgba(139, 69, 19, 0.3);
  margin-bottom: 48rpx;
  
  &[disabled] {
    opacity: 0.5;
    box-shadow: none;
  }
}

.supported-sites {
  margin-bottom: 48rpx;
  
  .sites-title {
    font-size: 28rpx;
    font-weight: 500;
    color: #666666;
    margin-bottom: 24rpx;
  }
  
  .site-list {
    display: flex;
    flex-direction: column;
    gap: 16rpx;
    
    .site-item {
      display: flex;
      align-items: center;
      padding: 24rpx;
      background: #FFFFFF;
      border-radius: 12rpx;
      box-shadow: 0 2rpx 12rpx rgba(139, 69, 19, 0.06);
      
      .site-icon {
        width: 64rpx;
        height: 64rpx;
        margin-right: 24rpx;
        border-radius: 12rpx;
      }
      
      .site-info {
        display: flex;
        flex-direction: column;
        
        .site-name {
          font-size: 28rpx;
          font-weight: 500;
          color: #333333;
          margin-bottom: 8rpx;
        }
        
        .site-url {
          font-size: 24rpx;
          color: #999999;
        }
      }
    }
  }
}

.recent-parses {
  .section-title {
    font-size: 28rpx;
    font-weight: 500;
    color: #666666;
    margin-bottom: 24rpx;
  }
  
  .parse-list {
    display: flex;
    flex-direction: column;
    gap: 16rpx;
    
    .parse-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24rpx;
      background: #FFFFFF;
      border-radius: 12rpx;
      box-shadow: 0 2rpx 12rpx rgba(139, 69, 19, 0.06);
      
      .parse-title {
        flex: 1;
        font-size: 28rpx;
        color: #333333;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      
      .parse-time {
        font-size: 24rpx;
        color: #999999;
        margin-left: 16rpx;
      }
    }
  }
}
</style>
```

### 3.4 Webç®¡ç†åå°è®¾è®¡

#### 3.4.1 ç™¾ç§‘ç®¡ç†é¡µé¢
- è¯æ¡åˆ—è¡¨
- è¯æ¡å®¡æ ¸
- è¯æ¡ç¼–è¾‘
- ç¼“å­˜ç®¡ç†
- ç»Ÿè®¡åˆ†æ

---

## 4. ç”¨æˆ·ä½“éªŒè®¾è®¡

### 4.1 äº¤äº’æµç¨‹

#### 4.1.1 URLè§£ææµç¨‹
```
1. ç”¨æˆ·è¿›å…¥è§£æé¡µé¢
2. ç²˜è´´æˆ–è¾“å…¥ç™¾ç§‘URL
3. ç‚¹å‡»"å¼€å§‹è§£æ"
4. æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼ˆé¢„è®¡éœ€è¦3-5ç§’ï¼‰
5. è§£ææˆåŠŸåè·³è½¬åˆ°è¯¦æƒ…é¡µ
6. å¤±è´¥åˆ™æç¤ºé”™è¯¯ä¿¡æ¯
```

#### 4.1.2 æœç´¢æµç¨‹
```
1. ç”¨æˆ·åœ¨é¦–é¡µç‚¹å‡»æœç´¢æ¡†
2. è¿›å…¥æœç´¢é¡µé¢
3. è¾“å…¥å…³é”®è¯
4. å®æ—¶æ˜¾ç¤ºæœç´¢å»ºè®®
5. é€‰æ‹©ç»“æœæˆ–æŒ‰å›è½¦æœç´¢
6. æ˜¾ç¤ºæœç´¢ç»“æœåˆ—è¡¨
7. ç‚¹å‡»è¿›å…¥è¯æ¡è¯¦æƒ…
```

### 4.2 è§†è§‰è®¾è®¡

#### 4.2.1 é…è‰²æ–¹æ¡ˆ
- ä¸»è‰²ï¼š#8B4513ï¼ˆé’Ÿæ¥¼æ£•ï¼‰
- è¾…åŠ©è‰²ï¼š#D2691Eï¼ˆå·§å…‹åŠ›æ©™ï¼‰
- å¼ºè°ƒè‰²ï¼š#8B0000ï¼ˆæ·±çº¢ - è¡€è‰²ï¼‰
- èƒŒæ™¯è‰²ï¼š#F8F8F8ï¼ˆæµ…ç°ï¼‰
- æ–‡å­—è‰²ï¼š#1A1A1Aï¼ˆæ·±ç°é»‘ï¼‰

#### 4.2.2 å›¾æ ‡è®¾è®¡
- æœç´¢å›¾æ ‡ï¼šæ”¾å¤§é•œ
- é“¾æ¥å›¾æ ‡ï¼šé“¾æ¡/é“¾æ¥ç¬¦å·
- æ”¶è—å›¾æ ‡ï¼šæ˜Ÿæ˜Ÿ
- å†å²å›¾æ ‡ï¼šæ—¶é’Ÿ

### 4.3 æ€§èƒ½ä¼˜åŒ–

#### 4.3.1 åŠ è½½ä¼˜åŒ–
- éª¨æ¶å±åŠ è½½
- å›¾ç‰‡æ‡’åŠ è½½
- æœ¬åœ°ç¼“å­˜ä¼˜å…ˆ
- åˆ†é¡µåŠ è½½

#### 4.3.2 ç¼“å­˜ç­–ç•¥
```javascript
// æœ¬åœ°ç¼“å­˜
const cacheKey = `encyclopedia_${entryId}`;
const cached = uni.getStorageSync(cacheKey);

if (cached && Date.now() - cached.timestamp < 3 * 24 * 60 * 60 * 1000) {
  // 3å¤©å†…çš„ç¼“å­˜ç›´æ¥ä½¿ç”¨
  return cached.data;
}

// å¦åˆ™ä»äº‘ç«¯è·å–
const res = await uniCloud.callFunction({
  name: 'encyclopedia-detail',
  data: { id: entryId }
});

// ä¿å­˜åˆ°æœ¬åœ°
uni.setStorageSync(cacheKey, {
  data: res.result.data,
  timestamp: Date.now()
});
```

---

## 5. å¼€å‘è®¡åˆ’

### 5.1 å¼€å‘é˜¶æ®µ

#### é˜¶æ®µä¸€ï¼šåŸºç¡€åŠŸèƒ½ï¼ˆ2å‘¨ï¼‰
- [ ] æ•°æ®åº“è¡¨è®¾è®¡å’Œåˆ›å»º
- [ ] encyclopedia-parse-url äº‘å‡½æ•°å¼€å‘
- [ ] encyclopedia-detail äº‘å‡½æ•°å¼€å‘
- [ ] ç™¾ç§‘é¦–é¡µUIå®ç°
- [ ] URLè§£æé¡µé¢å®ç°
- [ ] è¯æ¡è¯¦æƒ…é¡µé¢å®ç°

#### é˜¶æ®µäºŒï¼šæœç´¢åŠŸèƒ½ï¼ˆ1å‘¨ï¼‰
- [ ] encyclopedia-search äº‘å‡½æ•°å¼€å‘
- [ ] æœç´¢é¡µé¢UIå®ç°
- [ ] çƒ­é—¨æœç´¢åŠŸèƒ½
- [ ] æœç´¢å†å²è®°å½•

#### é˜¶æ®µä¸‰ï¼šæ”¶è—ä¸å†å²ï¼ˆ1å‘¨ï¼‰
- [ ] encyclopedia-favorite äº‘å‡½æ•°å¼€å‘
- [ ] encyclopedia-history äº‘å‡½æ•°å¼€å‘
- [ ] æ”¶è—åˆ—è¡¨é¡µé¢
- [ ] æµè§ˆå†å²é¡µé¢
- [ ] æœ¬åœ°ç¼“å­˜æœºåˆ¶

#### é˜¶æ®µå››ï¼šç®¡ç†åå°ï¼ˆ1å‘¨ï¼‰
- [ ] Webåå°è¯æ¡ç®¡ç†é¡µé¢
- [ ] è¯æ¡å®¡æ ¸åŠŸèƒ½
- [ ] ç¼“å­˜ç®¡ç†åŠŸèƒ½
- [ ] ç»Ÿè®¡åˆ†æé¡µé¢

#### é˜¶æ®µäº”ï¼šä¼˜åŒ–ä¸æµ‹è¯•ï¼ˆ1å‘¨ï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] UI/UXä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•

### 5.2 æ—¶é—´ä¼°ç®—
- **æ€»å¼€å‘æ—¶é—´**ï¼š6å‘¨ï¼ˆçº¦42å¤©ï¼‰
- **å¼€å‘å·¥ä½œé‡**ï¼š120-150å°æ—¶

### 5.3 äººåŠ›å®‰æ’
- **å‰ç«¯å¼€å‘**ï¼š40-50å°æ—¶
- **åç«¯å¼€å‘**ï¼š40-50å°æ—¶
- **æµ‹è¯•ä¸ä¼˜åŒ–**ï¼š30-40å°æ—¶
- **æ–‡æ¡£ç¼–å†™**ï¼š10å°æ—¶

---

## 6. æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### 6.1 ç½‘é¡µæŠ“å–ä¸è§£æ

#### 6.1.1 éš¾ç‚¹
- ä¸åŒç™¾ç§‘ç½‘ç«™çš„HTMLç»“æ„å·®å¼‚å¤§
- éœ€è¦å¤„ç†å„ç§ç‰¹æ®Šæ ¼å¼ï¼ˆè¡¨æ ¼ã€åˆ—è¡¨ã€å›¾ç‰‡ç­‰ï¼‰
- åŠ¨æ€åŠ è½½çš„å†…å®¹éš¾ä»¥è·å–
- åçˆ¬è™«æœºåˆ¶

#### 6.1.2 è§£å†³æ–¹æ¡ˆ
1. **é’ˆå¯¹æ€§è§£æå™¨**ï¼šä¸ºæ¯ä¸ªç™¾ç§‘ç½‘ç«™ç¼–å†™ä¸“é—¨çš„è§£æå™¨
2. **é€šç”¨è§£æå™¨å…œåº•**ï¼šä½¿ç”¨åŸºäºè¯­ä¹‰çš„é€šç”¨è§£æè§„åˆ™
3. **å®šæœŸæ›´æ–°è§£æè§„åˆ™**ï¼šç›‘æ§è§£æå¤±è´¥ç‡ï¼ŒåŠæ—¶æ›´æ–°è§„åˆ™
4. **User-Agent è½®æ¢**ï¼šé¿å…è¢«è¯†åˆ«ä¸ºçˆ¬è™«

### 6.2 å†…å®¹å®¡æ ¸

#### 6.2.1 éš¾ç‚¹
- éœ€è¦è¿‡æ»¤æ•æ„Ÿå†…å®¹
- é¿å…è¿è§„ä¿¡æ¯
- å¹³è¡¡å®¡æ ¸ä¸¥æ ¼åº¦å’Œç”¨æˆ·ä½“éªŒ

#### 6.2.2 è§£å†³æ–¹æ¡ˆ
1. **æ¥å…¥å¾®ä¿¡å†…å®¹å®‰å…¨API**ï¼šè‡ªåŠ¨å®¡æ ¸æ–‡æœ¬å’Œå›¾ç‰‡
2. **å…³é”®è¯è¿‡æ»¤**ï¼šå»ºç«‹æ•æ„Ÿè¯åº“
3. **äººå·¥å¤å®¡æœºåˆ¶**ï¼šå¯¹æ ‡è®°å†…å®¹è¿›è¡Œäººå·¥å®¡æ ¸
4. **ç”¨æˆ·ä¸¾æŠ¥**ï¼šå…è®¸ç”¨æˆ·ä¸¾æŠ¥ä¸å½“å†…å®¹

### 6.3 æ€§èƒ½ä¼˜åŒ–

#### 6.3.1 éš¾ç‚¹
- ç½‘é¡µæŠ“å–è€—æ—¶é•¿ï¼ˆ3-5ç§’ï¼‰
- é¢‘ç¹è¯·æ±‚å½±å“æœåŠ¡å™¨æ€§èƒ½
- å›¾ç‰‡åŠ è½½å½±å“å±•ç¤ºé€Ÿåº¦

#### 6.3.2 è§£å†³æ–¹æ¡ˆ
1. **å¤šçº§ç¼“å­˜**ï¼šäº‘ç«¯ç¼“å­˜ + æœ¬åœ°ç¼“å­˜
2. **å¼‚æ­¥åŠ è½½**ï¼šå…ˆå±•ç¤ºæ–‡æœ¬ï¼Œå›¾ç‰‡æ‡’åŠ è½½
3. **CDNåŠ é€Ÿ**ï¼šå›¾ç‰‡ä½¿ç”¨CDN
4. **é™æµæœºåˆ¶**ï¼šé˜²æ­¢æ¶æ„é¢‘ç¹è¯·æ±‚

---

## 7. é£é™©è¯„ä¼°ä¸åº”å¯¹

### 7.1 æŠ€æœ¯é£é™©

#### é£é™©1ï¼šç½‘é¡µç»“æ„å˜åŒ–å¯¼è‡´è§£æå¤±è´¥
**å½±å“ç¨‹åº¦**ï¼šé«˜  
**åº”å¯¹æªæ–½**ï¼š
- å»ºç«‹è§£æå¤±è´¥ç›‘æ§
- å¿«é€Ÿæ›´æ–°è§£æè§„åˆ™
- æä¾›æ‰‹åŠ¨æ›´æ–°æŒ‰é’®

#### é£é™©2ï¼šè¢«ç›®æ ‡ç½‘ç«™å°ç¦IP
**å½±å“ç¨‹åº¦**ï¼šä¸­  
**åº”å¯¹æªæ–½**ï¼š
- ä½¿ç”¨ä»£ç†æ± è½®æ¢IP
- å¢åŠ è¯·æ±‚é—´éš”
- é™ä½è¯·æ±‚é¢‘ç‡

#### é£é™©3ï¼šå†…å®¹å®¡æ ¸ä¸é€šè¿‡
**å½±å“ç¨‹åº¦**ï¼šä¸­  
**åº”å¯¹æªæ–½**ï¼š
- ä¸¥æ ¼çš„è‡ªåŠ¨å®¡æ ¸
- äººå·¥é¢„å®¡æ ¸æœºåˆ¶
- æä¾›ç”³è¯‰æ¸ é“

### 7.2 æ³•å¾‹é£é™©

#### é£é™©1ï¼šç‰ˆæƒé—®é¢˜
**å½±å“ç¨‹åº¦**ï¼šé«˜  
**åº”å¯¹æªæ–½**ï¼š
- æ˜ç¡®æ ‡æ³¨å†…å®¹æ¥æº
- æä¾›åŸç½‘é¡µé“¾æ¥
- ä»…åšå±•ç¤ºï¼Œä¸åšå•†ä¸šç”¨é€”
- æ”¶åˆ°æŠ•è¯‰åŠæ—¶ä¸‹æ¶

#### é£é™©2ï¼šçˆ¬è™«åˆæ³•æ€§
**å½±å“ç¨‹åº¦**ï¼šä¸­  
**åº”å¯¹æªæ–½**ï¼š
- éµå®ˆrobots.txtåè®®
- æ§åˆ¶çˆ¬å–é¢‘ç‡
- ä¸çˆ¬å–æ•æ„Ÿä¿¡æ¯
- å–å¾—ç½‘ç«™æˆæƒï¼ˆå¦‚å¯èƒ½ï¼‰

### 7.3 ç”¨æˆ·ä½“éªŒé£é™©

#### é£é™©1ï¼šè§£ææ—¶é—´è¿‡é•¿
**å½±å“ç¨‹åº¦**ï¼šä¸­  
**åº”å¯¹æªæ–½**ï¼š
- æ˜¾ç¤ºè¯¦ç»†çš„åŠ è½½è¿›åº¦
- æä¾›é¢„ä¼°æ—¶é—´
- ä¼˜åŒ–è§£æç®—æ³•

#### é£é™©2ï¼šè§£æå‡†ç¡®ç‡ä½
**å½±å“ç¨‹åº¦**ï¼šé«˜  
**åº”å¯¹æªæ–½**ï¼š
- æŒç»­ä¼˜åŒ–è§£æè§„åˆ™
- æä¾›ç”¨æˆ·åé¦ˆæ¸ é“
- äººå·¥ä¿®æ­£é”™è¯¯å†…å®¹

---

## 8. æµ‹è¯•è®¡åˆ’

### 8.1 åŠŸèƒ½æµ‹è¯•

#### 8.1.1 URLè§£ææµ‹è¯•
- [ ] æµ‹è¯•ä¸åŒç™¾ç§‘ç½‘ç«™çš„URL
- [ ] æµ‹è¯•å„ç§æ ¼å¼çš„è¯æ¡é¡µé¢
- [ ] æµ‹è¯•å¼‚å¸¸URLçš„å¤„ç†
- [ ] æµ‹è¯•ç½‘ç»œå¼‚å¸¸æƒ…å†µ

#### 8.1.2 æœç´¢åŠŸèƒ½æµ‹è¯•
- [ ] æµ‹è¯•å…³é”®è¯æœç´¢å‡†ç¡®æ€§
- [ ] æµ‹è¯•åˆ†ç±»ç­›é€‰åŠŸèƒ½
- [ ] æµ‹è¯•æœç´¢ç»“æœæ’åº
- [ ] æµ‹è¯•æœç´¢å†å²è®°å½•

#### 8.1.3 æ”¶è—ä¸å†å²æµ‹è¯•
- [ ] æµ‹è¯•æ”¶è—åŠŸèƒ½
- [ ] æµ‹è¯•å–æ¶ˆæ”¶è—
- [ ] æµ‹è¯•æµè§ˆå†å²è®°å½•
- [ ] æµ‹è¯•æ•°æ®åŒæ­¥

### 8.2 æ€§èƒ½æµ‹è¯•

#### 8.2.1 å“åº”æ—¶é—´æµ‹è¯•
- URLè§£æå“åº”æ—¶é—´ < 5ç§’
- æœç´¢å“åº”æ—¶é—´ < 1ç§’
- é¡µé¢åŠ è½½æ—¶é—´ < 2ç§’

#### 8.2.2 å¹¶å‘æµ‹è¯•
- æ”¯æŒ100å¹¶å‘ç”¨æˆ·
- äº‘å‡½æ•°è°ƒç”¨æˆåŠŸç‡ > 99%

### 8.3 å…¼å®¹æ€§æµ‹è¯•

#### 8.3.1 è®¾å¤‡å…¼å®¹æ€§
- iOSç³»ç»Ÿæµ‹è¯•
- Androidç³»ç»Ÿæµ‹è¯•
- ä¸åŒå±å¹•å°ºå¯¸é€‚é…

#### 8.3.2 å¾®ä¿¡ç‰ˆæœ¬å…¼å®¹æ€§
- æµ‹è¯•æœ€æ–°ç‰ˆå¾®ä¿¡
- æµ‹è¯•æ—§ç‰ˆå¾®ä¿¡å…¼å®¹æ€§

---

## 9. è¿è¥ç­–ç•¥

### 9.1 æ¨å¹¿è®¡åˆ’

#### 9.1.1 åˆæœŸæ¨å¹¿
- åœ¨ç©å®¶ç¤¾ç¾¤å®£ä¼ æ–°åŠŸèƒ½
- åˆ¶ä½œä½¿ç”¨æ•™ç¨‹è§†é¢‘
- é‚€è¯·ç”¨æˆ·è¯•ç”¨å¹¶æ”¶é›†åé¦ˆ

#### 9.1.2 æŒç»­è¿è¥
- å®šæœŸæ›´æ–°çƒ­é—¨è¯æ¡
- æ¨èä¼˜è´¨ç™¾ç§‘å†…å®¹
- ä¸¾åŠç™¾ç§‘çŸ¥è¯†ç«èµ›æ´»åŠ¨

### 9.2 ç”¨æˆ·æ¿€åŠ±

#### 9.2.1 ç»éªŒå€¼å¥–åŠ±
- æŸ¥çœ‹ç™¾ç§‘è¯æ¡ï¼š+2ç»éªŒ
- æ”¶è—è¯æ¡ï¼š+3ç»éªŒ
- åˆ†äº«è¯æ¡ï¼š+5ç»éªŒ

#### 9.2.2 æˆå°±ç³»ç»Ÿ
- ç™¾ç§‘è¾¾äººï¼šæŸ¥çœ‹100ä¸ªè¯æ¡
- çŸ¥è¯†æ¸Šåšï¼šæ”¶è—50ä¸ªè¯æ¡
- èµ„æ–™ä¸“å®¶ï¼šè¿ç»­7å¤©æŸ¥é˜…ç™¾ç§‘

---

## 10. åç»­ä¼˜åŒ–æ–¹å‘

### 10.1 åŠŸèƒ½æ‰©å±•
- [ ] æ”¯æŒæ›´å¤šç™¾ç§‘ç½‘ç«™
- [ ] ç™¾ç§‘è¯æ¡è¯„è®ºåŠŸèƒ½
- [ ] è¯æ¡å¯¹æ¯”åŠŸèƒ½
- [ ] ç”Ÿæˆå­¦ä¹ ç¬”è®°
- [ ] å¯¼å‡ºPDFåŠŸèƒ½

### 10.2 æŠ€æœ¯ä¼˜åŒ–
- [ ] å¼•å…¥AIä¼˜åŒ–å†…å®¹è§£æ
- [ ] ä½¿ç”¨OCRè¯†åˆ«å›¾ç‰‡å†…å®¹
- [ ] æ™ºèƒ½æ¨èç›¸å…³è¯æ¡
- [ ] å¤šè¯­è¨€æ”¯æŒ

### 10.3 è¿è¥ä¼˜åŒ–
- [ ] å»ºç«‹è¯æ¡è´¡çŒ®è€…ä½“ç³»
- [ ] ç”¨æˆ·ç¼–è¾‘è¯æ¡åŠŸèƒ½
- [ ] è¯æ¡è´¨é‡è¯„åˆ†ç³»ç»Ÿ
- [ ] ä¸“å®¶è®¤è¯æœºåˆ¶

---

## 11. é™„å½•

### 11.1 å‚è€ƒèµ„æ–™
- [è¡€æŸ“é’Ÿæ¥¼ä¸­æ–‡Wiki](https://botc.wiki/)
- [Blood on the Clocktower å®˜æ–¹Wiki](https://bloodontheclocktower.com/)
- [å¾®ä¿¡å°ç¨‹åºå¼€å‘æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [uniCloud äº‘å¼€å‘æ–‡æ¡£](https://uniapp.dcloud.net.cn/uniCloud/)

### 11.2 ç›¸å…³æ–‡æ¡£
- `speckit.specify` - é¡¹ç›®è¯¦ç»†è¯´æ˜
- `speckit.plan` - é¡¹ç›®å¼€å‘è®¡åˆ’
- `speckit.constitution` - é¡¹ç›®å¼€å‘è§„èŒƒ

### 11.3 æŠ€æœ¯ä¾èµ–
```json
{
  "dependencies": {
    "cheerio": "^1.0.0-rc.12",
    "axios": "^1.6.0"
  }
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**åˆ›å»ºæ—¶é—´**: 2025å¹´10æœˆ17æ—¥  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ17æ—¥  
**ç»´æŠ¤äººå‘˜**: å¼€å‘å›¢é˜Ÿ

