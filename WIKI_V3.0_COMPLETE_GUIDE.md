# Wiki v3.0 完整系统 - 部署指南

## 📋 版本信息
- **版本**: v3.0
- **更新日期**: 2025-10-18  
- **新增功能**: 角色互动 + 榜单系统

---

## 🎯 新增功能总览

### 1. 角色互动
- ✅ 点赞角色
- ✅ 发表评论
- ✅ 查看评论列表
- ✅ 统计展示（浏览/点赞/评论/收藏）

### 2. 榜单系统
- ✅ 说书人榜单（粉丝榜/热度榜）
- ✅ 角色榜单（最新榜/人气榜/点赞榜/热度榜）

---

## 📦 完整文件清单

### 数据库Schema（3个新增）
```
botc-miniprogram/uniCloud-aliyun/database/
├── wiki_entries.schema.json        # 扩展
├── wiki_role_likes.schema.json     # 新增
└── wiki_role_comments.schema.json  # 新增
```

### 云函数（3个新增）
```
botc-miniprogram/uniCloud-aliyun/cloudfunctions/
├── wiki-role-toggle-like/
├── wiki-role-comment-add/
└── wiki-role-comment-list/
```

### 前端页面（2个）
```
botc-miniprogram/pages/
├── tools/wiki/detail.vue           # 扩展（互动区域）
├── ranking/index.vue               # 新增（榜单页面）
└── tools/index/index.vue           # 扩展（添加榜单入口）
```

---

## 🚀 部署步骤

### 步骤1: 上传数据库Schema（2分钟）
```bash
右键 wiki_entries.schema.json → 上传Schema
右键 wiki_role_likes.schema.json → 上传Schema
右键 wiki_role_comments.schema.json → 上传Schema
```

### 步骤2: 上传云函数（3分钟）
```bash
右键 wiki-role-toggle-like → 上传部署
右键 wiki-role-comment-add → 上传部署
右键 wiki-role-comment-list → 上传部署
右键 wiki-ranking-storytellers → 上传部署
```

### 步骤3: 运行小程序（1分钟）
```bash
运行 → 运行到小程序模拟器
```

---

## ✅ 功能测试

### 测试1: 角色点赞
1. 打开血染百科 → 点击任意角色
2. 点击"🤍 点赞"按钮
3. 应该变为"❤️ 已点赞"

### 测试2: 角色评论
1. 在评论输入框输入内容
2. 点击"发送"
3. 评论立即显示在列表中

### 测试3: 角色榜单
1. 工具 → 榜单
2. 切换到"角色榜"
3. 查看不同榜单（最新/人气/点赞/热度）

### 测试4: 说书人榜单
1. 榜单页面
2. 切换到"说书人榜"
3. 查看粉丝榜和热度榜

---

## 📐 完整界面

### 工具首页（新增榜单入口）
```
┌─────────────────────────────────┐
│ 工具箱                           │
├─────────────────────────────────┤
│ [🚗] 拼车组局                    │
│ [📄] 剧本上传                    │
│ [📚] 血染百科                    │
│ [🏆] 榜单          ← 新增        │
│ [🎭] 说书人                      │
│ [🏪] 血染店铺                    │
└─────────────────────────────────┘
```

### 榜单页面
```
┌─────────────────────────────────┐
│ [🎭 说书人榜] [👤 角色榜]        │
├─────────────────────────────────┤
│ [最新] [人气] [点赞] [热度]      │
├─────────────────────────────────┤
│ 1️⃣ [图标] 图书管理员             │
│    👁️ 678  ❤️ 123  💬 45        │
│    浏览 678                      │
├─────────────────────────────────┤
│ 2️⃣ [图标] 哲学家                │
│    👁️ 456  ❤️ 98  💬 32         │
│    浏览 456                      │
└─────────────────────────────────┘
```

### 角色详情（新增互动区）
```
┌─────────────────────────────────┐
│ ... 角色详细信息 ...            │
├─────────────────────────────────┤
│ 👁️ 123  ❤️ 45  💬  12  ⭐ 8     │
├─────────────────────────────────┤
│ [❤️ 已点赞]                      │
├─────────────────────────────────┤
│ 💬 评论 (12)                     │
│ [👤] 张三：这个角色很强           │
│ [👤] 李四：配合哲学家效果好       │
│ [说说你的看法...]  [发送]        │
├─────────────────────────────────┤
│ [🌐 跳转百科地址]                │
└─────────────────────────────────┘
```

---

## 🎨 设计亮点

### 1. 榜单页面
- **双主Tab**: 说书人榜 vs 角色榜
- **多子Tab**: 每个榜单4种排序方式
- **排名徽章**: 前3名特殊颜色（金/银/铜）
- **数据展示**: 头像/名称/统计数据/分数

### 2. 互动功能
- **点赞按钮**: 黄色→红色渐变切换
- **评论列表**: 头像+昵称+时间+内容
- **智能时间**: 刚刚/N分钟前/N小时前/N天前

### 3. 统计栏
- **4个指标**: 浏览/点赞/评论/收藏
- **图标+数字**: 简洁直观

---

## 📊 数据来源

### 角色榜单
- **最新榜**: 按 `created_at` 排序
- **人气榜**: 按 `stats.favorite_count` 排序
- **点赞榜**: 按 `stats.like_count` 排序
- **热度榜**: 按 `stats.view_count` 排序

### 说书人榜单
- **粉丝榜**: 按 `storyteller_stats.fans_count` 排序
- **热度榜**: 按 `storyteller_stats.heat_score` 排序

---

## 🔐 权限说明

### wiki_role_likes
- `read`: 只能查看自己的点赞记录
- `create`: 登录用户可点赞
- `delete`: 只能删除自己的点赞

### wiki_role_comments
- `read`: 所有人可查看（包括未登录用户）
- `create`: 登录用户可评论
- `update/delete`: 只能操作自己的评论

---

## 💡 使用流程

### 查看榜单
```
工具 → 榜单 → 选择榜单类型 → 查看排名
```

### 点赞角色（需登录）
```
血染百科 → 角色详情 → 点击"点赞"
```

### 评论角色（需登录）
```
血染百科 → 角色详情 → 输入评论 → 发送
```

---

## 🎊 v3.0 完成！

所有功能已开发完成：
- ✅ 3个数据库Schema
- ✅ 3个云函数
- ✅ 2个页面（榜单+详情扩展）
- ✅ 完整的交互逻辑

**预计部署时间**: 6分钟  
**开发完成时间**: 3小时  

准备部署测试！🚀

