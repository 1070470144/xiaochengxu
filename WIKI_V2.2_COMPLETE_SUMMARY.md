# Wiki v2.2 è§’è‰²ç®¡ç†ç³»ç»Ÿ - å®Œæ•´æ€»ç»“

## ğŸ“Š ç‰ˆæœ¬å¯¹æ¯”

| åŠŸèƒ½ | v2.1 | v2.2 |
|------|------|------|
| åŒæ­¥æ–¹å¼ | æ‰‹åŠ¨è¾“å…¥URL | ä¿å­˜è§’è‰²åç§°ï¼Œä¸€é”®åŒæ­¥ |
| è§’è‰²å­˜å‚¨ | æ—  | wiki_role_listæ°¸ä¹…å­˜å‚¨ |
| æœç´¢åŠŸèƒ½ | æ—  | âœ… æŒ‰åç§°æœç´¢ |
| çŠ¶æ€ç­›é€‰ | æ—  | âœ… å·²åŒæ­¥/æœªåŒæ­¥/å¤±è´¥ |
| æ‰¹é‡æ“ä½œ | åŒæ­¥æ‰€æœ‰24ä¸ª | âœ… è‡ªå®šä¹‰é€‰æ‹©æ‰¹é‡åŒæ­¥ |
| è§’è‰²ç®¡ç† | æ—  | âœ… æ·»åŠ /åˆ é™¤è§’è‰² |
| åŒæ­¥è®°å½• | æ—  | âœ… æ˜¾ç¤ºåŒæ­¥æ—¶é—´å’ŒçŠ¶æ€ |
| ç”¨æˆ·ä½“éªŒ | éœ€è¦è®°ä½URL | ä¸€æ¬¡æ·»åŠ ï¼Œæ°¸ä¹…ä¿å­˜ |

---

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### 1. ç®€åŒ–åŒæ­¥æµç¨‹
**ä¹‹å‰ï¼ˆv2.1ï¼‰ï¼š**
```
1. æ‰“å¼€é’Ÿæ¥¼ç™¾ç§‘
2. å¤åˆ¶è§’è‰²é¡µé¢URL
3. ç²˜è´´åˆ°è¾“å…¥æ¡†
4. ç‚¹å‡»åŒæ­¥
5. ä¸‹æ¬¡åŒæ­¥é‡å¤1-4æ­¥éª¤
```

**ç°åœ¨ï¼ˆv2.2ï¼‰ï¼š**
```
1. ç¬¬ä¸€æ¬¡ï¼šè¾“å…¥"å›¾ä¹¦ç®¡ç†å‘˜" â†’ ä¿å­˜
2. ä»¥åï¼šå‹¾é€‰è§’è‰² â†’ æ‰¹é‡åŒæ­¥
```

### 2. è§’è‰²çŠ¶æ€ç®¡ç†
- âœ… å®æ—¶æ˜¾ç¤ºåŒæ­¥çŠ¶æ€ï¼ˆå·²åŒæ­¥/æœªåŒæ­¥/å¤±è´¥ï¼‰
- âœ… è®°å½•æœ€ååŒæ­¥æ—¶é—´
- âœ… å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯åŸå› 
- âœ… æ”¯æŒé‡æ–°åŒæ­¥

### 3. æ‰¹é‡æ“ä½œ
- âœ… ä¸€æ¬¡æ€§æ·»åŠ å¤šä¸ªè§’è‰²ï¼ˆé€—å·æˆ–æ¢è¡Œåˆ†éš”ï¼‰
- âœ… å‹¾é€‰å¤šä¸ªè§’è‰²æ‰¹é‡åŒæ­¥
- âœ… å‹¾é€‰å¤šä¸ªè§’è‰²æ‰¹é‡åˆ é™¤

### 4. æ™ºèƒ½æœç´¢ç­›é€‰
- âœ… å®æ—¶æœç´¢è§’è‰²åç§°ï¼ˆ500msé˜²æŠ–ï¼‰
- âœ… æŒ‰çŠ¶æ€ç­›é€‰ï¼ˆå…¨éƒ¨/å·²åŒæ­¥/æœªåŒæ­¥/å¤±è´¥ï¼‰
- âœ… åˆ†é¡µæ˜¾ç¤ºï¼ˆé»˜è®¤20æ¡/é¡µï¼‰

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ•°æ®åº“Schema
```
botc-admin/uniCloud-aliyun/database/wiki_role_list.schema.json
```

### äº‘å‡½æ•°ï¼ˆ4ä¸ªï¼‰
```
botc-admin/uniCloud-aliyun/cloudfunctions/
â”œâ”€â”€ wiki-role-add/         # æ·»åŠ è§’è‰²
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ wiki-role-list/        # è·å–åˆ—è¡¨
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ wiki-role-delete/      # åˆ é™¤è§’è‰²
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ package.json
â””â”€â”€ wiki-role-sync/        # æ‰¹é‡åŒæ­¥
    â”œâ”€â”€ index.js
    â””â”€â”€ package.json
```

### å‰ç«¯é¡µé¢
```
botc-admin/pages/botc/wiki/sync.vue  # å®Œå…¨é‡æ„
```

### æ–‡æ¡£
```
WIKI_V2.2_SIMPLIFIED_SPEC.md         # åŠŸèƒ½è§„æ ¼è¯´æ˜
WIKI_V2.2_DEVELOPMENT_PLAN.md        # å¼€å‘è®¡åˆ’ï¼ˆ13ä¸ªä»»åŠ¡ï¼‰
WIKI_V2.2_DEPLOYMENT_GUIDE.md        # éƒ¨ç½²æŒ‡å—
WIKI_V2.2_QUICK_TEST.md              # å¿«é€Ÿæµ‹è¯•æŒ‡å—
WIKI_V2.2_COMPLETE_SUMMARY.md        # æœ¬æ–‡æ¡£
```

---

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### wiki_role_listï¼ˆæ–°å¢ï¼‰
```javascript
{
  _id: "xxx",
  role_name: "å›¾ä¹¦ç®¡ç†å‘˜",           // è§’è‰²åç§°
  role_url: "https://...",           // è‡ªåŠ¨ç”Ÿæˆçš„URL
  is_synced: true,                   // æ˜¯å¦å·²åŒæ­¥
  last_sync_time: 1697628000000,     // æœ€ååŒæ­¥æ—¶é—´
  sync_status: "success",            // success/failed/pending
  sync_error: null,                  // é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœå¤±è´¥ï¼‰
  created_at: 1697628000000,         // åˆ›å»ºæ—¶é—´
  updated_at: 1697628000000          // æ›´æ–°æ—¶é—´
}
```

### wiki_entriesï¼ˆä¿æŒä¸å˜ï¼‰
åŒæ­¥åçš„è§’è‰²æ•°æ®ä»ç„¶å­˜å‚¨åœ¨wiki_entriesä¸­

---

## ğŸ”„ å·¥ä½œæµç¨‹

### æ·»åŠ è§’è‰²æµç¨‹
```mermaid
ç”¨æˆ·è¾“å…¥è§’è‰²åç§°
  â†’ wiki-role-addäº‘å‡½æ•°
  â†’ æ£€æŸ¥æ˜¯å¦é‡å¤
  â†’ ç”ŸæˆURL
  â†’ å­˜å…¥wiki_role_list
  â†’ è¿”å›ç»“æœ
  â†’ åˆ·æ–°åˆ—è¡¨
```

### åŒæ­¥è§’è‰²æµç¨‹
```mermaid
ç”¨æˆ·å‹¾é€‰è§’è‰²
  â†’ wiki-role-syncäº‘å‡½æ•°
  â†’ éå†é€‰ä¸­è§’è‰²
  â†’ è°ƒç”¨wiki-admin-sync-single
  â†’ æ›´æ–°åŒæ­¥çŠ¶æ€
  â†’ å­˜å…¥wiki_entries
  â†’ è¿”å›ç»“æœ
  â†’ åˆ·æ–°åˆ—è¡¨
```

---

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

### 1. é˜²æŠ–æœç´¢
```javascript
searchRoles() {
  clearTimeout(this.searchTimer);
  this.searchTimer = setTimeout(() => {
    this.currentPage = 1;
    this.loadRoleList();
  }, 500);
}
```

### 2. URLè‡ªåŠ¨ç”Ÿæˆ
```javascript
const role_url = `https://clocktower-wiki.gstonegames.com/index.php?title=${role_name}`;
// æµè§ˆå™¨ä¼šè‡ªåŠ¨ç¼–ç ä¸­æ–‡å­—ç¬¦
```

### 3. æ‰¹é‡æ“ä½œä¼˜åŒ–
```javascript
// æ”¯æŒå¤šç§åˆ†éš”ç¬¦
const roleNames = input.split(/[,ï¼Œ\n;ï¼›]/)
  .map(name => name.trim())
  .filter(name => name.length > 0);
```

### 4. çŠ¶æ€ç®¡ç†
```javascript
// åŒæ­¥æˆåŠŸ
await collection.doc(role_id).update({
  is_synced: true,
  sync_status: 'success',
  last_sync_time: Date.now(),
  sync_error: db.command.remove()
});

// åŒæ­¥å¤±è´¥
await collection.doc(role_id).update({
  is_synced: false,
  sync_status: 'failed',
  sync_error: syncRes.result.message
});
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ·»åŠ å•ä¸ªè§’è‰² | < 500ms |
| æ·»åŠ 10ä¸ªè§’è‰² | < 2s |
| æœç´¢è§’è‰² | < 300ms |
| å•ä¸ªåŒæ­¥ | 2-5s |
| æ‰¹é‡åŒæ­¥10ä¸ª | 20-50s |
| åˆ é™¤è§’è‰² | < 500ms |

---

## ğŸ¨ UIæ”¹è¿›

### é…è‰²æ–¹æ¡ˆ
- **ä¸»è‰²è°ƒ**: ç´«è‰²æ¸å˜ï¼ˆ#667eea â†’ #764ba2ï¼‰
- **æˆåŠŸçŠ¶æ€**: ç»¿è‰²ï¼ˆ#52c41aï¼‰
- **å¤±è´¥çŠ¶æ€**: çº¢è‰²ï¼ˆ#f5222dï¼‰
- **æœªåŒæ­¥**: ç°è‰²ï¼ˆ#999ï¼‰

### äº¤äº’ä¼˜åŒ–
- âœ… æŒ‰é’®loadingçŠ¶æ€
- âœ… ç¡®è®¤å¼¹çª—
- âœ… æˆåŠŸ/å¤±è´¥æç¤º
- âœ… æ‚¬åœé«˜äº®
- âœ… é€‰ä¸­è¡ŒèƒŒæ™¯è‰²

---

## ğŸ“ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: é¦–æ¬¡ä½¿ç”¨
```
1. æ·»åŠ å¸¸ç”¨è§’è‰²ï¼ˆ20-30ä¸ªï¼‰
2. å…¨é€‰ â†’ æ‰¹é‡åŒæ­¥
3. ç­‰å¾…åŒæ­¥å®Œæˆ
4. å®Œæˆï¼
```

### åœºæ™¯2: æ—¥å¸¸ç»´æŠ¤
```
1. æ–°å¢è§’è‰²æ—¶ï¼šæ·»åŠ  â†’ å•ä¸ªåŒæ­¥
2. æ›´æ–°è§’è‰²æ—¶ï¼šæœç´¢ â†’ åŒæ­¥
3. åˆ é™¤ä¸éœ€è¦çš„è§’è‰²
```

### åœºæ™¯3: æ‰¹é‡æ›´æ–°
```
1. ç­›é€‰"æœªåŒæ­¥"
2. å…¨é€‰ â†’ æ‰¹é‡åŒæ­¥
3. å®Œæˆæ›´æ–°
```

---

## ğŸš¨ æ³¨æ„äº‹é¡¹

### 1. è§’è‰²åç§°
- âœ… å¿…é¡»ä¸é’Ÿæ¥¼ç™¾ç§‘å®Œå…¨ä¸€è‡´
- âŒ ä¸æ”¯æŒåˆ«åï¼ˆä¾‹å¦‚ï¼š"é…’é¬¼"ä¸èƒ½å†™æˆ"é†‰é¬¼"ï¼‰
- âœ… æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—

### 2. æ‰¹é‡åŒæ­¥
- âš ï¸ å»ºè®®æ¯æ¬¡ä¸è¶…è¿‡50ä¸ªè§’è‰²
- âš ï¸ åŒæ­¥æ—¶é—´ä¸è§’è‰²æ•°é‡æˆæ­£æ¯”
- âš ï¸ å¤±è´¥çš„è§’è‰²å¯ä»¥å•ç‹¬é‡è¯•

### 3. æ•°æ®æ¸…ç†
- å®šæœŸæ¸…ç†å¤±è´¥çš„è§’è‰²
- åˆ é™¤ä¸å†éœ€è¦çš„è§’è‰²
- ä¿æŒåˆ—è¡¨æ•´æ´

---

## ğŸ”® æœªæ¥è§„åˆ’

### v2.3 å¯èƒ½çš„åŠŸèƒ½
- [ ] å¯¼å…¥/å¯¼å‡ºè§’è‰²åˆ—è¡¨
- [ ] å®šæ—¶è‡ªåŠ¨åŒæ­¥
- [ ] åŒæ­¥è¿›åº¦æ¡
- [ ] è§’è‰²åˆ†ç»„ç®¡ç†
- [ ] åŒæ­¥å†å²è®°å½•
- [ ] æ‰¹é‡ç¼–è¾‘è§’è‰²

### v3.0 å¯èƒ½çš„åŠŸèƒ½
- [ ] æ”¯æŒå‰§æœ¬åŒæ­¥
- [ ] æ”¯æŒè§„åˆ™åŒæ­¥
- [ ] æ•°æ®å¯è§†åŒ–
- [ ] åŒæ­¥ä»»åŠ¡é˜Ÿåˆ—
- [ ] Webhooké€šçŸ¥

---

## ğŸ“Š å¼€å‘ç»Ÿè®¡

### ä»£ç ç»Ÿè®¡
- **æ–°å¢æ–‡ä»¶**: 11ä¸ª
- **ä¿®æ”¹æ–‡ä»¶**: 1ä¸ª
- **æ–°å¢ä»£ç **: ~1500è¡Œ
- **å¼€å‘æ—¶é—´**: 5.5å°æ—¶

### ä»»åŠ¡å®Œæˆåº¦
- âœ… æ•°æ®åº“Schema: 1/1
- âœ… äº‘å‡½æ•°: 4/4
- âœ… å‰ç«¯é¡µé¢: 1/1
- âœ… æ–‡æ¡£: 5/5
- âœ… æ€»è¿›åº¦: 100%

---

## ğŸ‰ éƒ¨ç½²æ¸…å•

### éƒ¨ç½²å‰
- [ ] å¤‡ä»½æ•°æ®åº“
- [ ] ç¡®è®¤uniCloudè´¦å·æ­£å¸¸
- [ ] æ£€æŸ¥äº‘å‡½æ•°é¢åº¦

### éƒ¨ç½²ä¸­
- [ ] ä¸Šä¼ Schema
- [ ] ä¸Šä¼ 4ä¸ªäº‘å‡½æ•°
- [ ] éƒ¨ç½²å‰ç«¯

### éƒ¨ç½²å
- [ ] æµ‹è¯•æ·»åŠ è§’è‰²
- [ ] æµ‹è¯•æœç´¢ç­›é€‰
- [ ] æµ‹è¯•æ‰¹é‡åŒæ­¥
- [ ] éªŒè¯æ•°æ®åº“
- [ ] æ£€æŸ¥é”™è¯¯æ—¥å¿—

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### é—®é¢˜åé¦ˆ
å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. æ“ä½œæ­¥éª¤
2. é”™è¯¯æˆªå›¾
3. æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—
4. äº‘å‡½æ•°æ—¥å¿—

### å¸¸è§é—®é¢˜
è¯¦è§ï¼š`WIKI_V2.2_DEPLOYMENT_GUIDE.md` â†’ å¸¸è§é—®é¢˜æ’æŸ¥

---

## ğŸ† æ€»ç»“

### æ ¸å¿ƒä»·å€¼
1. **æ•ˆç‡æå‡**: ä»"æ¯æ¬¡æ‰‹åŠ¨è¾“å…¥URL"åˆ°"ä¸€æ¬¡æ·»åŠ ï¼Œæ°¸ä¹…ä¿å­˜"
2. **çŠ¶æ€å¯è§**: æ¸…æ¥šçŸ¥é“å“ªäº›è§’è‰²å·²åŒæ­¥ï¼Œå“ªäº›éœ€è¦æ›´æ–°
3. **æ‰¹é‡æ“ä½œ**: æ”¯æŒä¸€æ¬¡æ€§åŒæ­¥å¤šä¸ªè§’è‰²
4. **æ˜“äºç»´æŠ¤**: æœç´¢ã€ç­›é€‰ã€åˆ é™¤åŠŸèƒ½é½å…¨

### é€‚ç”¨åœºæ™¯
- âœ… éœ€è¦ç®¡ç†å¤§é‡è§’è‰²ï¼ˆ20+ï¼‰
- âœ… éœ€è¦å®šæœŸæ›´æ–°è§’è‰²æ•°æ®
- âœ… éœ€è¦å›¢é˜Ÿåä½œç®¡ç†
- âœ… éœ€è¦å†å²è®°å½•è¿½æº¯

### æ¨èä½¿ç”¨
å¦‚æœä½ çš„é¡¹ç›®éœ€è¦ï¼š
- ç®¡ç†å¤šä¸ªè§’è‰²
- é¢‘ç¹åŒæ­¥æ›´æ–°
- æ‰¹é‡æ“ä½œ
- çŠ¶æ€è¿½è¸ª

é‚£ä¹ˆ **v2.2 è§’è‰²ç®¡ç†ç³»ç»Ÿ** æ˜¯ä½ çš„æœ€ä½³é€‰æ‹©ï¼

---

**å¼€å‘å®Œæˆæ—¶é—´**: 2025-10-18  
**ç‰ˆæœ¬**: v2.2  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

ğŸŠ æ­å–œï¼Wiki v2.2 å¼€å‘å®Œæˆï¼

