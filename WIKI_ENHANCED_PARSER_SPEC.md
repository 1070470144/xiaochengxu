# 血染百科增强解析方案

## 🎯 解析目标

将钟楼百科的角色页面解析为结构化数据，提取以下字段：

### 基础信息
- ✅ 角色名称
- ✅ 角色Logo（图标）

### 详细内容（分段解析）
1. ✅ **背景故事** - 单段文本
2. ✅ **角色能力** - 单段文本  
3. ✅ **角色简介** - 多段文本
4. ✅ **范例** - 多条示例
5. ✅ **运作方式** - 多条步骤
6. ✅ **提示标记** - 每个标记包含：
   - 标记名称（如：镇民、错误）
   - 标记内容（多条说明）
7. ✅ **规则细节** - 多条规则
8. ✅ **提示与技巧** - 多条技巧
9. ✅ **伪装方法** - 多条建议
10. ✅ **角色信息** - 多条属性

---

## 💾 数据结构设计

### 优化后的 wiki_entries 结构

```javascript
{
  // 基础信息
  entry_type: "role",
  title: "洗衣妇",
  
  // 角色专属详细信息
  role_detail: {
    // 背景故事
    background_story: "晚礼服上的血渍？才不是呢...",
    
    // 角色能力
    ability: "在你的首个夜晚，你会得知两名玩家和一个镇民角色...",
    
    // 角色简介（多段）
    introduction: [
      "洗衣妇会得知一个特定的在场镇民角色...",
      "在第一个夜晚，洗衣妇会被唤醒...",
      "洗衣妇只会得知一次信息..."
    ],
    
    // 范例（多条）
    examples: [
      {
        scenario: "小文是厨师，小米是守鸦人",
        result: "洗衣妇得知要么小文是厨师，要么小米是厨师"
      },
      {
        scenario: "小佳是小恶魔，小艾是贞洁者",
        result: "洗衣妇得知要么小佳是贞洁者，要么小艾是贞洁者"
      }
    ],
    
    // 运作方式（多条步骤）
    mechanics: [
      "在为首个夜晚进行准备时，将洗衣妇的"镇民"提示标记放置...",
      "在首个夜晚里，唤醒洗衣妇，并指向标记...",
      "让洗衣妇重新入睡。在说书人方便的时候，移除..."
    ],
    
    // 提示标记（多个标记）
    reminder_tokens: [
      {
        name: "镇民",
        details: [
          "放置时机：在为首个夜晚做准备时放置",
          "放置条件：放置在一个镇民角色或能被当作镇民角色的角色标记旁边",
          "移除时机：在洗衣妇获取信息后，说书人可以任由自己方便来进行移除"
        ]
      },
      {
        name: "错误",
        details: [
          "放置时机：在为首个夜晚做准备时放置",
          "放置条件：放置在未放置"镇民"提示标记的其他任意一个角色标记旁边",
          "移除时机：在洗衣妇获取信息后，说书人可以任由自己方便来进行移除"
        ]
      }
    ],
    
    // 规则细节（多条）
    rule_details: [
      "不同于图书管理员和调查员，洗衣妇永远不可能得知没有镇民在场...",
      "如果在首夜就中毒或醉酒，洗衣妇可能会得知错误的玩家..."
    ],
    
    // 提示与技巧（多条）
    tips_and_tricks: [
      "洗衣妇这个角色看起来非常强大。虽然你无法从邪恶阵营的玩家身上获取信息...",
      "与其他角色相比，处于醉酒或中毒状态的洗衣妇还是比较容易发现自己获取了错误信息的...",
      "要去识别这两位玩家中哪一位是镇民的方法，不是在公聊时直接问他们..."
    ],
    
    // 伪装方法（多条）
    bluff_tips: [
      "声明自己是洗衣妇并指向至少一位邪恶阵营的玩家...",
      "如果一个善良阵营的玩家说自己是某个镇民角色...",
      "在大家刚醒来的时候，就立刻告诉大家在场有某个具体的角色..."
    ],
    
    // 角色信息（属性）
    role_attributes: {
      english_name: "Washerwoman",
      scripts: ["暗流涌动"],
      character_type: "镇民",
      ability_types: ["获取信息", "进场能力"]
    }
  },
  
  // 媒体资源
  media: {
    icon_url: "角色图标URL",
    images: []
  }
}
```

---

## 🔧 增强解析云函数

### 优化 wiki-admin-sync-all 和 wiki-admin-sync-single

需要添加智能解析逻辑，识别页面的各个章节。

---

## 📋 开发任务

### 任务1：优化HTML解析
- 识别章节标题（h2, h3）
- 提取每个章节的内容
- 结构化存储

### 任务2：特定字段提取
- 背景故事：在引号内的文本
- 角色能力：能力章节的内容
- 范例：识别示例场景
- 提示标记：识别每个标记的名称和详情

### 任务3：创建展示页面
- 在小程序端美化展示
- 分段显示内容
- 折叠/展开功能

---

## ⏰ 开发时间估算

- 解析逻辑优化：2-3天
- 数据库结构调整：0.5天
- 展示页面开发：1-2天
- 测试优化：1天

**总计**：5-7天

---

## 🎯 您是否需要我立即开始开发？

这是一个较大的优化，需要：
1. 重写解析逻辑
2. 优化数据结构
3. 改进展示页面

确认后我将开始实施！

---

**需求版本**: v2.1.0  
**创建时间**: 2025年10月17日

