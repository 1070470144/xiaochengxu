# 🔧 背景故事提取优化

## 🎯 目标

精确提取引号内的背景故事，不多不少。

### 示例（图书管理员）

**应该提取**：
```
"毫无疑问，这位女士，在通常情况下，你可以从图书馆的馆藏中借阅《凶恶药典》。

然而，你看起来不像是会员。"
```

**只要引号之间的内容！**

---

## ✅ 优化方案

### 改进点：

1. ✅ 保留换行符（br、p标签转为\n）
2. ✅ 精确匹配引号边界
3. ✅ 支持多行文本
4. ✅ 去除HTML残留

### 正则模式：

```javascript
/背景故事\s*[""]([^"""]+)[""]/
```

**匹配逻辑**：
- `背景故事` - 章节标题
- `\s*` - 可能的空格
- `[""]` - 中文左引号
- `([^"""]+)` - 提取引号内所有内容（不包含引号）
- `[""]` - 中文右引号

---

## 🚀 部署

### 上传优化后的云函数：

```bash
HBuilderX botc-admin：

右键 wiki-admin-sync-all → 上传部署
```

### 重新同步测试：

```bash
1. 删除"图书管理员"
2. 重新同步
3. 查看背景故事字段
4. 应该只有引号内的内容
```

---

## 📝 验证

同步后，在数据库查看：

```json
{
  "role_detail": {
    "background_story": "毫无疑问，这位女士，在通常情况下，你可以从图书馆的馆藏中借阅《凶恶药典》。\n\n然而，你看起来不像是会员。"
  }
}
```

**应该只有这些文字，无其他内容！** ✅

---

**优化时间**: 2025年10月17日

