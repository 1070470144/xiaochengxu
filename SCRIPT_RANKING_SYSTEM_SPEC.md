# 剧本榜单 & 角色榜单系统 - 需求规格说明

## 📋 版本信息
- **版本**: v3.0
- **日期**: 2025-10-18
- **类型**: 新功能 - 榜单系统

---

## 🎯 功能概述

### 1. 说书人榜单
- **粉丝数量榜单**：按照说书人粉丝数排序
- **热度榜单**：按照综合热度（上传剧本数、点赞数、评论数等）排序

### 2. 角色榜单
- **最新角色榜单**：按照同步时间排序
- **最受欢迎榜单**：按照收藏数排序
- **点赞榜**：按照点赞数排序
- **热度榜**：按照综合热度（浏览量、点赞、评论数等）排序

### 3. 角色互动
- **评论功能**：用户可以对角色发表评论
- **点赞功能**：用户可以点赞角色

---

## 📊 数据库设计

### wiki_entries（扩展）
```javascript
{
  _id: String,
  title: String,
  entry_type: String,
  
  // 🆕 扩展字段
  stats: {
    view_count: Number,      // 浏览量
    favorite_count: Number,  // 收藏数
    like_count: Number,      // 🆕 点赞数
    comment_count: Number    // 🆕 评论数
  },
  
  // 🆕 热度分数（自动计算）
  heat_score: Number
}
```

### wiki_role_likes（新增）
```javascript
{
  _id: String,
  user_id: String,         // 用户ID
  role_id: String,         // 角色ID（wiki_entries._id）
  created_at: Date         // 点赞时间
}
```

### wiki_role_comments（新增）
```javascript
{
  _id: String,
  user_id: String,         // 用户ID
  user_nickname: String,   // 用户昵称
  user_avatar: String,     // 用户头像
  role_id: String,         // 角色ID
  content: String,         // 评论内容
  like_count: Number,      // 评论点赞数
  created_at: Date,        // 评论时间
  status: Number           // 状态：1正常，0隐藏
}
```

### uni-id-users（扩展 - 说书人信息）
```javascript
{
  _id: String,
  nickname: String,
  avatar_file: Object,
  
  // 🆕 说书人统计
  storyteller_stats: {
    fans_count: Number,      // 粉丝数
    script_count: Number,    // 上传剧本数
    like_count: Number,      // 获赞数
    heat_score: Number       // 热度分数
  }
}
```

---

## 🎨 前端页面设计

### 1. 榜单页面（新增）
**路径**: `pages/ranking/index.vue`

```
┌─────────────────────────────────┐
│ 榜单                             │
├─────────────────────────────────┤
│ [说书人榜] [角色榜]              │
├─────────────────────────────────┤
│ [粉丝榜] [热度榜]                │  ← 说书人榜单的tab
├─────────────────────────────────┤
│ 1. [👤头像] 张三                 │
│    粉丝：1234 | 剧本：56         │
├─────────────────────────────────┤
│ 2. [👤头像] 李四                 │
│    粉丝：987 | 剧本：43          │
└─────────────────────────────────┘
```

或切换到角色榜：

```
┌─────────────────────────────────┐
│ 榜单                             │
├─────────────────────────────────┤
│ [说书人榜] [角色榜]              │
├─────────────────────────────────┤
│ [最新] [最受欢迎] [点赞] [热度] │  ← 角色榜单的tab
├─────────────────────────────────┤
│ 1. [🎭图标] 图书管理员           │
│    ❤️ 123 | 💬 45 | 👁️ 678      │
├─────────────────────────────────┤
│ 2. [🎭图标] 哲学家               │
│    ❤️ 98 | 💬 32 | 👁️ 456       │
└─────────────────────────────────┘
```

### 2. 角色详情页（扩展）
**路径**: `pages/tools/wiki/detail.vue`

```
┌─────────────────────────────────┐
│ [图标] 图书管理员  [镇民]       │
├─────────────────────────────────┤
│ ... 角色详细信息 ...            │
├─────────────────────────────────┤
│ 💬 评论 (45)        [❤️ 点赞 123]│  ← 新增互动区
├─────────────────────────────────┤
│ [👤] 张三：这个角色很强          │
│      2小时前  ❤️ 12              │
├─────────────────────────────────┤
│ [👤] 李四：适合新手              │
│      5小时前  ❤️ 8               │
├─────────────────────────────────┤
│ [📝 写评论]                      │
├─────────────────────────────────┤
│ [🌐 跳转百科地址]                │
└─────────────────────────────────┘
```

---

## 🔄 交互逻辑

### 点赞角色
```
1. 用户点击"❤️ 点赞"按钮
2. 检查是否已点赞
3. 如果未点赞：
   - 插入 wiki_role_likes 记录
   - wiki_entries.stats.like_count +1
   - 更新按钮状态为"已点赞"
4. 如果已点赞：
   - 删除 wiki_role_likes 记录
   - wiki_entries.stats.like_count -1
   - 更新按钮状态为"点赞"
```

### 发表评论
```
1. 用户点击"📝 写评论"
2. 弹出评论输入框
3. 输入评论内容（限制200字）
4. 提交评论：
   - 插入 wiki_role_comments
   - wiki_entries.stats.comment_count +1
   - 刷新评论列表
```

### 热度计算
```javascript
heat_score = 
  view_count * 1 +        // 浏览量权重1
  like_count * 5 +        // 点赞权重5
  favorite_count * 10 +   // 收藏权重10
  comment_count * 15      // 评论权重15
```

---

## 🛠️ 开发任务清单

### 数据库开发（4个任务）
1. [ ] 扩展 wiki_entries Schema（添加like_count, comment_count, heat_score）
2. [ ] 创建 wiki_role_likes Schema
3. [ ] 创建 wiki_role_comments Schema
4. [ ] 扩展 uni-id-users（添加storyteller_stats）

### 云函数开发（8个任务）
5. [ ] wiki-role-like（点赞/取消点赞）
6. [ ] wiki-role-comment-add（发表评论）
7. [ ] wiki-role-comment-list（评论列表）
8. [ ] wiki-role-comment-like（评论点赞）
9. [ ] wiki-ranking-roles（角色榜单）
10. [ ] wiki-ranking-storytellers（说书人榜单）
11. [ ] wiki-update-heat-score（定时更新热度分数）
12. [ ] wiki-check-like-status（检查点赞状态）

### 前端开发（6个任务）
13. [ ] 创建 pages/ranking/index.vue（榜单页面）
14. [ ] detail.vue 添加评论区域
15. [ ] detail.vue 添加点赞按钮
16. [ ] 评论输入组件
17. [ ] 榜单列表组件
18. [ ] 导航菜单添加"榜单"入口

### 测试任务（4个）
19. [ ] 测试点赞功能
20. [ ] 测试评论功能
21. [ ] 测试榜单显示
22. [ ] 测试热度计算

---

## ⏱️ 开发时间估算

| 分类 | 任务数 | 预计时间 |
|------|-------|---------|
| 数据库 | 4 | 1.5小时 |
| 云函数 | 8 | 4小时 |
| 前端 | 6 | 5小时 |
| 测试 | 4 | 1.5小时 |
| **总计** | **22** | **12小时** |

---

## 📝 备注

这是一个较大的功能模块，建议分阶段开发：

### 阶段1: 角色互动（优先）
- 点赞功能
- 评论功能
- 评论列表展示

### 阶段2: 角色榜单
- 最新角色榜
- 点赞榜
- 热度榜

### 阶段3: 说书人榜单
- 粉丝榜
- 热度榜

---

## 🎯 下一步

需要开始开发吗？回复：
- **/implement** - 立即开始完整开发（12小时）
- **阶段1** - 先开发角色互动功能（4小时）
- **规划** - 继续细化需求

